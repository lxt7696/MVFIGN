using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0175s, output shape: torch.Size([1895, 1433])
tensor(0.4329, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0230, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/50, Loss: 0.4559
tensor(0.1930, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0193, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2130, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0134, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2310, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1766, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1107, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0070, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0914, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1111, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1245, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1097, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0272s, output shape: torch.Size([1895, 1433])
tensor(0.0826, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 10/50, Loss: 0.0918
tensor(0.0662, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0652, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0687, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0674, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0617, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0561, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0524, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0489, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0457, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0345s, output shape: torch.Size([1895, 1433])
tensor(0.0446, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 20/50, Loss: 0.0539
tensor(0.0452, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0449, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0416, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0373, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0354, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0360, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0366, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0352, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0331, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0251s, output shape: torch.Size([1895, 1433])
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 30/50, Loss: 0.0410
tensor(0.0319, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0315, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0305, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0298, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0296, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0291, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0280, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0273, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0273, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0250s, output shape: torch.Size([1895, 1433])
tensor(0.0274, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 40/50, Loss: 0.0367
tensor(0.0268, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0257, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0257, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0255, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0251, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0248, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0246, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0244, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.01s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0156s, output shape: torch.Size([1895, 1433])
tensor(0.4434, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0198, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/50, Loss: 0.4631
tensor(0.1946, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0167, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2163, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0117, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2366, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1815, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0063, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1131, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0059, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0928, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0062, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1133, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1278, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0071, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1122, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0309s, output shape: torch.Size([1895, 1433])
tensor(0.0834, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0078, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 10/50, Loss: 0.0912
tensor(0.0661, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0662, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0709, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0692, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0618, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0553, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0520, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0494, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0462, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0272s, output shape: torch.Size([1895, 1433])
tensor(0.0444, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 20/50, Loss: 0.0527
tensor(0.0446, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0444, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0412, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0367, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0344, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0352, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0361, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0346, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0227s, output shape: torch.Size([1895, 1433])
tensor(0.0307, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 30/50, Loss: 0.0388
tensor(0.0308, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0308, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0297, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0287, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0283, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0279, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0271, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0263, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0224s, output shape: torch.Size([1895, 1433])
tensor(0.0261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 40/50, Loss: 0.0344
tensor(0.0256, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0249, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0245, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0245, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0243, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0238, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0234, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0233, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0231, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.01s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 1472.74s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]tensor(0.3149, dtype=torch.float64) 0.1523555900713296
tensor(0.2288, dtype=torch.float64) 0.18162086424645713
tensor(0.1993, dtype=torch.float64) 0.13014170981279338
tensor(0.3961, dtype=torch.float64) 0.3455792893790629
tensor(0.3014, dtype=torch.float64) 0.27448444884470125
tensor(0.3604, dtype=torch.float64) 0.29782321671642215
tensor(0.4588, dtype=torch.float64) 0.41176137314623035
tensor(0.4908, dtype=torch.float64) 0.38803119735588876
tensor(0.4170, dtype=torch.float64) 0.32639159986597466
tensor(0.4256, dtype=torch.float64) 0.3525249260938306
tensor(0.3456, dtype=torch.float64) 0.35576838582322634
tensor(0.3309, dtype=torch.float64) 0.4110579743897664
tensor(0.5437, dtype=torch.float64) 0.5667289436480306
tensor(0.6138, dtype=torch.float64) 0.614303513959369
tensor(0.6236, dtype=torch.float64) 0.614496251242345
tensor(0.6642, dtype=torch.float64) 0.6473257775651732
tensor(0.7060, dtype=torch.float64) 0.6831224144004973
tensor(0.7134, dtype=torch.float64) 0.6887317742144263
  6%|▌         | 18/300 [00:00<00:01, 171.91it/s]tensor(0.6986, dtype=torch.float64) 0.6734066499519104
tensor(0.6617, dtype=torch.float64) 0.6330591893014439
tensor(0.6482, dtype=torch.float64) 0.6136049517224591
tensor(0.6396, dtype=torch.float64) 0.6013727438934469
tensor(0.6396, dtype=torch.float64) 0.606540582959481
tensor(0.6630, dtype=torch.float64) 0.636771784450818
tensor(0.7073, dtype=torch.float64) 0.6925219042670626
tensor(0.7417, dtype=torch.float64) 0.733490295803434
tensor(0.7663, dtype=torch.float64) 0.76292996214654
tensor(0.7601, dtype=torch.float64) 0.7613419298942671
tensor(0.7466, dtype=torch.float64) 0.7514183443479417
tensor(0.7220, dtype=torch.float64) 0.7319005432355374
tensor(0.7196, dtype=torch.float64) 0.7283689474110204
tensor(0.7257, dtype=torch.float64) 0.7297426501631615
tensor(0.7442, dtype=torch.float64) 0.7423959528378319
tensor(0.7515, dtype=torch.float64) 0.7476011812482775
tensor(0.7491, dtype=torch.float64) 0.7447317454400864
tensor(0.7417, dtype=torch.float64) 0.7375205956802253
 12%|█▏        | 36/300 [00:00<00:01, 176.28it/s]tensor(0.7429, dtype=torch.float64) 0.7369933264548566
tensor(0.7454, dtype=torch.float64) 0.7372875843907755
tensor(0.7528, dtype=torch.float64) 0.7458701661986616
tensor(0.7638, dtype=torch.float64) 0.7578482603728558
tensor(0.7700, dtype=torch.float64) 0.765038414754997
tensor(0.7724, dtype=torch.float64) 0.7680273656766141
tensor(0.7774, dtype=torch.float64) 0.7745508969754984
tensor(0.7774, dtype=torch.float64) 0.7755189851871621
tensor(0.7786, dtype=torch.float64) 0.7772641871590411
tensor(0.7749, dtype=torch.float64) 0.7734537475501437
tensor(0.7700, dtype=torch.float64) 0.7696029280399503
tensor(0.7638, dtype=torch.float64) 0.7639586778053612
tensor(0.7626, dtype=torch.float64) 0.7628141974265036
tensor(0.7675, dtype=torch.float64) 0.7677462944168033
tensor(0.7688, dtype=torch.float64) 0.7685523427271366
tensor(0.7749, dtype=torch.float64) 0.7739571940324909
tensor(0.7737, dtype=torch.float64) 0.7722312401632686
tensor(0.7749, dtype=torch.float64) 0.7733156332227934
 18%|█▊        | 54/300 [00:00<00:01, 177.46it/s]tensor(0.7737, dtype=torch.float64) 0.7713872416838345
tensor(0.7749, dtype=torch.float64) 0.7723290247201539
tensor(0.7700, dtype=torch.float64) 0.7674706249943111
tensor(0.7700, dtype=torch.float64) 0.7667760141417018
tensor(0.7700, dtype=torch.float64) 0.7670307497409842
tensor(0.7675, dtype=torch.float64) 0.7650232098185856
tensor(0.7712, dtype=torch.float64) 0.7692579291781673
tensor(0.7774, dtype=torch.float64) 0.7759169229074452
tensor(0.7737, dtype=torch.float64) 0.7730717613901243
tensor(0.7724, dtype=torch.float64) 0.7723402372145785
tensor(0.7700, dtype=torch.float64) 0.7703839271019343
tensor(0.7700, dtype=torch.float64) 0.7703522121107436
tensor(0.7712, dtype=torch.float64) 0.771290670168946
tensor(0.7712, dtype=torch.float64) 0.7712905206233778
tensor(0.7700, dtype=torch.float64) 0.7698353093179511
tensor(0.7675, dtype=torch.float64) 0.7667751008400602
tensor(0.7663, dtype=torch.float64) 0.7651590963013728
tensor(0.7688, dtype=torch.float64) 0.7672531817057779
tensor(0.7688, dtype=torch.float64) 0.7672899523785178
 24%|██▍       | 73/300 [00:00<00:01, 179.02it/s]tensor(0.7700, dtype=torch.float64) 0.768492141994568
tensor(0.7700, dtype=torch.float64) 0.7683047778457719
tensor(0.7700, dtype=torch.float64) 0.7688691003009308
tensor(0.7688, dtype=torch.float64) 0.7679458003768731
tensor(0.7724, dtype=torch.float64) 0.772198854169942
tensor(0.7712, dtype=torch.float64) 0.770996696346578
tensor(0.7724, dtype=torch.float64) 0.7722022526714013
tensor(0.7737, dtype=torch.float64) 0.773320948690438
tensor(0.7737, dtype=torch.float64) 0.7732708035251161
tensor(0.7724, dtype=torch.float64) 0.7719461462309712
tensor(0.7749, dtype=torch.float64) 0.774450343790647
tensor(0.7761, dtype=torch.float64) 0.775668486686209
tensor(0.7774, dtype=torch.float64) 0.7770458238171647
tensor(0.7749, dtype=torch.float64) 0.7745091510005607
tensor(0.7761, dtype=torch.float64) 0.7756739139202623
tensor(0.7761, dtype=torch.float64) 0.7756163138078689
tensor(0.7786, dtype=torch.float64) 0.7779772414469136
tensor(0.7798, dtype=torch.float64) 0.7792499504297322
tensor(0.7774, dtype=torch.float64) 0.7767468175751727
 31%|███       | 92/300 [00:00<00:01, 180.71it/s]tensor(0.7786, dtype=torch.float64) 0.777828476014008
tensor(0.7774, dtype=torch.float64) 0.7766295945431746
tensor(0.7774, dtype=torch.float64) 0.7766141767198087
tensor(0.7761, dtype=torch.float64) 0.7753751410996992
tensor(0.7737, dtype=torch.float64) 0.7728538469132988
tensor(0.7761, dtype=torch.float64) 0.7755959354366658
tensor(0.7737, dtype=torch.float64) 0.7730940098729384
tensor(0.7761, dtype=torch.float64) 0.7756164264260594
tensor(0.7761, dtype=torch.float64) 0.7756127927604297
tensor(0.7786, dtype=torch.float64) 0.7781470899723572
tensor(0.7786, dtype=torch.float64) 0.7779009528743385
tensor(0.7798, dtype=torch.float64) 0.7790297475078378
tensor(0.7774, dtype=torch.float64) 0.7766742027107538
tensor(0.7749, dtype=torch.float64) 0.774233239819742
tensor(0.7737, dtype=torch.float64) 0.7729387546138158
tensor(0.7774, dtype=torch.float64) 0.7763187678341739
tensor(0.7761, dtype=torch.float64) 0.7751238193902186
tensor(0.7737, dtype=torch.float64) 0.7726951493609272
tensor(0.7774, dtype=torch.float64) 0.7768201947775305
 37%|███▋      | 111/300 [00:00<00:01, 181.69it/s]tensor(0.7786, dtype=torch.float64) 0.778540893468212
tensor(0.7761, dtype=torch.float64) 0.7760255434777507
tensor(0.7688, dtype=torch.float64) 0.7681310188173327
tensor(0.7712, dtype=torch.float64) 0.7704102708373858
tensor(0.7712, dtype=torch.float64) 0.7705257804259545
tensor(0.7724, dtype=torch.float64) 0.7718854891361916
tensor(0.7700, dtype=torch.float64) 0.7693871315829406
tensor(0.7700, dtype=torch.float64) 0.7692188609436529
tensor(0.7675, dtype=torch.float64) 0.7667449670389873
tensor(0.7700, dtype=torch.float64) 0.7693959806670502
tensor(0.7700, dtype=torch.float64) 0.7694530545934704
tensor(0.7651, dtype=torch.float64) 0.7642453300171659
tensor(0.7688, dtype=torch.float64) 0.767758960287364
tensor(0.7700, dtype=torch.float64) 0.7692146377017792
tensor(0.7675, dtype=torch.float64) 0.7671916918909142
tensor(0.7663, dtype=torch.float64) 0.7664945547851191
tensor(0.7700, dtype=torch.float64) 0.7695769042423897
tensor(0.7700, dtype=torch.float64) 0.7696057537643767
tensor(0.7651, dtype=torch.float64) 0.764530252509123
 43%|████▎     | 130/300 [00:00<00:00, 182.57it/s]tensor(0.7626, dtype=torch.float64) 0.762844282956593
tensor(0.7651, dtype=torch.float64) 0.7645806076113402
tensor(0.7700, dtype=torch.float64) 0.7693044265529557
tensor(0.7651, dtype=torch.float64) 0.7641608696686679
tensor(0.7663, dtype=torch.float64) 0.7657923528834384
tensor(0.7601, dtype=torch.float64) 0.760552902841426
tensor(0.7663, dtype=torch.float64) 0.7661597750384688
tensor(0.7638, dtype=torch.float64) 0.7634275971691359
tensor(0.7651, dtype=torch.float64) 0.7645765522760976
tensor(0.7626, dtype=torch.float64) 0.7626181565588993
tensor(0.7638, dtype=torch.float64) 0.7637307262656793
tensor(0.7626, dtype=torch.float64) 0.7615603657418146
tensor(0.7552, dtype=torch.float64) 0.753906480618746
tensor(0.7601, dtype=torch.float64) 0.7595559409388347
tensor(0.7614, dtype=torch.float64) 0.7621263369141026
tensor(0.7565, dtype=torch.float64) 0.7554286585268355
tensor(0.7565, dtype=torch.float64) 0.7550066165253975
tensor(0.7577, dtype=torch.float64) 0.7570611137410812
tensor(0.7614, dtype=torch.float64) 0.7617234501837123
 50%|████▉     | 149/300 [00:00<00:00, 183.20it/s]tensor(0.7565, dtype=torch.float64) 0.7551416745679131
tensor(0.7651, dtype=torch.float64) 0.7637580534640034
tensor(0.7589, dtype=torch.float64) 0.7591885824572687
tensor(0.7601, dtype=torch.float64) 0.7608727176147423
tensor(0.7589, dtype=torch.float64) 0.7583538140678276
tensor(0.7614, dtype=torch.float64) 0.7602748481636159
tensor(0.7577, dtype=torch.float64) 0.7571003130583368
tensor(0.7626, dtype=torch.float64) 0.7629119948719907
tensor(0.7515, dtype=torch.float64) 0.7513238155780492
tensor(0.7503, dtype=torch.float64) 0.7492056863674484
tensor(0.7577, dtype=torch.float64) 0.7571960038761304
tensor(0.7589, dtype=torch.float64) 0.7591601534924612
tensor(0.7515, dtype=torch.float64) 0.7508207191005077
tensor(0.7515, dtype=torch.float64) 0.7509397066341611
tensor(0.7577, dtype=torch.float64) 0.7576248827655614
tensor(0.7577, dtype=torch.float64) 0.7572149335791533
tensor(0.7503, dtype=torch.float64) 0.747567629071174
tensor(0.7478, dtype=torch.float64) 0.7463387672647921
tensor(0.7478, dtype=torch.float64) 0.7478716855050548
 56%|█████▌    | 168/300 [00:00<00:00, 183.50it/s]tensor(0.7466, dtype=torch.float64) 0.7442532540156728
tensor(0.7491, dtype=torch.float64) 0.7486050518524998
tensor(0.7454, dtype=torch.float64) 0.7452104947989229
tensor(0.7466, dtype=torch.float64) 0.745894441731031
tensor(0.7503, dtype=torch.float64) 0.7484784041457694
tensor(0.7478, dtype=torch.float64) 0.7475696745968099
tensor(0.7417, dtype=torch.float64) 0.740933141765143
tensor(0.7392, dtype=torch.float64) 0.7394690534054886
tensor(0.7466, dtype=torch.float64) 0.7471970177726653
tensor(0.7503, dtype=torch.float64) 0.7493303043337123
tensor(0.7528, dtype=torch.float64) 0.7521596123095702
tensor(0.7442, dtype=torch.float64) 0.7432443554812397
tensor(0.7478, dtype=torch.float64) 0.7469989046844645
tensor(0.7491, dtype=torch.float64) 0.7481006316442382
tensor(0.7503, dtype=torch.float64) 0.7492943172877256
tensor(0.7442, dtype=torch.float64) 0.7436705768959438
tensor(0.7491, dtype=torch.float64) 0.7492732610585195
tensor(0.7503, dtype=torch.float64) 0.7497624368976122
tensor(0.7515, dtype=torch.float64) 0.751607736811885
 62%|██████▏   | 187/300 [00:01<00:00, 183.92it/s]tensor(0.7454, dtype=torch.float64) 0.7444664329381133
tensor(0.7540, dtype=torch.float64) 0.7535189230483041
tensor(0.7466, dtype=torch.float64) 0.7462250587926371
tensor(0.7405, dtype=torch.float64) 0.7395625482455913
tensor(0.7478, dtype=torch.float64) 0.7442232866442837
tensor(0.7515, dtype=torch.float64) 0.750511204212009
tensor(0.7466, dtype=torch.float64) 0.748335734916524
tensor(0.7528, dtype=torch.float64) 0.7513178851927204
tensor(0.7466, dtype=torch.float64) 0.7448785013498429
tensor(0.7429, dtype=torch.float64) 0.7439151002488856
tensor(0.7429, dtype=torch.float64) 0.7423504341905567
tensor(0.7454, dtype=torch.float64) 0.7429222492555193
tensor(0.7491, dtype=torch.float64) 0.7482964731082121
tensor(0.7491, dtype=torch.float64) 0.7500580299785538
tensor(0.7478, dtype=torch.float64) 0.7470527903047288
tensor(0.7466, dtype=torch.float64) 0.7445283035237357
tensor(0.7355, dtype=torch.float64) 0.7350804019477568
tensor(0.7491, dtype=torch.float64) 0.7480431394668757
tensor(0.7417, dtype=torch.float64) 0.7395409695105751
 69%|██████▊   | 206/300 [00:01<00:00, 184.27it/s]tensor(0.7405, dtype=torch.float64) 0.7398106017190719
tensor(0.7442, dtype=torch.float64) 0.7429757668548645
tensor(0.7380, dtype=torch.float64) 0.7365543110416036
tensor(0.7454, dtype=torch.float64) 0.745708189650962
tensor(0.7405, dtype=torch.float64) 0.7404209490553509
tensor(0.7392, dtype=torch.float64) 0.7354949961069694
tensor(0.7442, dtype=torch.float64) 0.742356371620664
tensor(0.7392, dtype=torch.float64) 0.7405766456459315
tensor(0.7491, dtype=torch.float64) 0.7499760536915189
tensor(0.7417, dtype=torch.float64) 0.7393797269105634
tensor(0.7417, dtype=torch.float64) 0.7389822157146677
tensor(0.7478, dtype=torch.float64) 0.7479114414365122
tensor(0.7466, dtype=torch.float64) 0.7483479534724916
tensor(0.7503, dtype=torch.float64) 0.7498167706504202
tensor(0.7417, dtype=torch.float64) 0.7386478784676811
tensor(0.7503, dtype=torch.float64) 0.7490917517424617
tensor(0.7392, dtype=torch.float64) 0.7407591482761239
tensor(0.7417, dtype=torch.float64) 0.7419759274371448
tensor(0.7515, dtype=torch.float64) 0.7503715838122141
 75%|███████▌  | 225/300 [00:01<00:00, 184.18it/s]tensor(0.7466, dtype=torch.float64) 0.7450517140971963
tensor(0.7442, dtype=torch.float64) 0.7439744471352445
tensor(0.7417, dtype=torch.float64) 0.7417641189860943
tensor(0.7442, dtype=torch.float64) 0.7429587054282564
tensor(0.7405, dtype=torch.float64) 0.7386524455999048
tensor(0.7442, dtype=torch.float64) 0.7448578028450467
tensor(0.7417, dtype=torch.float64) 0.7431990104088266
tensor(0.7478, dtype=torch.float64) 0.7467325498589413
tensor(0.7515, dtype=torch.float64) 0.749005053423137
tensor(0.7528, dtype=torch.float64) 0.7516911991821188
tensor(0.7565, dtype=torch.float64) 0.7562495077275704
tensor(0.7515, dtype=torch.float64) 0.7518689396746341
tensor(0.7528, dtype=torch.float64) 0.7511270160784392
tensor(0.7565, dtype=torch.float64) 0.7555264635651117
tensor(0.7552, dtype=torch.float64) 0.7548846644975273
tensor(0.7503, dtype=torch.float64) 0.7500789842854871
tensor(0.7515, dtype=torch.float64) 0.7501946767389438
tensor(0.7589, dtype=torch.float64) 0.757431103402618
tensor(0.7478, dtype=torch.float64) 0.7489369710736471
 81%|████████▏ | 244/300 [00:01<00:00, 184.35it/s]tensor(0.7515, dtype=torch.float64) 0.7523072877084201
tensor(0.7503, dtype=torch.float64) 0.7477562965652069
tensor(0.7429, dtype=torch.float64) 0.7404918118571109
tensor(0.7478, dtype=torch.float64) 0.7485710369733295
tensor(0.7417, dtype=torch.float64) 0.7432277759726235
tensor(0.7491, dtype=torch.float64) 0.7482519318023629
tensor(0.7466, dtype=torch.float64) 0.7449861256751089
tensor(0.7503, dtype=torch.float64) 0.7504674402452303
tensor(0.7565, dtype=torch.float64) 0.7569639463421921
tensor(0.7417, dtype=torch.float64) 0.7418563744267264
tensor(0.7442, dtype=torch.float64) 0.7434981207939887
tensor(0.7503, dtype=torch.float64) 0.7505713326960582
tensor(0.7478, dtype=torch.float64) 0.7490144392728306
tensor(0.7552, dtype=torch.float64) 0.7541244106708062
tensor(0.7392, dtype=torch.float64) 0.7380815313463989
tensor(0.7491, dtype=torch.float64) 0.7484622723356839
tensor(0.7515, dtype=torch.float64) 0.7515318934771735
tensor(0.7454, dtype=torch.float64) 0.7431568048625565
tensor(0.7503, dtype=torch.float64) 0.7493292821769598
 88%|████████▊ | 263/300 [00:01<00:00, 183.51it/s]tensor(0.7380, dtype=torch.float64) 0.7394573473533951
tensor(0.7491, dtype=torch.float64) 0.747780468465866
tensor(0.7442, dtype=torch.float64) 0.7418435429171978
tensor(0.7466, dtype=torch.float64) 0.7469851400002483
tensor(0.7442, dtype=torch.float64) 0.7432135671534619
tensor(0.7478, dtype=torch.float64) 0.7458310325890419
tensor(0.7380, dtype=torch.float64) 0.7385390483864154
tensor(0.7417, dtype=torch.float64) 0.7431987013874669
tensor(0.7331, dtype=torch.float64) 0.731703687475737
tensor(0.7429, dtype=torch.float64) 0.7415795471758349
tensor(0.7478, dtype=torch.float64) 0.7473608137791217
tensor(0.7466, dtype=torch.float64) 0.7452642730966342
tensor(0.7417, dtype=torch.float64) 0.7408369909437258
tensor(0.7319, dtype=torch.float64) 0.7330086178109111
tensor(0.7405, dtype=torch.float64) 0.7396851293283158
tensor(0.7392, dtype=torch.float64) 0.7381756812313361
tensor(0.7405, dtype=torch.float64) 0.7397776272136631
tensor(0.7417, dtype=torch.float64) 0.7411076278994578
tensor(0.7306, dtype=torch.float64) 0.7306714203622509
 94%|█████████▍| 282/300 [00:01<00:00, 183.97it/s]tensor(0.7343, dtype=torch.float64) 0.7345296847652736
tensor(0.7405, dtype=torch.float64) 0.7395424299931362
tensor(0.7429, dtype=torch.float64) 0.7390817626851354
tensor(0.7429, dtype=torch.float64) 0.7422430869473156
tensor(0.7392, dtype=torch.float64) 0.7423145277258796
tensor(0.7528, dtype=torch.float64) 0.7520570402670226
tensor(0.7417, dtype=torch.float64) 0.7394651644839647
tensor(0.7491, dtype=torch.float64) 0.7469884509223863
tensor(0.7245, dtype=torch.float64) 0.7258908396761642
tensor(0.7380, dtype=torch.float64) 0.7379015809161474
tensor(0.7429, dtype=torch.float64) 0.7415799407076283
tensor(0.7466, dtype=torch.float64) 0.7458382504469948
tensor(0.7442, dtype=torch.float64) 0.7436270881862226
tensor(0.7442, dtype=torch.float64) 0.7425171550832884
tensor(0.7429, dtype=torch.float64) 0.7409195809339267
tensor(0.7466, dtype=torch.float64) 0.7462556191781825
tensor(0.7491, dtype=torch.float64) 0.7472333734239772
tensor(0.7478, dtype=torch.float64) 0.7457271180007123
100%|██████████| 300/300 [00:01<00:00, 182.63it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 1472.74s
  Phase 2 Time: 1.64s
  Total Time: 1474.38s
  Best Accuracy: 0.7798
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0177s, output shape: torch.Size([1895, 1433])
tensor(0.4390, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0229, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/10, Loss: 0.4618
tensor(0.1940, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0190, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2128, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0133, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2338, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1797, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1118, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0070, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0911, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1114, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0079, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1262, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1117, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.05s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0159s, output shape: torch.Size([1895, 1433])
tensor(0.4309, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0205, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/10, Loss: 0.4515
tensor(0.1952, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0173, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2147, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0120, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2292, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1764, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0066, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1120, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0063, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0920, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0066, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1107, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1248, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0077, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1104, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.04s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 302.02s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]tensor(0.2804, dtype=torch.float64) 0.12284526303476292
tensor(0.1525, dtype=torch.float64) 0.04036855736753739
tensor(0.1525, dtype=torch.float64) 0.04036855736753739
tensor(0.1082, dtype=torch.float64) 0.02114365205805221
tensor(0.1427, dtype=torch.float64) 0.0356319601947365
tensor(0.1427, dtype=torch.float64) 0.0356319601947365
tensor(0.3296, dtype=torch.float64) 0.18901479366615093
tensor(0.2804, dtype=torch.float64) 0.12284526303476292
tensor(0.2804, dtype=torch.float64) 0.12284526303476292
tensor(0.2817, dtype=torch.float64) 0.12540372788343265
tensor(0.1587, dtype=torch.float64) 0.04345782311326298
tensor(0.1587, dtype=torch.float64) 0.04345782311326298
tensor(0.1587, dtype=torch.float64) 0.04345782311326298
tensor(0.1587, dtype=torch.float64) 0.04345782311326298
tensor(0.2903, dtype=torch.float64) 0.18447216501436053
tensor(0.4440, dtype=torch.float64) 0.3294710748906102
tensor(0.2841, dtype=torch.float64) 0.13040604849633222
tensor(0.2804, dtype=torch.float64) 0.12284526303476292
tensor(0.2804, dtype=torch.float64) 0.12284526303476292
  6%|▋         | 19/300 [00:00<00:01, 181.55it/s]tensor(0.2804, dtype=torch.float64) 0.12284526303476292
tensor(0.2804, dtype=torch.float64) 0.12284526303476292
tensor(0.3702, dtype=torch.float64) 0.240057773215857
tensor(0.1685, dtype=torch.float64) 0.08420686251040617
tensor(0.2263, dtype=torch.float64) 0.17704384953991537
tensor(0.4428, dtype=torch.float64) 0.33038416592871406
tensor(0.4465, dtype=torch.float64) 0.323887570983802
tensor(0.1968, dtype=torch.float64) 0.11495380150917037
tensor(0.1759, dtype=torch.float64) 0.07647542135255944
tensor(0.1993, dtype=torch.float64) 0.12047054375954475
tensor(0.3210, dtype=torch.float64) 0.19668555730321388
tensor(0.2804, dtype=torch.float64) 0.12296338347998864
tensor(0.2817, dtype=torch.float64) 0.12540372788343265
tensor(0.2841, dtype=torch.float64) 0.13040604849633222
tensor(0.2866, dtype=torch.float64) 0.13526151962606095
tensor(0.3296, dtype=torch.float64) 0.20151427824926246
tensor(0.3764, dtype=torch.float64) 0.24382720238335054
tensor(0.3899, dtype=torch.float64) 0.25238356379747423
tensor(0.4416, dtype=torch.float64) 0.3283973897781384
 13%|█▎        | 38/300 [00:00<00:01, 172.21it/s]tensor(0.4121, dtype=torch.float64) 0.29284037012042163
tensor(0.3260, dtype=torch.float64) 0.20081293180274223
tensor(0.2878, dtype=torch.float64) 0.13781978228379416
tensor(0.2854, dtype=torch.float64) 0.1328517070127307
tensor(0.2854, dtype=torch.float64) 0.1328517070127307
tensor(0.2854, dtype=torch.float64) 0.1328517070127307
tensor(0.2915, dtype=torch.float64) 0.14455859893447684
tensor(0.3161, dtype=torch.float64) 0.18393369489978378
tensor(0.3469, dtype=torch.float64) 0.22096861852596428
tensor(0.3592, dtype=torch.float64) 0.23157897845485056
tensor(0.3579, dtype=torch.float64) 0.23152279441602228
tensor(0.3432, dtype=torch.float64) 0.216966255588583
tensor(0.3235, dtype=torch.float64) 0.19368613571810409
tensor(0.3026, dtype=torch.float64) 0.16367419219192397
tensor(0.2964, dtype=torch.float64) 0.15334444463192679
tensor(0.2989, dtype=torch.float64) 0.15812757331700067
tensor(0.3063, dtype=torch.float64) 0.17011397817764723
tensor(0.3272, dtype=torch.float64) 0.19843487146160174
 19%|█▊        | 56/300 [00:00<00:01, 161.82it/s]tensor(0.3432, dtype=torch.float64) 0.216966255588583
tensor(0.3579, dtype=torch.float64) 0.23230679594245332
tensor(0.3629, dtype=torch.float64) 0.23585502625173504
tensor(0.3579, dtype=torch.float64) 0.23230679594245332
tensor(0.3481, dtype=torch.float64) 0.22227684787887192
tensor(0.3444, dtype=torch.float64) 0.2206787544319674
tensor(0.3407, dtype=torch.float64) 0.21755075323803638
tensor(0.3383, dtype=torch.float64) 0.2125854053021901
tensor(0.3432, dtype=torch.float64) 0.2181690175685928
tensor(0.3567, dtype=torch.float64) 0.23243567448979713
tensor(0.3665, dtype=torch.float64) 0.24032982840901185
tensor(0.3739, dtype=torch.float64) 0.2497029906655652
tensor(0.3813, dtype=torch.float64) 0.2589694665806742
tensor(0.3911, dtype=torch.float64) 0.27330717338988686
tensor(0.3850, dtype=torch.float64) 0.267903287091479
tensor(0.3838, dtype=torch.float64) 0.2696998260124846
tensor(0.3838, dtype=torch.float64) 0.2704824449549121
 24%|██▍       | 73/300 [00:00<00:01, 159.74it/s]tensor(0.3862, dtype=torch.float64) 0.27479742890265596
tensor(0.3887, dtype=torch.float64) 0.2784954446611922
tensor(0.3973, dtype=torch.float64) 0.2860968966639763
tensor(0.4034, dtype=torch.float64) 0.2927222431130763
tensor(0.4145, dtype=torch.float64) 0.3009424257784689
tensor(0.4231, dtype=torch.float64) 0.31131979417213995
tensor(0.4268, dtype=torch.float64) 0.3157539928296386
tensor(0.4244, dtype=torch.float64) 0.3161177625664577
tensor(0.4231, dtype=torch.float64) 0.315784540482649
tensor(0.4244, dtype=torch.float64) 0.3167613266837643
tensor(0.4244, dtype=torch.float64) 0.317275243614907
tensor(0.4317, dtype=torch.float64) 0.3232065596718022
tensor(0.4391, dtype=torch.float64) 0.32873857673619133
tensor(0.4465, dtype=torch.float64) 0.33195787400035576
tensor(0.4490, dtype=torch.float64) 0.33404806549731725
tensor(0.4514, dtype=torch.float64) 0.33793667846932907
tensor(0.4477, dtype=torch.float64) 0.3355414316698504
tensor(0.4490, dtype=torch.float64) 0.33702842239661823
tensor(0.4526, dtype=torch.float64) 0.3384345129802916
tensor(0.4613, dtype=torch.float64) 0.34542020860679024
 31%|███       | 93/300 [00:00<00:01, 170.93it/s]tensor(0.4662, dtype=torch.float64) 0.35277689728386696
tensor(0.4699, dtype=torch.float64) 0.3581497366796488
tensor(0.4674, dtype=torch.float64) 0.35697666557628693
tensor(0.4686, dtype=torch.float64) 0.3631588007100247
tensor(0.4834, dtype=torch.float64) 0.383002830455776
tensor(0.4895, dtype=torch.float64) 0.3933419710326068
tensor(0.4994, dtype=torch.float64) 0.40375766051700474
tensor(0.5055, dtype=torch.float64) 0.41569694906746196
tensor(0.5018, dtype=torch.float64) 0.41182700579353737
tensor(0.4969, dtype=torch.float64) 0.40731926280198083
tensor(0.5092, dtype=torch.float64) 0.4248482832181736
tensor(0.5228, dtype=torch.float64) 0.4400553278463335
tensor(0.5252, dtype=torch.float64) 0.44495219445899814
tensor(0.5252, dtype=torch.float64) 0.44292474529070075
tensor(0.5203, dtype=torch.float64) 0.4383845403964919
tensor(0.5215, dtype=torch.float64) 0.44081690317103817
tensor(0.5363, dtype=torch.float64) 0.46027259968401113
tensor(0.5584, dtype=torch.float64) 0.4903085422132493
 37%|███▋      | 111/300 [00:00<00:01, 164.55it/s]tensor(0.5769, dtype=torch.float64) 0.5138750228912606
tensor(0.5806, dtype=torch.float64) 0.5232647014861335
tensor(0.5806, dtype=torch.float64) 0.5253854371575714
tensor(0.5855, dtype=torch.float64) 0.5351401326859908
tensor(0.6064, dtype=torch.float64) 0.5581258509476396
tensor(0.6138, dtype=torch.float64) 0.566706403688965
tensor(0.5892, dtype=torch.float64) 0.5348022533216954
tensor(0.5830, dtype=torch.float64) 0.5315239690151079
tensor(0.5879, dtype=torch.float64) 0.5377220304285195
tensor(0.6064, dtype=torch.float64) 0.5600064175872621
tensor(0.6125, dtype=torch.float64) 0.5703589736224007
tensor(0.6187, dtype=torch.float64) 0.5763920584197144
tensor(0.6285, dtype=torch.float64) 0.5922768843079111
tensor(0.6556, dtype=torch.float64) 0.6262425553155329
tensor(0.6630, dtype=torch.float64) 0.6354114661150233
tensor(0.6458, dtype=torch.float64) 0.6179853384083945
tensor(0.6322, dtype=torch.float64) 0.601950020640671
tensor(0.6605, dtype=torch.float64) 0.6354092599627713
tensor(0.6753, dtype=torch.float64) 0.6522743998469714
tensor(0.6630, dtype=torch.float64) 0.6403656753895244
 44%|████▎     | 131/300 [00:00<00:00, 174.20it/s]tensor(0.6593, dtype=torch.float64) 0.6390465932180454
tensor(0.6679, dtype=torch.float64) 0.6499579208657564
tensor(0.6950, dtype=torch.float64) 0.6768228233383964
tensor(0.6925, dtype=torch.float64) 0.6725402356126813
tensor(0.6667, dtype=torch.float64) 0.6473782317936339
tensor(0.6704, dtype=torch.float64) 0.6545538921387083
tensor(0.6925, dtype=torch.float64) 0.6761626763742798
tensor(0.6962, dtype=torch.float64) 0.677387409534327
tensor(0.7048, dtype=torch.float64) 0.6889822932281998
tensor(0.6950, dtype=torch.float64) 0.6792876583278746
tensor(0.6999, dtype=torch.float64) 0.6857544427645617
tensor(0.7380, dtype=torch.float64) 0.7279941998522429
tensor(0.7319, dtype=torch.float64) 0.7225540110336073
tensor(0.7036, dtype=torch.float64) 0.6908185033583378
tensor(0.6999, dtype=torch.float64) 0.6845090977379809
tensor(0.7232, dtype=torch.float64) 0.7153335246382583
tensor(0.7109, dtype=torch.float64) 0.70154088614412
tensor(0.7134, dtype=torch.float64) 0.7006397061274673
tensor(0.7405, dtype=torch.float64) 0.7299991353352819
tensor(0.7245, dtype=torch.float64) 0.7158137797223819
 50%|█████     | 151/300 [00:00<00:00, 180.91it/s]tensor(0.7023, dtype=torch.float64) 0.6904629736759571
tensor(0.7294, dtype=torch.float64) 0.719353381670366
tensor(0.7577, dtype=torch.float64) 0.7552174076530627
tensor(0.7392, dtype=torch.float64) 0.7317173862406242
tensor(0.6851, dtype=torch.float64) 0.6682344377884011
tensor(0.7245, dtype=torch.float64) 0.7139495940585368
tensor(0.7638, dtype=torch.float64) 0.7618263115759776
tensor(0.7478, dtype=torch.float64) 0.7416678692353259
tensor(0.7134, dtype=torch.float64) 0.7045087944933579
tensor(0.7355, dtype=torch.float64) 0.7304564606773973
tensor(0.7601, dtype=torch.float64) 0.7546856809644165
tensor(0.7306, dtype=torch.float64) 0.7182868603266043
tensor(0.7442, dtype=torch.float64) 0.7371952249804892
tensor(0.7565, dtype=torch.float64) 0.7532061159743695
tensor(0.7466, dtype=torch.float64) 0.7410930613132101
tensor(0.7282, dtype=torch.float64) 0.7201860324017472
tensor(0.7503, dtype=torch.float64) 0.7450183966935868
tensor(0.7491, dtype=torch.float64) 0.7443491424202561
tensor(0.7232, dtype=torch.float64) 0.7109646274683672
 57%|█████▋    | 170/300 [00:00<00:00, 177.20it/s]tensor(0.7454, dtype=torch.float64) 0.7396190604552642
tensor(0.7675, dtype=torch.float64) 0.7669643498451969
tensor(0.7405, dtype=torch.float64) 0.732046117324271
tensor(0.7380, dtype=torch.float64) 0.7283850405132306
tensor(0.7712, dtype=torch.float64) 0.7691123378489532
tensor(0.7540, dtype=torch.float64) 0.749418854217519
tensor(0.7294, dtype=torch.float64) 0.7208031798983854
tensor(0.7614, dtype=torch.float64) 0.7581088203014696
tensor(0.7700, dtype=torch.float64) 0.7677402548565291
tensor(0.7442, dtype=torch.float64) 0.7352659668599189
tensor(0.7294, dtype=torch.float64) 0.7212179398530782
tensor(0.7700, dtype=torch.float64) 0.7694912938935664
tensor(0.7491, dtype=torch.float64) 0.7428954718345243
tensor(0.7355, dtype=torch.float64) 0.7257947305345863
tensor(0.7688, dtype=torch.float64) 0.7666591025666265
tensor(0.7737, dtype=torch.float64) 0.7701745110059491
tensor(0.7232, dtype=torch.float64) 0.7136920623326906
tensor(0.7651, dtype=torch.float64) 0.7626916958245703
tensor(0.7700, dtype=torch.float64) 0.7661799671214123
tensor(0.7245, dtype=torch.float64) 0.7200598815986284
tensor(0.7663, dtype=torch.float64) 0.7610168417125279
 64%|██████▎   | 191/300 [00:01<00:00, 184.09it/s]tensor(0.7589, dtype=torch.float64) 0.7514115299440501
tensor(0.7454, dtype=torch.float64) 0.741711569798505
tensor(0.7503, dtype=torch.float64) 0.7479741607426679
tensor(0.7663, dtype=torch.float64) 0.7608314810451636
tensor(0.7515, dtype=torch.float64) 0.7441422475151658
tensor(0.7688, dtype=torch.float64) 0.7664834603395392
tensor(0.7466, dtype=torch.float64) 0.7410875476435089
tensor(0.7589, dtype=torch.float64) 0.7539549358118852
tensor(0.7552, dtype=torch.float64) 0.7519571414036047
tensor(0.7565, dtype=torch.float64) 0.7515736643749396
tensor(0.7589, dtype=torch.float64) 0.7537456126225052
tensor(0.7651, dtype=torch.float64) 0.7635503906904628
tensor(0.7515, dtype=torch.float64) 0.7477197309944703
tensor(0.7663, dtype=torch.float64) 0.7631486057463213
tensor(0.7712, dtype=torch.float64) 0.7691206208860174
tensor(0.7577, dtype=torch.float64) 0.753794042374699
tensor(0.7478, dtype=torch.float64) 0.743174333155185
tensor(0.7761, dtype=torch.float64) 0.7753185929530843
tensor(0.7466, dtype=torch.float64) 0.7382867503504272
tensor(0.7528, dtype=torch.float64) 0.7487035979902851
 70%|███████   | 211/300 [00:01<00:00, 186.98it/s]tensor(0.7577, dtype=torch.float64) 0.7561618336273931
tensor(0.7491, dtype=torch.float64) 0.7413446746754042
tensor(0.7737, dtype=torch.float64) 0.7712126393179457
tensor(0.7651, dtype=torch.float64) 0.7666888857913378
tensor(0.7478, dtype=torch.float64) 0.7399842085191873
tensor(0.7589, dtype=torch.float64) 0.7515971948176081
tensor(0.7724, dtype=torch.float64) 0.7717758351375408
tensor(0.7601, dtype=torch.float64) 0.7576027420886625
tensor(0.7552, dtype=torch.float64) 0.7466164495889556
tensor(0.7614, dtype=torch.float64) 0.7582290646320147
tensor(0.7663, dtype=torch.float64) 0.7649963458815315
tensor(0.7343, dtype=torch.float64) 0.7287945254240507
tensor(0.7503, dtype=torch.float64) 0.7479390329048274
tensor(0.7589, dtype=torch.float64) 0.7535510562282423
tensor(0.7601, dtype=torch.float64) 0.7584836818831475
tensor(0.7675, dtype=torch.float64) 0.7658606859971387
tensor(0.7565, dtype=torch.float64) 0.7482044094675764
tensor(0.7700, dtype=torch.float64) 0.7678772142604388
tensor(0.7614, dtype=torch.float64) 0.7600033467987323
 77%|███████▋  | 230/300 [00:01<00:00, 180.01it/s]tensor(0.7638, dtype=torch.float64) 0.7603263506037589
tensor(0.7638, dtype=torch.float64) 0.759947855164333
tensor(0.7589, dtype=torch.float64) 0.755143671202174
tensor(0.7675, dtype=torch.float64) 0.7686826870478711
tensor(0.7540, dtype=torch.float64) 0.7471255254506941
tensor(0.7663, dtype=torch.float64) 0.7609402739595335
tensor(0.7601, dtype=torch.float64) 0.7588026800145702
tensor(0.7515, dtype=torch.float64) 0.7484741456081507
tensor(0.7626, dtype=torch.float64) 0.7602401542116735
tensor(0.7417, dtype=torch.float64) 0.7325636796034518
tensor(0.7663, dtype=torch.float64) 0.7674599025426667
tensor(0.7577, dtype=torch.float64) 0.7560274623509978
tensor(0.7552, dtype=torch.float64) 0.7479823779854179
tensor(0.7651, dtype=torch.float64) 0.7629740923459386
tensor(0.7540, dtype=torch.float64) 0.7511894808496871
tensor(0.7675, dtype=torch.float64) 0.7635408197715046
tensor(0.7712, dtype=torch.float64) 0.7675926556640839
tensor(0.7466, dtype=torch.float64) 0.7430107285332399
tensor(0.7700, dtype=torch.float64) 0.7710803479031341
tensor(0.7232, dtype=torch.float64) 0.7082858899226705
 83%|████████▎ | 250/300 [00:01<00:00, 185.20it/s]tensor(0.7724, dtype=torch.float64) 0.7722001470497479
tensor(0.7577, dtype=torch.float64) 0.7556469197507246
tensor(0.7675, dtype=torch.float64) 0.76328264319446
tensor(0.7565, dtype=torch.float64) 0.7542917975736922
tensor(0.7159, dtype=torch.float64) 0.7105646441683154
tensor(0.7626, dtype=torch.float64) 0.7626891175873739
tensor(0.7442, dtype=torch.float64) 0.7341186512100625
tensor(0.7589, dtype=torch.float64) 0.7550463602966856
tensor(0.7466, dtype=torch.float64) 0.7494088735548647
tensor(0.7097, dtype=torch.float64) 0.6967300641667963
tensor(0.7208, dtype=torch.float64) 0.7170069378714549
tensor(0.7269, dtype=torch.float64) 0.7220102792950307
tensor(0.7073, dtype=torch.float64) 0.7043862511747816
tensor(0.6950, dtype=torch.float64) 0.6960601972781962
tensor(0.6716, dtype=torch.float64) 0.6535990983162582
tensor(0.7343, dtype=torch.float64) 0.7313503368898987
tensor(0.7146, dtype=torch.float64) 0.7212910607944677
tensor(0.6986, dtype=torch.float64) 0.6814366855907493
tensor(0.7245, dtype=torch.float64) 0.708919760930292
tensor(0.7380, dtype=torch.float64) 0.7430751606028897
tensor(0.7417, dtype=torch.float64) 0.7392902012334597
 90%|█████████ | 271/300 [00:01<00:00, 191.01it/s]tensor(0.7319, dtype=torch.float64) 0.7229369706615068
tensor(0.7429, dtype=torch.float64) 0.740046189078686
tensor(0.7466, dtype=torch.float64) 0.7453229410386545
tensor(0.7171, dtype=torch.float64) 0.7139880162025548
tensor(0.7688, dtype=torch.float64) 0.7680835860297063
tensor(0.7417, dtype=torch.float64) 0.7382064476147588
tensor(0.7417, dtype=torch.float64) 0.7338740066775752
tensor(0.7454, dtype=torch.float64) 0.7423697673579776
tensor(0.7663, dtype=torch.float64) 0.7681631763284541
tensor(0.7491, dtype=torch.float64) 0.7426244754322862
tensor(0.7392, dtype=torch.float64) 0.727201158538337
tensor(0.7626, dtype=torch.float64) 0.7588125510667125
tensor(0.7589, dtype=torch.float64) 0.7623131284233997
tensor(0.7528, dtype=torch.float64) 0.7480475183054189
tensor(0.7392, dtype=torch.float64) 0.7300861505095969
tensor(0.7589, dtype=torch.float64) 0.7557492867506534
tensor(0.7601, dtype=torch.float64) 0.7579793031453921
tensor(0.7552, dtype=torch.float64) 0.7538451280934843
tensor(0.7491, dtype=torch.float64) 0.7436556828775627
tensor(0.7466, dtype=torch.float64) 0.7398931710664611
tensor(0.7552, dtype=torch.float64) 0.7519749470627448
 97%|█████████▋| 292/300 [00:01<00:00, 194.34it/s]tensor(0.7454, dtype=torch.float64) 0.7467532406095044
tensor(0.7589, dtype=torch.float64) 0.7547319689682811
tensor(0.7614, dtype=torch.float64) 0.754062720417388
tensor(0.7429, dtype=torch.float64) 0.7392434293697444
tensor(0.7552, dtype=torch.float64) 0.752496070694189
tensor(0.7491, dtype=torch.float64) 0.7460699861217053
tensor(0.7466, dtype=torch.float64) 0.7424842413813217
tensor(0.7392, dtype=torch.float64) 0.7311518389980219
100%|██████████| 300/300 [00:01<00:00, 181.21it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 302.02s
  Phase 2 Time: 1.66s
  Total Time: 303.67s
  Best Accuracy: 0.7761
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0177s, output shape: torch.Size([1895, 1433])
tensor(0.4216, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0227, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/200, Loss: 0.4443
tensor(0.1896, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0190, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2135, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0131, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2238, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1686, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1083, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0070, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0924, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1101, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0079, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1210, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1059, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0268s, output shape: torch.Size([1895, 1433])
tensor(0.0799, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 10/200, Loss: 0.0889
tensor(0.0648, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0646, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0684, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0665, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0599, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0542, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0513, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0488, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0456, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0324s, output shape: torch.Size([1895, 1433])
tensor(0.0437, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 20/200, Loss: 0.0527
tensor(0.0440, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0440, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0413, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0370, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0355, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0363, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0350, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0326, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0258s, output shape: torch.Size([1895, 1433])
tensor(0.0313, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 30/200, Loss: 0.0399
tensor(0.0314, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0313, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0303, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0294, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0291, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0286, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0277, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0270, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0270, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0255s, output shape: torch.Size([1895, 1433])
tensor(0.0270, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 40/200, Loss: 0.0359
tensor(0.0265, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0257, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0254, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0254, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0252, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0244, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0243, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0241, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 50] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0252s, output shape: torch.Size([1895, 1433])
tensor(0.0238, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 50/200, Loss: 0.0331
tensor(0.0236, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0235, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0233, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0231, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0229, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0229, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0227, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0225, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0224, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 60] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0256s, output shape: torch.Size([1895, 1433])
tensor(0.0223, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 60/200, Loss: 0.0320
tensor(0.0222, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0220, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0219, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0219, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0218, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0217, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0216, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0215, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0214, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 70] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0257s, output shape: torch.Size([1895, 1433])
tensor(0.0214, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 70/200, Loss: 0.0314
tensor(0.0213, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0212, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0212, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0211, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0211, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0210, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0210, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0209, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0103, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0208, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0103, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 80] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0255s, output shape: torch.Size([1895, 1433])
tensor(0.0208, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0103, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 80/200, Loss: 0.0311
tensor(0.0208, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0103, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0207, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0103, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0207, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0104, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0207, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0104, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0206, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0104, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0206, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0104, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0206, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0104, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0205, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0105, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0205, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0105, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 90] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0257s, output shape: torch.Size([1895, 1433])
tensor(0.0205, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0105, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 90/200, Loss: 0.0309
tensor(0.0204, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0105, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0204, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0105, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0204, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0105, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0204, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0105, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0204, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0203, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0203, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0203, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0203, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 100] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0259s, output shape: torch.Size([1895, 1433])
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 100/200, Loss: 0.0309
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0106, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 110] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0255s, output shape: torch.Size([1895, 1433])
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 110/200, Loss: 0.0308
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 120] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0252s, output shape: torch.Size([1895, 1433])
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 120/200, Loss: 0.0308
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0107, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 130] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0252s, output shape: torch.Size([1895, 1433])
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 130/200, Loss: 0.0308
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 140] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0254s, output shape: torch.Size([1895, 1433])
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 140/200, Loss: 0.0308
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 150] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0256s, output shape: torch.Size([1895, 1433])
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 150/200, Loss: 0.0308
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 160] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0257s, output shape: torch.Size([1895, 1433])
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 160/200, Loss: 0.0307
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 170] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0253s, output shape: torch.Size([1895, 1433])
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 170/200, Loss: 0.0307
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0108, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 180] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0256s, output shape: torch.Size([1895, 1433])
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 180/200, Loss: 0.0307
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 190] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0252s, output shape: torch.Size([1895, 1433])
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 190/200, Loss: 0.0307
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0109, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.01s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0157s, output shape: torch.Size([1895, 1433])
tensor(0.4204, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0204, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/200, Loss: 0.4408
tensor(0.1937, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0170, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2114, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0118, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1729, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1087, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0064, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0905, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1102, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1232, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0076, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1072, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0275s, output shape: torch.Size([1895, 1433])
tensor(0.0792, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 10/200, Loss: 0.0874
tensor(0.0635, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0646, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0692, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0669, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0592, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0534, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0510, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0487, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0453, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0477s, output shape: torch.Size([1895, 1433])
tensor(0.0430, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 20/200, Loss: 0.0514
tensor(0.0433, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0436, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0408, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0363, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0340, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0357, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0342, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0317, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0237s, output shape: torch.Size([1895, 1433])
tensor(0.0305, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 30/200, Loss: 0.0384
tensor(0.0307, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0306, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0294, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0284, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0282, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0280, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0270, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0260, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0259, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0237s, output shape: torch.Size([1895, 1433])
tensor(0.0261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 40/200, Loss: 0.0343
tensor(0.0256, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0248, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0244, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0244, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0242, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0238, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0234, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0233, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0231, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 50] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0238s, output shape: torch.Size([1895, 1433])
tensor(0.0228, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 50/200, Loss: 0.0313
tensor(0.0225, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0224, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0223, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0220, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0219, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0217, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0216, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0214, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0213, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 60] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0237s, output shape: torch.Size([1895, 1433])
tensor(0.0211, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 60/200, Loss: 0.0301
tensor(0.0210, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0209, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0208, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0207, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0206, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0205, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0204, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0203, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 70] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0237s, output shape: torch.Size([1895, 1433])
tensor(0.0202, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 70/200, Loss: 0.0295
tensor(0.0201, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0200, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0199, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0198, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0197, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0197, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0196, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0196, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 80] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0237s, output shape: torch.Size([1895, 1433])
tensor(0.0195, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 80/200, Loss: 0.0291
tensor(0.0195, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0194, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0194, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0193, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0193, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0193, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0097, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0192, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0192, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0192, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 90] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0233s, output shape: torch.Size([1895, 1433])
tensor(0.0191, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 90/200, Loss: 0.0290
tensor(0.0191, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0191, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0190, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0098, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0190, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0190, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0190, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0190, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0189, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0189, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 100] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0232s, output shape: torch.Size([1895, 1433])
tensor(0.0189, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 100/200, Loss: 0.0288
tensor(0.0189, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0099, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0188, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0188, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0188, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0188, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0188, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0188, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0188, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0187, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 110] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0235s, output shape: torch.Size([1895, 1433])
tensor(0.0187, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 110/200, Loss: 0.0288
tensor(0.0187, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0187, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0100, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0187, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0187, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 120] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0232s, output shape: torch.Size([1895, 1433])
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 120/200, Loss: 0.0287
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0186, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 130] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0237s, output shape: torch.Size([1895, 1433])
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 130/200, Loss: 0.0287
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0101, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 140] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0268s, output shape: torch.Size([1895, 1433])
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 140/200, Loss: 0.0287
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0185, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 150] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0234s, output shape: torch.Size([1895, 1433])
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 150/200, Loss: 0.0286
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 160] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0237s, output shape: torch.Size([1895, 1433])
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 160/200, Loss: 0.0286
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 170] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0234s, output shape: torch.Size([1895, 1433])
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 170/200, Loss: 0.0286
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 180] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0236s, output shape: torch.Size([1895, 1433])
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 180/200, Loss: 0.0286
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 190] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0240s, output shape: torch.Size([1895, 1433])
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 190/200, Loss: 0.0286
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0102, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.00s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 5863.08s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]tensor(0.3124, dtype=torch.float64) 0.17418507267991895
tensor(0.4354, dtype=torch.float64) 0.4058634419765881
tensor(0.4908, dtype=torch.float64) 0.43441983656444905
tensor(0.5683, dtype=torch.float64) 0.5184197426766587
tensor(0.5510, dtype=torch.float64) 0.5272762621174787
tensor(0.5904, dtype=torch.float64) 0.5829151955917509
tensor(0.6630, dtype=torch.float64) 0.6380145463724742
tensor(0.6851, dtype=torch.float64) 0.6707030030036001
tensor(0.6642, dtype=torch.float64) 0.6570247626542087
tensor(0.5818, dtype=torch.float64) 0.5852653068307087
tensor(0.5474, dtype=torch.float64) 0.5685294701877396
tensor(0.5978, dtype=torch.float64) 0.6112095925798254
tensor(0.6519, dtype=torch.float64) 0.6459483475957578
tensor(0.6827, dtype=torch.float64) 0.6752686327212254
tensor(0.7048, dtype=torch.float64) 0.7006492953626614
tensor(0.7109, dtype=torch.float64) 0.7076573697625572
tensor(0.7109, dtype=torch.float64) 0.704020027829516
tensor(0.7282, dtype=torch.float64) 0.7206417568793102
  6%|▌         | 18/300 [00:00<00:01, 175.45it/s]tensor(0.7380, dtype=torch.float64) 0.7303674369764009
tensor(0.7478, dtype=torch.float64) 0.7422378086603221
tensor(0.7417, dtype=torch.float64) 0.7358903296575828
tensor(0.7331, dtype=torch.float64) 0.7288042058456113
tensor(0.7269, dtype=torch.float64) 0.7230593683435185
tensor(0.7232, dtype=torch.float64) 0.7193744625851941
tensor(0.7257, dtype=torch.float64) 0.721882756416013
tensor(0.7343, dtype=torch.float64) 0.7308719366706804
tensor(0.7417, dtype=torch.float64) 0.7386146343444809
tensor(0.7478, dtype=torch.float64) 0.7462445451490536
tensor(0.7614, dtype=torch.float64) 0.7607716241068545
tensor(0.7651, dtype=torch.float64) 0.7657941673371732
tensor(0.7614, dtype=torch.float64) 0.7625152440273972
tensor(0.7589, dtype=torch.float64) 0.7598955269336094
tensor(0.7552, dtype=torch.float64) 0.7557069182766032
tensor(0.7540, dtype=torch.float64) 0.7544023016973481
tensor(0.7503, dtype=torch.float64) 0.7510353521141181
tensor(0.7503, dtype=torch.float64) 0.7508312641269621
tensor(0.7503, dtype=torch.float64) 0.7504375076706962
tensor(0.7552, dtype=torch.float64) 0.7551644401642188
 13%|█▎        | 38/300 [00:00<00:01, 184.15it/s]tensor(0.7552, dtype=torch.float64) 0.7550847168686416
tensor(0.7540, dtype=torch.float64) 0.7537002791767479
tensor(0.7589, dtype=torch.float64) 0.7587879852493539
tensor(0.7577, dtype=torch.float64) 0.7573730005014113
tensor(0.7565, dtype=torch.float64) 0.7556583889703558
tensor(0.7565, dtype=torch.float64) 0.755560257943483
tensor(0.7552, dtype=torch.float64) 0.7543121523773019
tensor(0.7565, dtype=torch.float64) 0.7555612446483603
tensor(0.7589, dtype=torch.float64) 0.7581368427378987
tensor(0.7651, dtype=torch.float64) 0.7645277568231281
tensor(0.7651, dtype=torch.float64) 0.764259194659249
tensor(0.7651, dtype=torch.float64) 0.7642716213139976
tensor(0.7626, dtype=torch.float64) 0.7618512810925518
tensor(0.7626, dtype=torch.float64) 0.76228070268014
tensor(0.7601, dtype=torch.float64) 0.7599485866521234
tensor(0.7589, dtype=torch.float64) 0.758872178744973
tensor(0.7565, dtype=torch.float64) 0.7563387931242533
tensor(0.7540, dtype=torch.float64) 0.7537350217906242
tensor(0.7577, dtype=torch.float64) 0.757468342096606
 19%|█▉        | 57/300 [00:00<00:01, 177.41it/s]tensor(0.7540, dtype=torch.float64) 0.7538410740582293
tensor(0.7552, dtype=torch.float64) 0.7550576162896784
tensor(0.7565, dtype=torch.float64) 0.7561150136182562
tensor(0.7540, dtype=torch.float64) 0.7534512671836197
tensor(0.7515, dtype=torch.float64) 0.7508770665015588
tensor(0.7565, dtype=torch.float64) 0.755808955092561
tensor(0.7565, dtype=torch.float64) 0.7557451030799917
tensor(0.7577, dtype=torch.float64) 0.7567265979373963
tensor(0.7589, dtype=torch.float64) 0.7578190337694853
tensor(0.7552, dtype=torch.float64) 0.7540702169808777
tensor(0.7589, dtype=torch.float64) 0.7579127854422992
tensor(0.7601, dtype=torch.float64) 0.7591935264384587
tensor(0.7614, dtype=torch.float64) 0.7605413186866913
tensor(0.7601, dtype=torch.float64) 0.7592371285225749
tensor(0.7589, dtype=torch.float64) 0.7581784207454911
tensor(0.7565, dtype=torch.float64) 0.7556328064406752
tensor(0.7577, dtype=torch.float64) 0.7568715338662914
tensor(0.7577, dtype=torch.float64) 0.7569781712316627
tensor(0.7565, dtype=torch.float64) 0.7558336002677855
tensor(0.7540, dtype=torch.float64) 0.7535105759523449
 26%|██▌       | 77/300 [00:00<00:01, 185.63it/s]tensor(0.7515, dtype=torch.float64) 0.750923051944748
tensor(0.7552, dtype=torch.float64) 0.7546135301301171
tensor(0.7589, dtype=torch.float64) 0.7582054903416121
tensor(0.7552, dtype=torch.float64) 0.7545535219543522
tensor(0.7552, dtype=torch.float64) 0.7544007834027288
tensor(0.7565, dtype=torch.float64) 0.75567752058506
tensor(0.7589, dtype=torch.float64) 0.757986858657965
tensor(0.7614, dtype=torch.float64) 0.7604016004519912
tensor(0.7577, dtype=torch.float64) 0.7569572462337044
tensor(0.7589, dtype=torch.float64) 0.7581351694686392
tensor(0.7577, dtype=torch.float64) 0.7567476417455796
tensor(0.7565, dtype=torch.float64) 0.7555204476832937
tensor(0.7552, dtype=torch.float64) 0.7541885737995464
tensor(0.7565, dtype=torch.float64) 0.755387835426249
tensor(0.7565, dtype=torch.float64) 0.7555317746653485
tensor(0.7577, dtype=torch.float64) 0.7568141954737784
tensor(0.7577, dtype=torch.float64) 0.7570401708452158
tensor(0.7565, dtype=torch.float64) 0.7558993469524898
tensor(0.7540, dtype=torch.float64) 0.7537198234793985
 32%|███▏      | 96/300 [00:00<00:01, 185.80it/s]tensor(0.7528, dtype=torch.float64) 0.7524457205712647
tensor(0.7540, dtype=torch.float64) 0.7535625252747652
tensor(0.7552, dtype=torch.float64) 0.7548271795410894
tensor(0.7565, dtype=torch.float64) 0.7555792470262155
tensor(0.7601, dtype=torch.float64) 0.7590964396596265
tensor(0.7577, dtype=torch.float64) 0.7563825281124552
tensor(0.7577, dtype=torch.float64) 0.7564107039133752
tensor(0.7589, dtype=torch.float64) 0.7578983476850415
tensor(0.7589, dtype=torch.float64) 0.7581144627568365
tensor(0.7589, dtype=torch.float64) 0.7584625466705784
tensor(0.7577, dtype=torch.float64) 0.7573205016860903
tensor(0.7565, dtype=torch.float64) 0.7560875324378679
tensor(0.7565, dtype=torch.float64) 0.7560875324378679
tensor(0.7552, dtype=torch.float64) 0.7546334853019291
tensor(0.7565, dtype=torch.float64) 0.7552975089647453
tensor(0.7540, dtype=torch.float64) 0.7527608676999462
tensor(0.7540, dtype=torch.float64) 0.7529622656256684
tensor(0.7528, dtype=torch.float64) 0.7517388743166853
tensor(0.7528, dtype=torch.float64) 0.7520831583020767
 38%|███▊      | 115/300 [00:00<00:01, 178.71it/s]tensor(0.7503, dtype=torch.float64) 0.7495930380313663
tensor(0.7503, dtype=torch.float64) 0.7497957258079238
tensor(0.7528, dtype=torch.float64) 0.7523211926542768
tensor(0.7528, dtype=torch.float64) 0.7520631370108666
tensor(0.7528, dtype=torch.float64) 0.7517334414785583
tensor(0.7503, dtype=torch.float64) 0.7490320902631484
tensor(0.7478, dtype=torch.float64) 0.7466446562029982
tensor(0.7503, dtype=torch.float64) 0.7491557870054896
tensor(0.7515, dtype=torch.float64) 0.750533893718875
tensor(0.7503, dtype=torch.float64) 0.7493682653958486
tensor(0.7491, dtype=torch.float64) 0.7482622813369478
tensor(0.7503, dtype=torch.float64) 0.74944648969058
tensor(0.7478, dtype=torch.float64) 0.7468963492526648
tensor(0.7491, dtype=torch.float64) 0.7479314236756213
tensor(0.7515, dtype=torch.float64) 0.7502527354450592
tensor(0.7515, dtype=torch.float64) 0.7502527354450592
tensor(0.7528, dtype=torch.float64) 0.7514284411613839
tensor(0.7515, dtype=torch.float64) 0.7505142652424016
tensor(0.7515, dtype=torch.float64) 0.7507357782491556
tensor(0.7491, dtype=torch.float64) 0.7483338470874232
 45%|████▌     | 135/300 [00:00<00:00, 184.78it/s]tensor(0.7491, dtype=torch.float64) 0.748077611844916
tensor(0.7491, dtype=torch.float64) 0.7478015729046926
tensor(0.7503, dtype=torch.float64) 0.7491438855695997
tensor(0.7491, dtype=torch.float64) 0.7480049191457147
tensor(0.7478, dtype=torch.float64) 0.7468770478667046
tensor(0.7466, dtype=torch.float64) 0.7451166985636236
tensor(0.7466, dtype=torch.float64) 0.74509786139061
tensor(0.7466, dtype=torch.float64) 0.7452118359225387
tensor(0.7454, dtype=torch.float64) 0.7442288677395378
tensor(0.7429, dtype=torch.float64) 0.7416598929828108
tensor(0.7429, dtype=torch.float64) 0.7414068498221804
tensor(0.7466, dtype=torch.float64) 0.7453383340920156
tensor(0.7466, dtype=torch.float64) 0.7456069351436238
tensor(0.7466, dtype=torch.float64) 0.7456879421587116
tensor(0.7478, dtype=torch.float64) 0.7470177604403877
tensor(0.7466, dtype=torch.float64) 0.7454189972087789
tensor(0.7466, dtype=torch.float64) 0.745806486981656
tensor(0.7454, dtype=torch.float64) 0.7448995315141067
tensor(0.7429, dtype=torch.float64) 0.7427310580309693
tensor(0.7429, dtype=torch.float64) 0.7423829241629037
tensor(0.7454, dtype=torch.float64) 0.7442867500460828
 52%|█████▏    | 156/300 [00:00<00:00, 190.17it/s]tensor(0.7429, dtype=torch.float64) 0.7411579340282884
tensor(0.7442, dtype=torch.float64) 0.7427006869417314
tensor(0.7405, dtype=torch.float64) 0.7404844590232915
tensor(0.7429, dtype=torch.float64) 0.74379303125666
tensor(0.7442, dtype=torch.float64) 0.7435212934490715
tensor(0.7442, dtype=torch.float64) 0.7430121547592285
tensor(0.7429, dtype=torch.float64) 0.741299474747463
tensor(0.7392, dtype=torch.float64) 0.7388900594233943
tensor(0.7405, dtype=torch.float64) 0.7407180296288581
tensor(0.7392, dtype=torch.float64) 0.7382709502361533
tensor(0.7355, dtype=torch.float64) 0.7337405834447255
tensor(0.7319, dtype=torch.float64) 0.7302336035223357
tensor(0.7368, dtype=torch.float64) 0.7358232249108368
tensor(0.7380, dtype=torch.float64) 0.7372814472593269
tensor(0.7405, dtype=torch.float64) 0.7396124867149916
tensor(0.7355, dtype=torch.float64) 0.7343992374640901
tensor(0.7343, dtype=torch.float64) 0.7330850611693673
tensor(0.7380, dtype=torch.float64) 0.7372940391774929
tensor(0.7392, dtype=torch.float64) 0.7394025665348255
tensor(0.7454, dtype=torch.float64) 0.7453436837391523
tensor(0.7405, dtype=torch.float64) 0.7388774234100695
 59%|█████▉    | 177/300 [00:00<00:00, 194.23it/s]tensor(0.7405, dtype=torch.float64) 0.7381524932163042
tensor(0.7343, dtype=torch.float64) 0.7321366470467346
tensor(0.7392, dtype=torch.float64) 0.7380131061624348
tensor(0.7392, dtype=torch.float64) 0.7391314401960147
tensor(0.7442, dtype=torch.float64) 0.7435422210644314
tensor(0.7405, dtype=torch.float64) 0.7389467439328179
tensor(0.7405, dtype=torch.float64) 0.7388170132913645
tensor(0.7331, dtype=torch.float64) 0.731186364617593
tensor(0.7306, dtype=torch.float64) 0.7292622847727435
tensor(0.7331, dtype=torch.float64) 0.7326870224881675
tensor(0.7355, dtype=torch.float64) 0.735212529664811
tensor(0.7392, dtype=torch.float64) 0.7387136593245176
tensor(0.7392, dtype=torch.float64) 0.7381580983940967
tensor(0.7343, dtype=torch.float64) 0.7327410897066842
tensor(0.7343, dtype=torch.float64) 0.7328494388594335
tensor(0.7306, dtype=torch.float64) 0.7291248234128179
tensor(0.7343, dtype=torch.float64) 0.7332299347022688
tensor(0.7380, dtype=torch.float64) 0.7373793908504642
tensor(0.7442, dtype=torch.float64) 0.7433856347373948
tensor(0.7405, dtype=torch.float64) 0.7399167142388517
tensor(0.7368, dtype=torch.float64) 0.7365003688541186
 66%|██████▌   | 198/300 [00:01<00:00, 196.72it/s]tensor(0.7343, dtype=torch.float64) 0.7339012758780645
tensor(0.7319, dtype=torch.float64) 0.7308408229744435
tensor(0.7294, dtype=torch.float64) 0.7279961697786732
tensor(0.7343, dtype=torch.float64) 0.7322432882708276
tensor(0.7380, dtype=torch.float64) 0.7362700918610267
tensor(0.7429, dtype=torch.float64) 0.7416088960887287
tensor(0.7454, dtype=torch.float64) 0.7449020739614346
tensor(0.7429, dtype=torch.float64) 0.7426936617059473
tensor(0.7368, dtype=torch.float64) 0.736350266960765
tensor(0.7355, dtype=torch.float64) 0.734886136414285
tensor(0.7405, dtype=torch.float64) 0.7397282507932434
tensor(0.7392, dtype=torch.float64) 0.7384321392529143
tensor(0.7380, dtype=torch.float64) 0.7373801196335644
tensor(0.7368, dtype=torch.float64) 0.7357966889865298
tensor(0.7405, dtype=torch.float64) 0.739085693390665
tensor(0.7331, dtype=torch.float64) 0.7310324087787623
tensor(0.7392, dtype=torch.float64) 0.7384067922020084
tensor(0.7380, dtype=torch.float64) 0.7383692822496086
tensor(0.7392, dtype=torch.float64) 0.7391453092270467
tensor(0.7331, dtype=torch.float64) 0.7323421676435237
tensor(0.7331, dtype=torch.float64) 0.7319632049220236
 73%|███████▎  | 219/300 [00:01<00:00, 197.16it/s]tensor(0.7319, dtype=torch.float64) 0.7314129865383466
tensor(0.7392, dtype=torch.float64) 0.7390471642326767
tensor(0.7331, dtype=torch.float64) 0.7316012756526039
tensor(0.7319, dtype=torch.float64) 0.730100568824253
tensor(0.7282, dtype=torch.float64) 0.7274686733064362
tensor(0.7269, dtype=torch.float64) 0.7274379959949739
tensor(0.7306, dtype=torch.float64) 0.7311192401453437
tensor(0.7331, dtype=torch.float64) 0.7319886938638062
tensor(0.7232, dtype=torch.float64) 0.7209257193740496
tensor(0.7319, dtype=torch.float64) 0.7303745225301159
tensor(0.7331, dtype=torch.float64) 0.7319191892089121
tensor(0.7380, dtype=torch.float64) 0.7379283821058602
tensor(0.7343, dtype=torch.float64) 0.7334130543260725
tensor(0.7319, dtype=torch.float64) 0.7291486937355546
tensor(0.7368, dtype=torch.float64) 0.7358046922186626
tensor(0.7355, dtype=torch.float64) 0.7354934128384206
tensor(0.7380, dtype=torch.float64) 0.7381250222731123
tensor(0.7392, dtype=torch.float64) 0.7383019712210889
tensor(0.7319, dtype=torch.float64) 0.7298428805687655
tensor(0.7368, dtype=torch.float64) 0.7350912740883336
tensor(0.7294, dtype=torch.float64) 0.7286526365666051
 80%|████████  | 240/300 [00:01<00:00, 199.07it/s]tensor(0.7355, dtype=torch.float64) 0.7353793067322193
tensor(0.7405, dtype=torch.float64) 0.7397080238676967
tensor(0.7442, dtype=torch.float64) 0.742590070254849
tensor(0.7429, dtype=torch.float64) 0.7418313817072852
tensor(0.7355, dtype=torch.float64) 0.7349248169293556
tensor(0.7343, dtype=torch.float64) 0.7337808022441441
tensor(0.7380, dtype=torch.float64) 0.7372612458774962
tensor(0.7368, dtype=torch.float64) 0.7358877708567413
tensor(0.7392, dtype=torch.float64) 0.7376371416513217
tensor(0.7380, dtype=torch.float64) 0.7359680662055683
tensor(0.7343, dtype=torch.float64) 0.7326847443477886
tensor(0.7294, dtype=torch.float64) 0.7285543695200143
tensor(0.7319, dtype=torch.float64) 0.7320017690188634
tensor(0.7368, dtype=torch.float64) 0.735903063525192
tensor(0.7294, dtype=torch.float64) 0.7283674879785274
tensor(0.7331, dtype=torch.float64) 0.7319538652112922
tensor(0.7319, dtype=torch.float64) 0.7308816688459729
tensor(0.7355, dtype=torch.float64) 0.7347174609746272
tensor(0.7380, dtype=torch.float64) 0.7371139120738759
tensor(0.7343, dtype=torch.float64) 0.7332119606783238
tensor(0.7331, dtype=torch.float64) 0.7318810068486824
 87%|████████▋ | 261/300 [00:01<00:00, 201.88it/s]tensor(0.7392, dtype=torch.float64) 0.7379750282776611
tensor(0.7417, dtype=torch.float64) 0.7416162751905444
tensor(0.7368, dtype=torch.float64) 0.7369182746585778
tensor(0.7368, dtype=torch.float64) 0.7355450634286377
tensor(0.7392, dtype=torch.float64) 0.7374860410200903
tensor(0.7380, dtype=torch.float64) 0.7366718118001265
tensor(0.7343, dtype=torch.float64) 0.7340659422031834
tensor(0.7331, dtype=torch.float64) 0.7328162003936773
tensor(0.7319, dtype=torch.float64) 0.7305313472243828
tensor(0.7355, dtype=torch.float64) 0.7341988840306833
tensor(0.7368, dtype=torch.float64) 0.7354013075509742
tensor(0.7343, dtype=torch.float64) 0.7337580164972403
tensor(0.7331, dtype=torch.float64) 0.7329773581970025
tensor(0.7319, dtype=torch.float64) 0.7315187481506561
tensor(0.7331, dtype=torch.float64) 0.7314751184110783
tensor(0.7368, dtype=torch.float64) 0.7353726063668944
tensor(0.7319, dtype=torch.float64) 0.7306183964702454
tensor(0.7319, dtype=torch.float64) 0.7320133067554313
tensor(0.7294, dtype=torch.float64) 0.7292561385788711
tensor(0.7319, dtype=torch.float64) 0.7307237211237246
tensor(0.7257, dtype=torch.float64) 0.7237609090770392
 94%|█████████▍| 282/300 [00:01<00:00, 193.75it/s]tensor(0.7245, dtype=torch.float64) 0.7233309842199165
tensor(0.7232, dtype=torch.float64) 0.7232252580346528
tensor(0.7232, dtype=torch.float64) 0.7226874955206437
tensor(0.7319, dtype=torch.float64) 0.7310889909846723
tensor(0.7306, dtype=torch.float64) 0.729592532653612
tensor(0.7257, dtype=torch.float64) 0.7250219113046051
tensor(0.7245, dtype=torch.float64) 0.7241723028359031
tensor(0.7257, dtype=torch.float64) 0.7255774841171795
tensor(0.7380, dtype=torch.float64) 0.7372270292993126
tensor(0.7319, dtype=torch.float64) 0.7296234461910971
tensor(0.7380, dtype=torch.float64) 0.7365722117379531
tensor(0.7331, dtype=torch.float64) 0.7324562867045984
tensor(0.7368, dtype=torch.float64) 0.7360098701821232
tensor(0.7368, dtype=torch.float64) 0.736766367651803
tensor(0.7380, dtype=torch.float64) 0.7380908006188336
tensor(0.7380, dtype=torch.float64) 0.7377306019353513
tensor(0.7343, dtype=torch.float64) 0.7341569731275478
tensor(0.7355, dtype=torch.float64) 0.7355563543795013
100%|██████████| 300/300 [00:01<00:00, 191.59it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 5863.08s
  Phase 2 Time: 1.57s
  Total Time: 5864.65s
  Best Accuracy: 0.7651
============================================================

usage: v_main_mpche.py [-h] [--no-cuda] [--client_num CLIENT_NUM]
                       [--dataSet DATASET] [--rate RATE] [--round1 ROUND1]
                       [--round2 ROUND2] [--epochs1 EPOCHS1]
                       [--epochs2 EPOCHS2] [--epochs3 EPOCHS3] [--lr LR]
                       [--c C] [--d D] [--cm CM] [--weight_decay WEIGHT_DECAY]
                       [--weight_decay1 WEIGHT_DECAY1] [--dropout DROPOUT]
                       [--alpha ALPHA] [--batch_size BATCH_SIZE]
                       [--hidden HIDDEN] [--r R] [--cuda]
v_main_mpche.py: error: argument --dataSet: expected one argument
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche.py", line 74, in <module>
    user_features,user_labels,client_adj,label_num,train_features,train_labels,test_features,test_labels,at_f,at_l,mpc_beaver=deal_dataset(client_num,args.rate,args.r)
  File "/home/lxt/project/MVFIGN/v_deal_mpche.py", line 157, in deal_dataset
    adj1=adj[train_index,:][:,train_index]
  File "/home/lxt/pytorch_env/lib/python3.9/site-packages/scipy/sparse/_index.py", line 52, in __getitem__
    row, col = self._validate_indices(key)
  File "/home/lxt/pytorch_env/lib/python3.9/site-packages/scipy/sparse/_index.py", line 186, in _validate_indices
    row = self._asindices(row, M)
  File "/home/lxt/pytorch_env/lib/python3.9/site-packages/scipy/sparse/_index.py", line 220, in _asindices
    raise IndexError('index (%d) out of range' % max_indx)
IndexError: index (19716) out of range
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(13801, 500), w(500, 500)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche.py", line 220, in <module>
    z_share = mpc_beaver.secure_matmul(
  File "/home/lxt/project/MVFIGN/crypto_utils.py", line 99, in secure_matmul
    alpha_share = x_share - a_share
RuntimeError: The size of tensor a (2048) must match the size of tensor b (13801) at non-singleton dimension 0
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(13801, 500), w(500, 500)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche.py", line 220, in <module>
    z_share = mpc_beaver.secure_matmul(
  File "/home/lxt/project/MVFIGN/crypto_utils.py", line 99, in secure_matmul
    alpha_share = x_share - a_share
RuntimeError: The size of tensor a (2048) must match the size of tensor b (13801) at non-singleton dimension 0
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0173s, output shape: torch.Size([1895, 1433])
tensor(0.4248, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0223, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/50, Loss: 0.4472
tensor(0.1880, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0189, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2168, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0130, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2241, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1671, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1071, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0068, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0930, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1120, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0078, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1223, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1049, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0333s, output shape: torch.Size([1895, 1433])
tensor(0.0779, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 10/50, Loss: 0.0868
tensor(0.0637, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0653, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0695, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0665, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0587, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0529, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0507, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0487, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0454, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0548s, output shape: torch.Size([1895, 1433])
tensor(0.0432, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 20/50, Loss: 0.0524
tensor(0.0434, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0435, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0407, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0364, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0342, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0350, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0359, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0345, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0386s, output shape: torch.Size([1895, 1433])
tensor(0.0308, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 30/50, Loss: 0.0397
tensor(0.0310, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0309, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0299, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0289, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0287, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0283, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0274, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0267, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0266, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0294s, output shape: torch.Size([1895, 1433])
tensor(0.0267, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 40/50, Loss: 0.0357
tensor(0.0262, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0254, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0251, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0252, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0249, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0245, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0242, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0240, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0239, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.03s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0117s, output shape: torch.Size([1895, 1433])
tensor(0.4197, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0206, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 0/50, Loss: 0.4403
tensor(0.1946, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0172, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2097, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0120, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.2241, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1725, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1093, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0064, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0901, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1092, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1226, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0077, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.1074, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0263s, output shape: torch.Size([1895, 1433])
tensor(0.0794, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 10/50, Loss: 0.0877
tensor(0.0627, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0632, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0684, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0670, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0598, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0532, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0498, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0473, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0446, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0317s, output shape: torch.Size([1895, 1433])
tensor(0.0432, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 20/50, Loss: 0.0518
tensor(0.0435, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0431, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0399, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0355, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0336, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0346, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0353, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0338, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0312, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0247s, output shape: torch.Size([1895, 1433])
tensor(0.0301, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 30/50, Loss: 0.0384
tensor(0.0304, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0303, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0291, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0281, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0278, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0276, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0267, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0259, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0257, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Performing MPC secure computation...
  [MPC] Secure computation completed in 0.0244s, output shape: torch.Size([1895, 1433])
tensor(0.0259, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  Round 40/50, Loss: 0.0343
tensor(0.0254, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0243, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0243, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0241, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0237, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0233, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0232, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
tensor(0.0230, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
WARNING: The input does not fit in a single ciphertext, and some operations will be disabled.
The following operations are disabled in this setup: matmul, matmul_plain, conv2d_im2col, replicate_first_slot.
If you need to use those operations, try increasing the poly_modulus parameter, to fit your input.
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.01s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 1442.60s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]tensor(0.3210, dtype=torch.float64) 0.24295800521318703
tensor(0.3850, dtype=torch.float64) 0.2465020052987576
tensor(0.4502, dtype=torch.float64) 0.3831296941134055
tensor(0.2522, dtype=torch.float64) 0.18692749179572504
tensor(0.3173, dtype=torch.float64) 0.2663681192263364
tensor(0.5043, dtype=torch.float64) 0.45109848661182683
tensor(0.5351, dtype=torch.float64) 0.4794561293992773
tensor(0.5830, dtype=torch.float64) 0.5353347267211374
tensor(0.3567, dtype=torch.float64) 0.32947999221271845
tensor(0.3948, dtype=torch.float64) 0.3729317586743025
tensor(0.5670, dtype=torch.float64) 0.5119518259480116
tensor(0.5793, dtype=torch.float64) 0.509311311826958
tensor(0.5560, dtype=torch.float64) 0.482172927709829
tensor(0.5560, dtype=torch.float64) 0.48664146221304766
tensor(0.5879, dtype=torch.float64) 0.5362058504533276
tensor(0.6113, dtype=torch.float64) 0.5669038070817942
tensor(0.6273, dtype=torch.float64) 0.5799071547165099
tensor(0.5941, dtype=torch.float64) 0.5558235275049435
tensor(0.6064, dtype=torch.float64) 0.5945597481896872
  6%|▋         | 19/300 [00:00<00:01, 188.31it/s]tensor(0.6667, dtype=torch.float64) 0.6592002616131005
tensor(0.6863, dtype=torch.float64) 0.6742119583077592
tensor(0.6851, dtype=torch.float64) 0.6817799065635458
tensor(0.6777, dtype=torch.float64) 0.6733160080006803
tensor(0.6999, dtype=torch.float64) 0.6908684173298992
tensor(0.7060, dtype=torch.float64) 0.6988631507721745
tensor(0.7208, dtype=torch.float64) 0.7156325037396211
tensor(0.7085, dtype=torch.float64) 0.7010231264398985
tensor(0.7023, dtype=torch.float64) 0.6922439217914834
tensor(0.6950, dtype=torch.float64) 0.6840264403352472
tensor(0.6900, dtype=torch.float64) 0.6783713890550213
tensor(0.7085, dtype=torch.float64) 0.6959894042808898
tensor(0.7171, dtype=torch.float64) 0.7014229776808851
tensor(0.7257, dtype=torch.float64) 0.7087277995877698
tensor(0.7282, dtype=torch.float64) 0.7162071453052535
tensor(0.7319, dtype=torch.float64) 0.7212635194776826
tensor(0.7380, dtype=torch.float64) 0.7308063736784127
tensor(0.7442, dtype=torch.float64) 0.7385157949650569
tensor(0.7552, dtype=torch.float64) 0.752764934922614
tensor(0.7589, dtype=torch.float64) 0.7579641243783563
tensor(0.7663, dtype=torch.float64) 0.7669822376203803
 13%|█▎        | 40/300 [00:00<00:01, 195.60it/s]tensor(0.7663, dtype=torch.float64) 0.7675987353717014
tensor(0.7638, dtype=torch.float64) 0.7644697846924434
tensor(0.7589, dtype=torch.float64) 0.759541722567129
tensor(0.7601, dtype=torch.float64) 0.7593369175166097
tensor(0.7601, dtype=torch.float64) 0.7586271300409428
tensor(0.7552, dtype=torch.float64) 0.7525683294771498
tensor(0.7589, dtype=torch.float64) 0.7547897449639949
tensor(0.7577, dtype=torch.float64) 0.7535201377632494
tensor(0.7651, dtype=torch.float64) 0.7610055496403093
tensor(0.7700, dtype=torch.float64) 0.7662157540610219
tensor(0.7688, dtype=torch.float64) 0.7652158546797899
tensor(0.7700, dtype=torch.float64) 0.7665610883624514
tensor(0.7724, dtype=torch.float64) 0.7697200018776555
tensor(0.7737, dtype=torch.float64) 0.771035611273904
tensor(0.7761, dtype=torch.float64) 0.7743412934064852
tensor(0.7737, dtype=torch.float64) 0.772301277208145
tensor(0.7761, dtype=torch.float64) 0.7754624687167854
tensor(0.7737, dtype=torch.float64) 0.7734935204577555
tensor(0.7737, dtype=torch.float64) 0.7734452003067283
tensor(0.7700, dtype=torch.float64) 0.7699726748534326
tensor(0.7700, dtype=torch.float64) 0.769771864439329
 20%|██        | 61/300 [00:00<00:01, 198.34it/s]tensor(0.7675, dtype=torch.float64) 0.7668978028065349
tensor(0.7724, dtype=torch.float64) 0.7714193222897718
tensor(0.7786, dtype=torch.float64) 0.7768185739918224
tensor(0.7811, dtype=torch.float64) 0.7791579796311304
tensor(0.7811, dtype=torch.float64) 0.7788501334004184
tensor(0.7798, dtype=torch.float64) 0.7774056610333321
tensor(0.7786, dtype=torch.float64) 0.7765599438583445
tensor(0.7835, dtype=torch.float64) 0.7820547877869901
tensor(0.7823, dtype=torch.float64) 0.7814080523218214
tensor(0.7811, dtype=torch.float64) 0.7802862871229022
tensor(0.7811, dtype=torch.float64) 0.7803995955737311
tensor(0.7847, dtype=torch.float64) 0.7841589437194068
tensor(0.7847, dtype=torch.float64) 0.7841943094823154
tensor(0.7860, dtype=torch.float64) 0.7853028378054477
tensor(0.7847, dtype=torch.float64) 0.7840682405912219
tensor(0.7823, dtype=torch.float64) 0.7810912245547172
tensor(0.7774, dtype=torch.float64) 0.7762228618270178
tensor(0.7749, dtype=torch.float64) 0.7733620670418422
tensor(0.7737, dtype=torch.float64) 0.771858967468579
tensor(0.7724, dtype=torch.float64) 0.7700615816139181
tensor(0.7761, dtype=torch.float64) 0.7737702164559211
 27%|██▋       | 82/300 [00:00<00:01, 200.78it/s]tensor(0.7786, dtype=torch.float64) 0.776280391924843
tensor(0.7786, dtype=torch.float64) 0.7763139179480845
tensor(0.7798, dtype=torch.float64) 0.7778460922888021
tensor(0.7786, dtype=torch.float64) 0.7770418585698088
tensor(0.7774, dtype=torch.float64) 0.7758696046866334
tensor(0.7774, dtype=torch.float64) 0.7757809457105964
tensor(0.7786, dtype=torch.float64) 0.7768745837370397
tensor(0.7724, dtype=torch.float64) 0.7706924172876315
tensor(0.7737, dtype=torch.float64) 0.7720103983904688
tensor(0.7761, dtype=torch.float64) 0.7746422503899562
tensor(0.7761, dtype=torch.float64) 0.7747292611239633
tensor(0.7774, dtype=torch.float64) 0.7759349525260459
tensor(0.7761, dtype=torch.float64) 0.7745890855189266
tensor(0.7749, dtype=torch.float64) 0.7733818365245736
tensor(0.7761, dtype=torch.float64) 0.7745900611336388
tensor(0.7737, dtype=torch.float64) 0.7722392753281485
tensor(0.7749, dtype=torch.float64) 0.7734166507512423
tensor(0.7761, dtype=torch.float64) 0.774657047082849
tensor(0.7749, dtype=torch.float64) 0.7730608479693858
tensor(0.7761, dtype=torch.float64) 0.7744586701752594
tensor(0.7786, dtype=torch.float64) 0.7775124001036934
 34%|███▍      | 103/300 [00:00<00:00, 203.56it/s]tensor(0.7761, dtype=torch.float64) 0.7748360050781072
tensor(0.7749, dtype=torch.float64) 0.7734500640791673
tensor(0.7700, dtype=torch.float64) 0.7683701656715032
tensor(0.7724, dtype=torch.float64) 0.7707488819272256
tensor(0.7737, dtype=torch.float64) 0.7720169767161207
tensor(0.7749, dtype=torch.float64) 0.7734196150439145
tensor(0.7737, dtype=torch.float64) 0.7721988876706543
tensor(0.7786, dtype=torch.float64) 0.7771324871998236
tensor(0.7786, dtype=torch.float64) 0.7773455493236846
tensor(0.7761, dtype=torch.float64) 0.7749747561751072
tensor(0.7724, dtype=torch.float64) 0.7711353619804237
tensor(0.7737, dtype=torch.float64) 0.772345550301841
tensor(0.7724, dtype=torch.float64) 0.7707296952247928
tensor(0.7688, dtype=torch.float64) 0.7675548727429816
tensor(0.7724, dtype=torch.float64) 0.7709088582582151
tensor(0.7712, dtype=torch.float64) 0.7694151587988872
tensor(0.7700, dtype=torch.float64) 0.7681448756316651
tensor(0.7712, dtype=torch.float64) 0.7694062200094047
tensor(0.7737, dtype=torch.float64) 0.7722485480025972
tensor(0.7651, dtype=torch.float64) 0.7646125205760874
tensor(0.7712, dtype=torch.float64) 0.7699674257687842
 41%|████▏     | 124/300 [00:00<00:00, 205.23it/s]tensor(0.7774, dtype=torch.float64) 0.7756426873275905
tensor(0.7786, dtype=torch.float64) 0.7766211477266263
tensor(0.7737, dtype=torch.float64) 0.7714886213067649
tensor(0.7712, dtype=torch.float64) 0.7695003217183999
tensor(0.7737, dtype=torch.float64) 0.7719225308865068
tensor(0.7724, dtype=torch.float64) 0.7710763822389413
tensor(0.7712, dtype=torch.float64) 0.7703996455467151
tensor(0.7663, dtype=torch.float64) 0.7649330258041063
tensor(0.7749, dtype=torch.float64) 0.7725947353211946
tensor(0.7749, dtype=torch.float64) 0.7726418936246381
tensor(0.7712, dtype=torch.float64) 0.769008971307227
tensor(0.7700, dtype=torch.float64) 0.768213685742537
tensor(0.7724, dtype=torch.float64) 0.7713733450677585
tensor(0.7712, dtype=torch.float64) 0.770606254695138
tensor(0.7663, dtype=torch.float64) 0.7658652465566804
tensor(0.7626, dtype=torch.float64) 0.7616695962362436
tensor(0.7724, dtype=torch.float64) 0.7700835290496306
tensor(0.7651, dtype=torch.float64) 0.7632036618469573
tensor(0.7614, dtype=torch.float64) 0.7597786451103623
tensor(0.7737, dtype=torch.float64) 0.7717322546190621
tensor(0.7675, dtype=torch.float64) 0.7672376101830594
 48%|████▊     | 145/300 [00:00<00:00, 205.78it/s]tensor(0.7737, dtype=torch.float64) 0.772869392180926
tensor(0.7700, dtype=torch.float64) 0.7686419718033479
tensor(0.7675, dtype=torch.float64) 0.7669308368572186
tensor(0.7663, dtype=torch.float64) 0.7659909507319617
tensor(0.7675, dtype=torch.float64) 0.765683721249595
tensor(0.7552, dtype=torch.float64) 0.7544049678132826
tensor(0.7651, dtype=torch.float64) 0.7636336046981487
tensor(0.7638, dtype=torch.float64) 0.7634798038269909
tensor(0.7577, dtype=torch.float64) 0.7575279416583571
tensor(0.7651, dtype=torch.float64) 0.7633765277679586
tensor(0.7626, dtype=torch.float64) 0.759708246450758
tensor(0.7540, dtype=torch.float64) 0.7520919812697179
tensor(0.7688, dtype=torch.float64) 0.7672120689469359
tensor(0.7651, dtype=torch.float64) 0.7641815243723543
tensor(0.7626, dtype=torch.float64) 0.7629272679910004
tensor(0.7601, dtype=torch.float64) 0.7601403314577249
tensor(0.7737, dtype=torch.float64) 0.7715503372314321
tensor(0.7700, dtype=torch.float64) 0.7689071810947541
tensor(0.7651, dtype=torch.float64) 0.7644588191540022
tensor(0.7589, dtype=torch.float64) 0.7582182417888712
tensor(0.7577, dtype=torch.float64) 0.757456018029818
 55%|█████▌    | 166/300 [00:00<00:00, 195.70it/s]tensor(0.7651, dtype=torch.float64) 0.764650880518822
tensor(0.7626, dtype=torch.float64) 0.7614785530881558
tensor(0.7626, dtype=torch.float64) 0.761541919263911
tensor(0.7528, dtype=torch.float64) 0.7529474701033573
tensor(0.7589, dtype=torch.float64) 0.7592282336207873
tensor(0.7515, dtype=torch.float64) 0.7515188634058674
tensor(0.7638, dtype=torch.float64) 0.7622976733744313
tensor(0.7675, dtype=torch.float64) 0.7665719887858842
tensor(0.7651, dtype=torch.float64) 0.7651442752681231
tensor(0.7528, dtype=torch.float64) 0.7501203248932367
tensor(0.7368, dtype=torch.float64) 0.7359302407512274
tensor(0.7528, dtype=torch.float64) 0.7495836789075327
tensor(0.7491, dtype=torch.float64) 0.7498898320550971
tensor(0.7552, dtype=torch.float64) 0.7556850712503703
tensor(0.7454, dtype=torch.float64) 0.7412048742380551
tensor(0.7478, dtype=torch.float64) 0.7461592548157548
tensor(0.7528, dtype=torch.float64) 0.7533918533502796
tensor(0.7515, dtype=torch.float64) 0.7510364180477525
tensor(0.7601, dtype=torch.float64) 0.7600887697525508
tensor(0.7503, dtype=torch.float64) 0.7518475017441388
 62%|██████▏   | 186/300 [00:00<00:00, 187.98it/s]tensor(0.7601, dtype=torch.float64) 0.758548921679691
tensor(0.7663, dtype=torch.float64) 0.7633298443092555
tensor(0.7663, dtype=torch.float64) 0.7629382077710445
tensor(0.7688, dtype=torch.float64) 0.7685659161300924
tensor(0.7565, dtype=torch.float64) 0.7575771271630147
tensor(0.7688, dtype=torch.float64) 0.7677780419621227
tensor(0.7626, dtype=torch.float64) 0.7593214187504516
tensor(0.7663, dtype=torch.float64) 0.7643701880687589
tensor(0.7638, dtype=torch.float64) 0.763343666292992
tensor(0.7577, dtype=torch.float64) 0.7578225500565358
tensor(0.7675, dtype=torch.float64) 0.7673572619872345
tensor(0.7651, dtype=torch.float64) 0.7655186409607193
tensor(0.7651, dtype=torch.float64) 0.7648100041018576
tensor(0.7712, dtype=torch.float64) 0.7694974654324547
tensor(0.7675, dtype=torch.float64) 0.7662037273800926
tensor(0.7700, dtype=torch.float64) 0.7695326747454043
tensor(0.7675, dtype=torch.float64) 0.7672831967888081
tensor(0.7651, dtype=torch.float64) 0.7640796016281973
tensor(0.7663, dtype=torch.float64) 0.7648828509217552
tensor(0.7700, dtype=torch.float64) 0.7675407897510995
tensor(0.7700, dtype=torch.float64) 0.7682458412045636
 69%|██████▉   | 207/300 [00:01<00:00, 194.20it/s]tensor(0.7626, dtype=torch.float64) 0.7629190959256227
tensor(0.7614, dtype=torch.float64) 0.7618948580606731
tensor(0.7614, dtype=torch.float64) 0.760947489657535
tensor(0.7663, dtype=torch.float64) 0.765381809821641
tensor(0.7638, dtype=torch.float64) 0.7627360281574056
tensor(0.7749, dtype=torch.float64) 0.7744737681325833
tensor(0.7700, dtype=torch.float64) 0.7692370149348073
tensor(0.7675, dtype=torch.float64) 0.7662138260560492
tensor(0.7712, dtype=torch.float64) 0.7715995293631766
tensor(0.7675, dtype=torch.float64) 0.7683665458375504
tensor(0.7737, dtype=torch.float64) 0.7733090345503763
tensor(0.7663, dtype=torch.float64) 0.763740608671009
tensor(0.7700, dtype=torch.float64) 0.7684098615097469
tensor(0.7651, dtype=torch.float64) 0.76466050723275
tensor(0.7712, dtype=torch.float64) 0.7710954266160003
tensor(0.7712, dtype=torch.float64) 0.7708491670410071
tensor(0.7614, dtype=torch.float64) 0.7617060253530332
tensor(0.7663, dtype=torch.float64) 0.7663872993019123
tensor(0.7638, dtype=torch.float64) 0.7625503360998163
tensor(0.7651, dtype=torch.float64) 0.7631319508693404
tensor(0.7688, dtype=torch.float64) 0.7677419764811773
 76%|███████▌  | 228/300 [00:01<00:00, 196.35it/s]tensor(0.7638, dtype=torch.float64) 0.7633144164342228
tensor(0.7663, dtype=torch.float64) 0.7655371511474856
tensor(0.7565, dtype=torch.float64) 0.7557810960108288
tensor(0.7638, dtype=torch.float64) 0.7642922278875828
tensor(0.7663, dtype=torch.float64) 0.7658550455387847
tensor(0.7601, dtype=torch.float64) 0.7583450197540844
tensor(0.7638, dtype=torch.float64) 0.7640339131445741
tensor(0.7626, dtype=torch.float64) 0.7628448362993756
tensor(0.7712, dtype=torch.float64) 0.7705396549786593
tensor(0.7712, dtype=torch.float64) 0.7707107127223489
tensor(0.7761, dtype=torch.float64) 0.7757808959880975
tensor(0.7712, dtype=torch.float64) 0.77067994436112
tensor(0.7737, dtype=torch.float64) 0.7731376132550893
tensor(0.7724, dtype=torch.float64) 0.77036891681857
tensor(0.7737, dtype=torch.float64) 0.7725379548048571
tensor(0.7589, dtype=torch.float64) 0.7576653902543053
tensor(0.7688, dtype=torch.float64) 0.7693075568538106
tensor(0.7601, dtype=torch.float64) 0.7602039416690967
tensor(0.7663, dtype=torch.float64) 0.7648430706420266
tensor(0.7565, dtype=torch.float64) 0.7563921306108717
tensor(0.7712, dtype=torch.float64) 0.7705209496631799
 83%|████████▎ | 249/300 [00:01<00:00, 199.61it/s]tensor(0.7601, dtype=torch.float64) 0.7597349861483342
tensor(0.7577, dtype=torch.float64) 0.757083158732317
tensor(0.7552, dtype=torch.float64) 0.7549123610030929
tensor(0.7528, dtype=torch.float64) 0.7519422419260727
tensor(0.7528, dtype=torch.float64) 0.7533867479199289
tensor(0.7565, dtype=torch.float64) 0.7553015282111862
tensor(0.7651, dtype=torch.float64) 0.763529474523397
tensor(0.7540, dtype=torch.float64) 0.7551409345733054
tensor(0.7552, dtype=torch.float64) 0.754768254512468
tensor(0.7601, dtype=torch.float64) 0.7580184708581217
tensor(0.7589, dtype=torch.float64) 0.7569421019629256
tensor(0.7601, dtype=torch.float64) 0.7579669483295116
tensor(0.7565, dtype=torch.float64) 0.7570791712583393
tensor(0.7429, dtype=torch.float64) 0.747645183424147
tensor(0.7565, dtype=torch.float64) 0.752681340656726
tensor(0.7442, dtype=torch.float64) 0.7415209469386291
tensor(0.7601, dtype=torch.float64) 0.7610587997591068
tensor(0.7368, dtype=torch.float64) 0.7388702033726308
tensor(0.7601, dtype=torch.float64) 0.7585713300750981
tensor(0.7466, dtype=torch.float64) 0.7436725301693942
tensor(0.7478, dtype=torch.float64) 0.748325168755986
tensor(0.7466, dtype=torch.float64) 0.7471608754612769
 90%|█████████ | 271/300 [00:01<00:00, 203.07it/s]tensor(0.7392, dtype=torch.float64) 0.7377346561814823
tensor(0.7540, dtype=torch.float64) 0.7527324771880562
tensor(0.7466, dtype=torch.float64) 0.7455775461877113
tensor(0.7466, dtype=torch.float64) 0.7456139230253039
tensor(0.7417, dtype=torch.float64) 0.7402497450808849
tensor(0.7503, dtype=torch.float64) 0.7490594683281454
tensor(0.7577, dtype=torch.float64) 0.7578033290995942
tensor(0.7577, dtype=torch.float64) 0.755170077888612
tensor(0.7614, dtype=torch.float64) 0.759960174573961
tensor(0.7552, dtype=torch.float64) 0.7549304551127196
tensor(0.7454, dtype=torch.float64) 0.7456169425806765
tensor(0.7675, dtype=torch.float64) 0.7643192176284745
tensor(0.7749, dtype=torch.float64) 0.7730142426304866
tensor(0.7466, dtype=torch.float64) 0.7472406800146705
tensor(0.7515, dtype=torch.float64) 0.7518474587423025
tensor(0.7601, dtype=torch.float64) 0.7595076582839612
tensor(0.7626, dtype=torch.float64) 0.7607395846492421
tensor(0.7663, dtype=torch.float64) 0.7641699035893444
tensor(0.7638, dtype=torch.float64) 0.7635106244654517
tensor(0.7442, dtype=torch.float64) 0.745892462010962
tensor(0.7552, dtype=torch.float64) 0.7561373465359992
tensor(0.7614, dtype=torch.float64) 0.7597446688105594
 98%|█████████▊| 293/300 [00:01<00:00, 205.47it/s]tensor(0.7663, dtype=torch.float64) 0.7626832601730172
tensor(0.7565, dtype=torch.float64) 0.7534427281003157
tensor(0.7528, dtype=torch.float64) 0.7533898168459007
tensor(0.7478, dtype=torch.float64) 0.7508501557307664
tensor(0.7540, dtype=torch.float64) 0.755237936117951
tensor(0.7688, dtype=torch.float64) 0.766862630781222
tensor(0.7614, dtype=torch.float64) 0.7562555900334494
100%|██████████| 300/300 [00:01<00:00, 200.32it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 1442.60s
  Phase 2 Time: 1.50s
  Total Time: 1444.10s
  Best Accuracy: 0.7860
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 287, in <module>
    global_features = algorithm_2_global_feature_init(user_features, local_model, mpc_beaver, client_num)
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 195, in algorithm_2_global_feature_init
    z_share_k = mpc_beaver.secure_matmul(
TypeError: secure_matmul() takes 4 positional arguments but 5 were given
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 342, in <module>
    z_share = mpc_beaver.secure_matmul(
TypeError: secure_matmul() takes 4 positional arguments but 5 were given
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 342, in <module>
    z_share = mpc_beaver.secure_matmul(
  File "/home/lxt/project/MVFIGN/crypto_utils.py", line 92, in secure_matmul
    device = x_share.device  # 获取输入张量的设备
AttributeError: 'list' object has no attribute 'device'
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4478, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0232, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241388.8125, Plain output norm: 26.6573
  Round 0/50, Loss: 0.4710
  [Round 1] Using MPC for secure forward pass...
tensor(0.1874, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0197, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2177, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0136, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2349, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1774, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1111, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0071, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0923, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1119, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1256, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1111, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0835, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241831.1875, Plain output norm: 10.1998
  Round 10/50, Loss: 0.0927
  [Round 11] Using MPC for secure forward pass...
tensor(0.0662, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0653, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0694, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0682, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0620, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0560, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0524, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0494, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0462, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0447, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241607.6250, Plain output norm: 7.8700
  Round 20/50, Loss: 0.0541
  [Round 21] Using MPC for secure forward pass...
tensor(0.0452, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0450, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0419, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0376, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0354, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0360, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0367, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0355, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0332, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241306.3438, Plain output norm: 6.7463
  Round 30/50, Loss: 0.0411
  [Round 31] Using MPC for secure forward pass...
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0317, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0307, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0300, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0297, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0293, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0282, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0274, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0274, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0275, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241736.6094, Plain output norm: 6.3694
  Round 40/50, Loss: 0.0368
  [Round 41] Using MPC for secure forward pass...
tensor(0.0270, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0262, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0259, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0257, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0253, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0249, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0245, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 402, in <module>
    decrypted_param = bfv_enc.decrypt_tensor(enc_param, shape)
  File "/home/lxt/project/MVFIGN/crypto_utils_1.py", line 38, in decrypt_tensor
    for enc_batch in encrypted_batches:
NameError: name 'encrypted_batches' is not defined
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4263, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0234, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241228.7344, Plain output norm: 25.9928
  Round 0/50, Loss: 0.4497
  [Round 1] Using MPC for secure forward pass...
tensor(0.1924, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0195, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2118, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0134, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2255, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1731, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1108, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0071, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0917, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1092, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1219, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1082, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0822, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241302.6250, Plain output norm: 10.1688
  Round 10/50, Loss: 0.0914
  [Round 11] Using MPC for secure forward pass...
tensor(0.0659, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0648, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0683, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0669, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0611, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0557, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0524, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0490, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0456, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0442, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241554.6719, Plain output norm: 7.7646
  Round 20/50, Loss: 0.0535
  [Round 21] Using MPC for secure forward pass...
tensor(0.0451, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0452, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0418, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0373, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0352, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0361, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0370, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0355, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0331, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241546.0312, Plain output norm: 6.6580
  Round 30/50, Loss: 0.0409
  [Round 31] Using MPC for secure forward pass...
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0318, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0308, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0300, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0298, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0293, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0282, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0276, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0276, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0276, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241530.4688, Plain output norm: 6.3358
  Round 40/50, Loss: 0.0369
  [Round 41] Using MPC for secure forward pass...
tensor(0.0270, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0263, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0260, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0260, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0253, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0250, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0249, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.82s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4385, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0215, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241597.9688, Plain output norm: 26.2659
  Round 0/50, Loss: 0.4599
  [Round 1] Using MPC for secure forward pass...
tensor(0.1893, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0181, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2163, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0126, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2327, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1754, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0069, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1106, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0065, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0925, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0069, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1116, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1248, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0079, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1104, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0830, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241479.8750, Plain output norm: 10.1753
  Round 10/50, Loss: 0.0915
  [Round 11] Using MPC for secure forward pass...
tensor(0.0656, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0643, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0689, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0687, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0625, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0558, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0514, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0482, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0458, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0449, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241608.4375, Plain output norm: 7.8976
  Round 20/50, Loss: 0.0536
  [Round 21] Using MPC for secure forward pass...
tensor(0.0453, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0447, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0413, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0368, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0357, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0366, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0352, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0326, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0312, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241537.7969, Plain output norm: 6.7388
  Round 30/50, Loss: 0.0396
  [Round 31] Using MPC for secure forward pass...
tensor(0.0313, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0313, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0304, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0294, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0289, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0285, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0276, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0270, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0268, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0268, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241341.7031, Plain output norm: 6.5461
  Round 40/50, Loss: 0.0354
  [Round 41] Using MPC for secure forward pass...
tensor(0.0263, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0256, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0252, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0252, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0250, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0246, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0242, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0240, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0238, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.82s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 1491.04s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
  0%|          | 0/300 [00:06<?, ?it/s]
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 440, in <module>
    aggregated_grad = algorithm_3_secure_gradient_update(
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 249, in algorithm_3_secure_gradient_update
    aggregated_grad = bfv_enc.decrypt_tensor(aggregated_enc, encrypted_gradients[0][1])
  File "/home/lxt/project/MVFIGN/crypto_utils_1.py", line 43, in decrypt_tensor
    tensor = torch.tensor(decrypted_parts).reshape(shape) / 1000.0
RuntimeError: shape '[1433, 1433]' is invalid for input of size 4106978
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4377, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0223, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 242124.3125, Plain output norm: 26.2383
  Round 0/50, Loss: 0.4600
  [Round 1] Using MPC for secure forward pass...
tensor(0.1908, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0188, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2135, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0131, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2317, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1776, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1117, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0908, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0070, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1092, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0076, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1241, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1112, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0841, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241341.5938, Plain output norm: 10.2809
  Round 10/50, Loss: 0.0929
  [Round 11] Using MPC for secure forward pass...
tensor(0.0659, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0230, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241760.5781, Plain output norm: 25.9298
  Round 0/50, Loss: 0.4488
  [Round 1] Using MPC for secure forward pass...
tensor(0.1924, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0192, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2135, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0132, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2275, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1721, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0073, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1093, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0070, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0924, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1117, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1235, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1078, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0809, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241733.7188, Plain output norm: 9.9272
  Round 10/50, Loss: 0.0901
  [Round 11] Using MPC for secure forward pass...
tensor(0.0653, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0654, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0696, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0677, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0608, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0548, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0516, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0492, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0464, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0446, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241326.7031, Plain output norm: 7.8596
  Round 20/50, Loss: 0.0539
  [Round 21] Using MPC for secure forward pass...
tensor(0.0447, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0443, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0414, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0374, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0354, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0360, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0366, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0351, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0328, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0319, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241676.0312, Plain output norm: 6.8001
  Round 30/50, Loss: 0.0408
  [Round 31] Using MPC for secure forward pass...
tensor(0.0320, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0316, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0305, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0297, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0295, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0291, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0281, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0273, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0273, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0274, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241396.2344, Plain output norm: 6.4804
  Round 40/50, Loss: 0.0366
  [Round 41] Using MPC for secure forward pass...
tensor(0.0269, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0256, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0251, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0248, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0244, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0096, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.81s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4253, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0206, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241297.7344, Plain output norm: 25.9255
  Round 0/50, Loss: 0.4459
  [Round 1] Using MPC for secure forward pass...
tensor(0.1924, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0173, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2168, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0119, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2269, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1704, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0066, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1089, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0063, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0938, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1131, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1237, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0077, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1067, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0795, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241737.1875, Plain output norm: 10.0152
  Round 10/50, Loss: 0.0878
  [Round 11] Using MPC for secure forward pass...
tensor(0.0648, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0657, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0698, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0673, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0600, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0541, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0512, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0487, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0456, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0439, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241614.9844, Plain output norm: 7.9983
  Round 20/50, Loss: 0.0524
  [Round 21] Using MPC for secure forward pass...
tensor(0.0442, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0438, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0407, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0364, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0344, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0352, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0359, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0344, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0319, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0308, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241569.3750, Plain output norm: 6.8491
  Round 30/50, Loss: 0.0391
  [Round 31] Using MPC for secure forward pass...
tensor(0.0310, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0308, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0296, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0287, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0285, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0281, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0272, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0264, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0263, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0263, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241634.6406, Plain output norm: 6.6499
  Round 40/50, Loss: 0.0348
  [Round 41] Using MPC for secure forward pass...
tensor(0.0258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0251, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0245, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0240, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0237, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0235, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0233, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.81s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 1459.16s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
  0%|          | 0/300 [00:04<?, ?it/s]
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 450, in <module>
    aggregated_grad = algorithm_3_secure_gradient_update(
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 259, in algorithm_3_secure_gradient_update
    aggregated_grad = bfv_enc.decrypt_tensor(aggregated_enc, encrypted_gradients[0][1])
NameError: name 'aggregated_enc' is not defined
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4119, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0233, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241674.4531, Plain output norm: 25.4251
  Round 0/50, Loss: 0.4351
  [Round 1] Using MPC for secure forward pass...
tensor(0.1948, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0193, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2075, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0133, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2211, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1700, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1082, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0071, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0906, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1090, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1207, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1052, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0791, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241509.8594, Plain output norm: 9.9523
  Round 10/50, Loss: 0.0883
  [Round 11] Using MPC for secure forward pass...
tensor(0.0646, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0647, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0679, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0656, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0594, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0544, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0514, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0482, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0449, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0436, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241515.5469, Plain output norm: 7.7508
  Round 20/50, Loss: 0.0529
  [Round 21] Using MPC for secure forward pass...
tensor(0.0444, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0442, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0408, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0365, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0358, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0364, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0325, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0315, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241531.4844, Plain output norm: 6.6531
  Round 30/50, Loss: 0.0404
  [Round 31] Using MPC for secure forward pass...
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4128, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0233, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241594.8281, Plain output norm: 25.3423
  Round 0/50, Loss: 0.4361
  [Round 1] Using MPC for secure forward pass...
tensor(0.1971, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0194, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2081, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0133, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1707, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1114, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0921, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1080, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0081, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1196, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1056, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0802, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241366.7500, Plain output norm: 9.8613
  Round 10/50, Loss: 0.0894
  [Round 11] Using MPC for secure forward pass...
tensor(0.0652, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0651, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0684, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0660, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0594, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0544, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0519, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0095, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0490, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0454, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0435, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241441.2344, Plain output norm: 7.7146
  Round 20/50, Loss: 0.0527
  [Round 21] Using MPC for secure forward pass...
tensor(0.0442, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0446, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0416, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0369, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0357, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0367, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0352, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0327, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0315, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241614.7188, Plain output norm: 6.5970
  Round 30/50, Loss: 0.0404
  [Round 31] Using MPC for secure forward pass...
tensor(0.0318, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0316, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0306, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0296, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0294, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0291, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0282, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0273, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0272, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0273, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241306.5312, Plain output norm: 6.3185
  Round 40/50, Loss: 0.0364
  [Round 41] Using MPC for secure forward pass...
tensor(0.0268, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0257, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0255, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0251, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0248, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0245, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.81s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4277, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0211, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241599.4219, Plain output norm: 25.9383
  Round 0/50, Loss: 0.4488
  [Round 1] Using MPC for secure forward pass...
tensor(0.1946, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0177, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2122, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0123, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1752, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0069, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1118, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0066, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0911, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0069, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1089, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1229, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0079, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1090, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0817, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241415.0312, Plain output norm: 10.1991
  Round 10/50, Loss: 0.0902
  [Round 11] Using MPC for secure forward pass...
tensor(0.0646, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0642, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0687, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0673, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0605, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0545, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0514, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0486, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0452, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0435, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241331.2500, Plain output norm: 7.8894
  Round 20/50, Loss: 0.0522
  [Round 21] Using MPC for secure forward pass...
tensor(0.0442, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0443, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0412, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0365, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0342, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0351, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0360, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0323, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0311, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241456.4688, Plain output norm: 6.7168
  Round 30/50, Loss: 0.0393
  [Round 31] Using MPC for secure forward pass...
tensor(0.0311, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0308, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0298, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0290, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0289, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0284, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0273, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0264, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0264, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0266, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241377.1406, Plain output norm: 6.4935
  Round 40/50, Loss: 0.0351
  [Round 41] Using MPC for secure forward pass...
tensor(0.0261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0253, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0249, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0249, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0247, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0243, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0239, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0237, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0235, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.80s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 1488.23s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
  0%|          | 0/300 [00:05<?, ?it/s]
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 450, in <module>
    aggregated_grad = algorithm_3_secure_gradient_update(
  File "/home/lxt/project/MVFIGN/v_main_mpche_1.py", line 266, in algorithm_3_secure_gradient_update
    param.data -= lr * aggregated_grad.to(param.device)
RuntimeError: output with shape [1433] doesn't match the broadcast shape [1433, 1433]
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4175, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0228, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241622.3750, Plain output norm: 25.6145
  Round 0/50, Loss: 0.4403
  [Round 1] Using MPC for secure forward pass...
tensor(0.1940, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0190, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2104, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0131, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2228, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1707, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0073, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1090, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0070, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0914, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1095, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1215, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1063, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0800, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241371.5156, Plain output norm: 9.9719
  Round 10/50, Loss: 0.0891
  [Round 11] Using MPC for secure forward pass...
tensor(0.0647, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0648, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0685, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 14] Using MPC for secure forward pass...
tensor(0.0664, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 15] Using MPC for secure forward pass...
tensor(0.0598, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0094, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 16] Using MPC for secure forward pass...
tensor(0.0544, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 17] Using MPC for secure forward pass...
tensor(0.0515, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 18] Using MPC for secure forward pass...
tensor(0.0489, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 19] Using MPC for secure forward pass...
tensor(0.0456, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 20] Using MPC for secure forward pass...
tensor(0.0437, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241457.8750, Plain output norm: 7.7432
  Round 20/50, Loss: 0.0528
  [Round 21] Using MPC for secure forward pass...
tensor(0.0442, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 22] Using MPC for secure forward pass...
tensor(0.0442, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 23] Using MPC for secure forward pass...
tensor(0.0413, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 24] Using MPC for secure forward pass...
tensor(0.0369, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 25] Using MPC for secure forward pass...
tensor(0.0348, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 26] Using MPC for secure forward pass...
tensor(0.0356, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 27] Using MPC for secure forward pass...
tensor(0.0364, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 28] Using MPC for secure forward pass...
tensor(0.0350, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 29] Using MPC for secure forward pass...
tensor(0.0326, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 30] Using MPC for secure forward pass...
tensor(0.0315, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241722.9531, Plain output norm: 6.6996
  Round 30/50, Loss: 0.0402
  [Round 31] Using MPC for secure forward pass...
tensor(0.0316, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 32] Using MPC for secure forward pass...
tensor(0.0314, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 33] Using MPC for secure forward pass...
tensor(0.0303, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 34] Using MPC for secure forward pass...
tensor(0.0295, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 35] Using MPC for secure forward pass...
tensor(0.0292, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0088, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 36] Using MPC for secure forward pass...
tensor(0.0288, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 37] Using MPC for secure forward pass...
tensor(0.0279, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 38] Using MPC for secure forward pass...
tensor(0.0271, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 39] Using MPC for secure forward pass...
tensor(0.0271, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0089, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 40] Using MPC for secure forward pass...
tensor(0.0271, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241846.7500, Plain output norm: 6.3959
  Round 40/50, Loss: 0.0361
  [Round 41] Using MPC for secure forward pass...
tensor(0.0266, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 42] Using MPC for secure forward pass...
tensor(0.0258, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 43] Using MPC for secure forward pass...
tensor(0.0255, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 44] Using MPC for secure forward pass...
tensor(0.0256, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 45] Using MPC for secure forward pass...
tensor(0.0253, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 46] Using MPC for secure forward pass...
tensor(0.0249, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 47] Using MPC for secure forward pass...
tensor(0.0246, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 48] Using MPC for secure forward pass...
tensor(0.0244, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 49] Using MPC for secure forward pass...
tensor(0.0242, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.80s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4463, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0207, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241623.3750, Plain output norm: 26.6688
  Round 0/50, Loss: 0.4670
  [Round 1] Using MPC for secure forward pass...
tensor(0.1880, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0176, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2184, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0123, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2341, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1776, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0068, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 5] Using MPC for secure forward pass...
tensor(0.1114, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0064, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 6] Using MPC for secure forward pass...
tensor(0.0910, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0068, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 7] Using MPC for secure forward pass...
tensor(0.1102, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0073, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 8] Using MPC for secure forward pass...
tensor(0.1256, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0078, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 9] Using MPC for secure forward pass...
tensor(0.1121, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0082, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 10] Using MPC for secure forward pass...
tensor(0.0837, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241248.7969, Plain output norm: 10.4497
  Round 10/50, Loss: 0.0921
  [Round 11] Using MPC for secure forward pass...
tensor(0.0649, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0086, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 12] Using MPC for secure forward pass...
tensor(0.0636, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 13] Using MPC for secure forward pass...
tensor(0.0687, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0087, device='cuda:0', grad_fn=<MeanBackward0>)
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4319, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0229, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241556.6875, Plain output norm: 26.1175
  Round 0/5, Loss: 0.4548
  [Round 1] Using MPC for secure forward pass...
tensor(0.1864, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0193, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2155, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0134, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2275, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1698, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0074, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.81s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4368, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0207, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241584.0156, Plain output norm: 26.1688
  Round 0/5, Loss: 0.4575
  [Round 1] Using MPC for secure forward pass...
tensor(0.1927, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0175, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2141, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0122, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2310, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1774, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0068, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.82s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 153.80s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2497, dtype=torch.float64) 0.13947387892256646
  0%|          | 1/300 [00:05<28:17,  5.68s/it]tensor(0.1661, dtype=torch.float64) 0.04729319445093185
tensor(0.1402, dtype=torch.float64) 0.034488111871409974
tensor(0.1402, dtype=torch.float64) 0.034488111871409974
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425

[Epoch 10] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2977, dtype=torch.float64) 0.13655818074768425
  4%|▎         | 11/300 [00:11<04:15,  1.13it/s]tensor(0.3087, dtype=torch.float64) 0.16033990243689425
tensor(0.1169, dtype=torch.float64) 0.024451235701784327
tensor(0.1169, dtype=torch.float64) 0.024451235701784327
tensor(0.1341, dtype=torch.float64) 0.05449411074538192
tensor(0.1402, dtype=torch.float64) 0.034488111871409974
tensor(0.1574, dtype=torch.float64) 0.06622129365879323
tensor(0.1661, dtype=torch.float64) 0.04729319445093185
tensor(0.4305, dtype=torch.float64) 0.2747653505888983
tensor(0.2989, dtype=torch.float64) 0.1391296787730686

[Epoch 20] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2989, dtype=torch.float64) 0.1391296787730686
  7%|▋         | 21/300 [00:16<03:13,  1.44it/s]tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2066, dtype=torch.float64) 0.1365369241754335
tensor(0.1427, dtype=torch.float64) 0.039454517988230776

[Epoch 30] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.1427, dtype=torch.float64) 0.039454517988230776
 10%|█         | 31/300 [00:22<02:48,  1.59it/s]tensor(0.1513, dtype=torch.float64) 0.056206887233435664
tensor(0.3813, dtype=torch.float64) 0.24800303959366363
tensor(0.3407, dtype=torch.float64) 0.19417858909799954
tensor(0.3567, dtype=torch.float64) 0.25111570760866453
tensor(0.3715, dtype=torch.float64) 0.21683655649525002
tensor(0.2977, dtype=torch.float64) 0.13668774258900085
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425

[Epoch 40] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2977, dtype=torch.float64) 0.13655818074768425
 14%|█▎        | 41/300 [00:27<02:34,  1.67it/s]tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2989, dtype=torch.float64) 0.13912637567098385
tensor(0.3456, dtype=torch.float64) 0.21426867596540977
tensor(0.3801, dtype=torch.float64) 0.2439010941170514
tensor(0.3284, dtype=torch.float64) 0.1928903650276767
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686

[Epoch 50] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2989, dtype=torch.float64) 0.1391296787730686
 17%|█▋        | 51/300 [00:33<02:25,  1.72it/s]tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425

[Epoch 60] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2977, dtype=torch.float64) 0.13655818074768425
 20%|██        | 61/300 [00:38<02:16,  1.75it/s]tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686

[Epoch 70] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2989, dtype=torch.float64) 0.1391296787730686
 24%|██▎       | 71/300 [00:44<02:09,  1.77it/s]tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2977, dtype=torch.float64) 0.13655818074768425
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686

[Epoch 80] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2989, dtype=torch.float64) 0.1391296787730686
 27%|██▋       | 81/300 [00:49<02:03,  1.78it/s]tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686

[Epoch 90] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2989, dtype=torch.float64) 0.1391296787730686
 30%|███       | 91/300 [00:55<01:56,  1.79it/s]tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.2989, dtype=torch.float64) 0.1391296787730686
tensor(0.3001, dtype=torch.float64) 0.1416958572133065
tensor(0.3014, dtype=torch.float64) 0.14423219939976675
tensor(0.3014, dtype=torch.float64) 0.14423219939976675
tensor(0.3026, dtype=torch.float64) 0.14673391534217015

[Epoch 100] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3026, dtype=torch.float64) 0.14673391534217015
 34%|███▎      | 101/300 [01:00<01:50,  1.80it/s]tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419
tensor(0.3026, dtype=torch.float64) 0.1468412622014419

[Epoch 110] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3026, dtype=torch.float64) 0.1468412622014419
 37%|███▋      | 111/300 [01:06<01:44,  1.81it/s]tensor(0.3038, dtype=torch.float64) 0.14933969703010344
tensor(0.3050, dtype=torch.float64) 0.15190937902152474
tensor(0.3063, dtype=torch.float64) 0.15436405892952654
tensor(0.3075, dtype=torch.float64) 0.15683290190925492
tensor(0.3087, dtype=torch.float64) 0.1593612916559849
tensor(0.3087, dtype=torch.float64) 0.1593612916559849
tensor(0.3100, dtype=torch.float64) 0.16184896658624995
tensor(0.3100, dtype=torch.float64) 0.16184896658624995
tensor(0.3100, dtype=torch.float64) 0.16192033503227438

[Epoch 120] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3100, dtype=torch.float64) 0.16192033503227438
 40%|████      | 121/300 [01:11<01:39,  1.80it/s]tensor(0.3100, dtype=torch.float64) 0.16192033503227438
tensor(0.3112, dtype=torch.float64) 0.1643567995520242
tensor(0.3149, dtype=torch.float64) 0.17175838550968128
tensor(0.3173, dtype=torch.float64) 0.17654313145872616
tensor(0.3186, dtype=torch.float64) 0.17909718781210027
tensor(0.3235, dtype=torch.float64) 0.18839960170263287
tensor(0.3272, dtype=torch.float64) 0.19519455575891473
tensor(0.3284, dtype=torch.float64) 0.19907881159033222
tensor(0.3284, dtype=torch.float64) 0.20228690391404905

[Epoch 130] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3296, dtype=torch.float64) 0.20442846809946927
 44%|████▎     | 131/300 [01:17<01:33,  1.81it/s]tensor(0.3309, dtype=torch.float64) 0.20653946999616019
tensor(0.3296, dtype=torch.float64) 0.20290648503316291
tensor(0.3333, dtype=torch.float64) 0.20926797446081077
tensor(0.3358, dtype=torch.float64) 0.21481574050477545
tensor(0.3493, dtype=torch.float64) 0.2372725938943502
tensor(0.3616, dtype=torch.float64) 0.25896006078344197
tensor(0.3653, dtype=torch.float64) 0.2650675200479622
tensor(0.3653, dtype=torch.float64) 0.26609686885881734
tensor(0.3665, dtype=torch.float64) 0.2680459512769163

[Epoch 140] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3665, dtype=torch.float64) 0.2680459512769163
 47%|████▋     | 141/300 [01:22<01:27,  1.81it/s]tensor(0.3739, dtype=torch.float64) 0.27975651203492913
tensor(0.3973, dtype=torch.float64) 0.31426102176315696
tensor(0.3985, dtype=torch.float64) 0.3156301591447475
tensor(0.3985, dtype=torch.float64) 0.3153179626256384
tensor(0.4194, dtype=torch.float64) 0.3440849006392472
tensor(0.4342, dtype=torch.float64) 0.3631980195451629
tensor(0.4526, dtype=torch.float64) 0.38533689561596907
tensor(0.4502, dtype=torch.float64) 0.38271223857033054
tensor(0.4514, dtype=torch.float64) 0.3853211360771247

[Epoch 150] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4514, dtype=torch.float64) 0.3853211360771247
 50%|█████     | 151/300 [01:28<01:22,  1.81it/s]tensor(0.4785, dtype=torch.float64) 0.4146810207646946
tensor(0.5043, dtype=torch.float64) 0.44301134914736856
tensor(0.5129, dtype=torch.float64) 0.45315363698432554
tensor(0.5092, dtype=torch.float64) 0.45095645201206264
tensor(0.4908, dtype=torch.float64) 0.43236229181418423
tensor(0.5068, dtype=torch.float64) 0.4498780590771338
tensor(0.5252, dtype=torch.float64) 0.47093350987446775
tensor(0.5314, dtype=torch.float64) 0.47873257265649466
tensor(0.5523, dtype=torch.float64) 0.5005947812330694

[Epoch 160] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5535, dtype=torch.float64) 0.502358942155072
 54%|█████▎    | 161/300 [01:33<01:16,  1.81it/s]tensor(0.5523, dtype=torch.float64) 0.5025617635564196
tensor(0.5547, dtype=torch.float64) 0.5062449406532252
tensor(0.6285, dtype=torch.float64) 0.5871888953279016
tensor(0.6101, dtype=torch.float64) 0.5691651374199149
tensor(0.5498, dtype=torch.float64) 0.5016017354664346
tensor(0.6433, dtype=torch.float64) 0.6054228761854886
tensor(0.6175, dtype=torch.float64) 0.5684740269005085
tensor(0.5449, dtype=torch.float64) 0.49289847864675673
tensor(0.6814, dtype=torch.float64) 0.6510647218823468

[Epoch 170] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6814, dtype=torch.float64) 0.6510647218823468
 57%|█████▋    | 171/300 [01:39<01:11,  1.81it/s]tensor(0.6445, dtype=torch.float64) 0.6124479682868708
tensor(0.5486, dtype=torch.float64) 0.5116390539683445
tensor(0.6716, dtype=torch.float64) 0.6526157690513588
tensor(0.6863, dtype=torch.float64) 0.6548614500710953
tensor(0.5695, dtype=torch.float64) 0.5245254283372932
tensor(0.6863, dtype=torch.float64) 0.6558264131336572
tensor(0.6888, dtype=torch.float64) 0.6641722649784781
tensor(0.5892, dtype=torch.float64) 0.5591708452227088
tensor(0.7085, dtype=torch.float64) 0.6943910926744059

[Epoch 180] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7085, dtype=torch.float64) 0.6943910926744059
 60%|██████    | 181/300 [01:44<01:05,  1.82it/s]tensor(0.7048, dtype=torch.float64) 0.6910902695896187
tensor(0.6470, dtype=torch.float64) 0.6215358292377874
tensor(0.6913, dtype=torch.float64) 0.6633575408952562
tensor(0.7011, dtype=torch.float64) 0.6757183036814448
tensor(0.6679, dtype=torch.float64) 0.6407737582421462
tensor(0.7183, dtype=torch.float64) 0.7061618493340474
tensor(0.7343, dtype=torch.float64) 0.7284105247267494
tensor(0.6950, dtype=torch.float64) 0.6831910776367355
tensor(0.7257, dtype=torch.float64) 0.7117464214977862

[Epoch 190] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7257, dtype=torch.float64) 0.7117464214977862
 64%|██████▎   | 191/300 [01:50<01:00,  1.82it/s]tensor(0.7134, dtype=torch.float64) 0.6907974992364764
tensor(0.7257, dtype=torch.float64) 0.7113456571267633
tensor(0.7319, dtype=torch.float64) 0.7218303029611935
tensor(0.7355, dtype=torch.float64) 0.7269351173202612
tensor(0.7368, dtype=torch.float64) 0.7304984823658439
tensor(0.7368, dtype=torch.float64) 0.723458514685696
tensor(0.7405, dtype=torch.float64) 0.7265090072102681
tensor(0.7343, dtype=torch.float64) 0.726553567565667
tensor(0.7565, dtype=torch.float64) 0.7508356975037873

[Epoch 200] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7565, dtype=torch.float64) 0.7508356975037873
 67%|██████▋   | 201/300 [01:55<00:54,  1.82it/s]tensor(0.7245, dtype=torch.float64) 0.7126221599707396
tensor(0.7171, dtype=torch.float64) 0.7189394969767869
tensor(0.6002, dtype=torch.float64) 0.5699539086579015
tensor(0.6162, dtype=torch.float64) 0.6149448151083416
tensor(0.6052, dtype=torch.float64) 0.5790567560999973
tensor(0.5843, dtype=torch.float64) 0.5226772547687764
tensor(0.6248, dtype=torch.float64) 0.6356918859261665
tensor(0.5720, dtype=torch.float64) 0.5759561609101227
tensor(0.6027, dtype=torch.float64) 0.5705880255424818

[Epoch 210] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6027, dtype=torch.float64) 0.5705880255424818
 70%|███████   | 211/300 [02:01<00:48,  1.82it/s]tensor(0.6039, dtype=torch.float64) 0.610244335056538
tensor(0.6581, dtype=torch.float64) 0.6554661285979779
tensor(0.5941, dtype=torch.float64) 0.5549266879956798
tensor(0.6777, dtype=torch.float64) 0.6462637717710383
tensor(0.7196, dtype=torch.float64) 0.7163038558878118
tensor(0.6556, dtype=torch.float64) 0.6546638567193775
tensor(0.6384, dtype=torch.float64) 0.623445083564464
tensor(0.7171, dtype=torch.float64) 0.7109779011825677
tensor(0.7208, dtype=torch.float64) 0.7119510274470885

[Epoch 220] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7208, dtype=torch.float64) 0.7119624380154601
 74%|███████▎  | 221/300 [02:06<00:43,  1.81it/s]tensor(0.7097, dtype=torch.float64) 0.6953777124922652
tensor(0.6962, dtype=torch.float64) 0.6735810076089109
tensor(0.7454, dtype=torch.float64) 0.739724776237692
tensor(0.7417, dtype=torch.float64) 0.7423862792084548
tensor(0.7429, dtype=torch.float64) 0.7388962554022881
tensor(0.7257, dtype=torch.float64) 0.7141340370938847
tensor(0.7257, dtype=torch.float64) 0.7074541870551416
tensor(0.7478, dtype=torch.float64) 0.7395280494907678
tensor(0.7343, dtype=torch.float64) 0.729097409079574

[Epoch 230] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7343, dtype=torch.float64) 0.729097409079574
 77%|███████▋  | 231/300 [02:12<00:37,  1.82it/s]tensor(0.7392, dtype=torch.float64) 0.738518092328507
tensor(0.7269, dtype=torch.float64) 0.7251307301032129
tensor(0.7552, dtype=torch.float64) 0.7490122255678257
tensor(0.7405, dtype=torch.float64) 0.7368830532340751
tensor(0.7651, dtype=torch.float64) 0.7595717925196979
tensor(0.7429, dtype=torch.float64) 0.7402385183448886
tensor(0.7614, dtype=torch.float64) 0.7592081583404142
tensor(0.7540, dtype=torch.float64) 0.7493674494684874
tensor(0.7515, dtype=torch.float64) 0.7484438248764008

[Epoch 240] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7515, dtype=torch.float64) 0.7484438248764008
 80%|████████  | 241/300 [02:17<00:32,  1.82it/s]tensor(0.7651, dtype=torch.float64) 0.759640668730447
tensor(0.7577, dtype=torch.float64) 0.755744948777325
tensor(0.7626, dtype=torch.float64) 0.7624920795544297
tensor(0.7442, dtype=torch.float64) 0.7403332191073049
tensor(0.7638, dtype=torch.float64) 0.7590885331316525
tensor(0.7552, dtype=torch.float64) 0.755341403905683
tensor(0.7540, dtype=torch.float64) 0.7494615231627227
tensor(0.7528, dtype=torch.float64) 0.748039431114132
tensor(0.7466, dtype=torch.float64) 0.7466665585606025

[Epoch 250] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7478, dtype=torch.float64) 0.7480369256850465
 84%|████████▎ | 251/300 [02:23<00:27,  1.81it/s]tensor(0.7724, dtype=torch.float64) 0.7684546938575763
tensor(0.7466, dtype=torch.float64) 0.7442773951863908
tensor(0.7515, dtype=torch.float64) 0.7495764223869059
tensor(0.7478, dtype=torch.float64) 0.7459729614849346
tensor(0.7577, dtype=torch.float64) 0.7540119035504621
tensor(0.7601, dtype=torch.float64) 0.7607942710161605
tensor(0.7626, dtype=torch.float64) 0.7584647305680517
tensor(0.7392, dtype=torch.float64) 0.7385165388296442
tensor(0.7491, dtype=torch.float64) 0.7475151108101176

[Epoch 260] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7478, dtype=torch.float64) 0.7464072406837972
 87%|████████▋ | 261/300 [02:28<00:21,  1.82it/s]tensor(0.7601, dtype=torch.float64) 0.7599241379619956
tensor(0.7294, dtype=torch.float64) 0.7270466933902132
tensor(0.7245, dtype=torch.float64) 0.7202078186848487
tensor(0.6384, dtype=torch.float64) 0.6249363766015397
tensor(0.5855, dtype=torch.float64) 0.5579015603161269
tensor(0.5461, dtype=torch.float64) 0.4861912300627625
tensor(0.5068, dtype=torch.float64) 0.47741673529845263
tensor(0.4096, dtype=torch.float64) 0.3988253154676621
tensor(0.5744, dtype=torch.float64) 0.48283511879398333

[Epoch 270] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5744, dtype=torch.float64) 0.48283511879398333
 90%|█████████ | 271/300 [02:34<00:15,  1.82it/s]tensor(0.4428, dtype=torch.float64) 0.3583571502273607
tensor(0.6950, dtype=torch.float64) 0.6455101909071754
tensor(0.2718, dtype=torch.float64) 0.2283599528682683
tensor(0.4084, dtype=torch.float64) 0.371592375475526
tensor(0.3555, dtype=torch.float64) 0.31360097004514287
tensor(0.3530, dtype=torch.float64) 0.3033731421586679
tensor(0.5916, dtype=torch.float64) 0.5146882215479489
tensor(0.4108, dtype=torch.float64) 0.32125303260415566
tensor(0.3616, dtype=torch.float64) 0.2508293979930034

[Epoch 280] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3616, dtype=torch.float64) 0.2508293979930034
 94%|█████████▎| 281/300 [02:39<00:10,  1.82it/s]tensor(0.3875, dtype=torch.float64) 0.27866428809043525
tensor(0.5006, dtype=torch.float64) 0.4141486939822639
tensor(0.6298, dtype=torch.float64) 0.5696209639585942
tensor(0.6814, dtype=torch.float64) 0.6385347178221988
tensor(0.5892, dtype=torch.float64) 0.5836605632172621
tensor(0.5744, dtype=torch.float64) 0.5682223578564706
tensor(0.6076, dtype=torch.float64) 0.5819718066834579
tensor(0.6310, dtype=torch.float64) 0.6145323386851257
tensor(0.6728, dtype=torch.float64) 0.6522788359294714

[Epoch 290] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6728, dtype=torch.float64) 0.6524816597306656
 97%|█████████▋| 291/300 [02:45<00:04,  1.81it/s]tensor(0.6630, dtype=torch.float64) 0.6427814473100786
tensor(0.6691, dtype=torch.float64) 0.6466436354217571
tensor(0.6445, dtype=torch.float64) 0.6029420000563621
tensor(0.6150, dtype=torch.float64) 0.5701177592542953
tensor(0.6076, dtype=torch.float64) 0.5683181300862682
tensor(0.6396, dtype=torch.float64) 0.6155530450734374
tensor(0.6827, dtype=torch.float64) 0.6680956196668852
tensor(0.7417, dtype=torch.float64) 0.7354686811858425
tensor(0.7405, dtype=torch.float64) 0.7397995171088961
100%|██████████| 300/300 [02:45<00:00,  1.81it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 153.80s
  Phase 2 Time: 165.48s
  Total Time: 319.28s
  Best Accuracy: 0.7724
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4282, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0234, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241256.4375, Plain output norm: 25.9405
  Round 0/5, Loss: 0.4516
  [Round 1] Using MPC for secure forward pass...
tensor(0.1924, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0195, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2124, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0135, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2286, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0093, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1736, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0075, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.83s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4282, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0211, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241370.4375, Plain output norm: 25.8975
  Round 0/5, Loss: 0.4493
  [Round 1] Using MPC for secure forward pass...
tensor(0.1906, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0178, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2170, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0123, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2278, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0085, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1710, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0068, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.83s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 153.50s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.0664, dtype=torch.float64) 0.012570352976257033
  0%|          | 1/300 [00:05<28:21,  5.69s/it]tensor(0.1378, dtype=torch.float64) 0.03336059306539011
tensor(0.1525, dtype=torch.float64) 0.0618514598075843
tensor(0.1599, dtype=torch.float64) 0.04408739739571308
tensor(0.1599, dtype=torch.float64) 0.04408739739571308
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.1378, dtype=torch.float64) 0.03336059306539011
tensor(0.1378, dtype=torch.float64) 0.03336059306539011

[Epoch 10] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.1378, dtype=torch.float64) 0.03336059306539011
  4%|▎         | 11/300 [00:11<04:16,  1.13it/s]tensor(0.2030, dtype=torch.float64) 0.1391334349916272
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.0652, dtype=torch.float64) 0.007979456237980393
tensor(0.0652, dtype=torch.float64) 0.007979456237980393
tensor(0.3358, dtype=torch.float64) 0.1980878138580094
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225

[Epoch 20] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3124, dtype=torch.float64) 0.148745030093225
  7%|▋         | 21/300 [00:16<03:15,  1.43it/s]tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3173, dtype=torch.float64) 0.15880553264935124
tensor(0.3739, dtype=torch.float64) 0.24033429257513003
tensor(0.3665, dtype=torch.float64) 0.2325110371399874
tensor(0.3173, dtype=torch.float64) 0.15880553264935124
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225

[Epoch 30] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3124, dtype=torch.float64) 0.148745030093225
 10%|█         | 31/300 [00:22<02:50,  1.58it/s]tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3161, dtype=torch.float64) 0.15635197411143772
tensor(0.3149, dtype=torch.float64) 0.15385809603092324
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225

[Epoch 40] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3124, dtype=torch.float64) 0.148745030093225
 14%|█▎        | 41/300 [00:27<02:36,  1.66it/s]tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3137, dtype=torch.float64) 0.1513228202397749
tensor(0.3149, dtype=torch.float64) 0.15385809603092324
tensor(0.3149, dtype=torch.float64) 0.15385809603092324
tensor(0.3137, dtype=torch.float64) 0.1513228202397749
tensor(0.3137, dtype=torch.float64) 0.1513228202397749
tensor(0.3124, dtype=torch.float64) 0.148745030093225

[Epoch 50] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3124, dtype=torch.float64) 0.148745030093225
 17%|█▋        | 51/300 [00:33<02:26,  1.70it/s]tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3124, dtype=torch.float64) 0.148745030093225
tensor(0.3149, dtype=torch.float64) 0.15385809603092324
tensor(0.3161, dtype=torch.float64) 0.15635197411143772
tensor(0.3161, dtype=torch.float64) 0.15635197411143772
tensor(0.3149, dtype=torch.float64) 0.15385809603092324

[Epoch 60] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3149, dtype=torch.float64) 0.15385809603092324
 20%|██        | 61/300 [00:38<02:17,  1.74it/s]tensor(0.3149, dtype=torch.float64) 0.15385809603092324
tensor(0.3149, dtype=torch.float64) 0.15385809603092324
tensor(0.3149, dtype=torch.float64) 0.15385809603092324
tensor(0.3161, dtype=torch.float64) 0.15635197411143772
tensor(0.3186, dtype=torch.float64) 0.16121981298039836
tensor(0.3210, dtype=torch.float64) 0.16593452948957904
tensor(0.3210, dtype=torch.float64) 0.16593452948957904
tensor(0.3210, dtype=torch.float64) 0.16593452948957904
tensor(0.3210, dtype=torch.float64) 0.16593452948957904

[Epoch 70] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3210, dtype=torch.float64) 0.16593452948957904
 24%|██▎       | 71/300 [00:44<02:10,  1.76it/s]tensor(0.3210, dtype=torch.float64) 0.16593452948957904
tensor(0.3223, dtype=torch.float64) 0.1685063007997426
tensor(0.3235, dtype=torch.float64) 0.17102047305202442
tensor(0.3247, dtype=torch.float64) 0.1734790893459605
tensor(0.3235, dtype=torch.float64) 0.17102047305202442
tensor(0.3260, dtype=torch.float64) 0.17556527101948155
tensor(0.3444, dtype=torch.float64) 0.20612880398040137
tensor(0.3592, dtype=torch.float64) 0.22382722546773395
tensor(0.3641, dtype=torch.float64) 0.22978909162438438

[Epoch 80] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3641, dtype=torch.float64) 0.22978909162438438
 27%|██▋       | 81/300 [00:50<02:03,  1.77it/s]tensor(0.3641, dtype=torch.float64) 0.22978909162438438
tensor(0.3604, dtype=torch.float64) 0.22509263833771972
tensor(0.3702, dtype=torch.float64) 0.23896075891270263
tensor(0.3838, dtype=torch.float64) 0.25887298791862
tensor(0.3911, dtype=torch.float64) 0.2683884916620815
tensor(0.3764, dtype=torch.float64) 0.25107815307910836
tensor(0.3739, dtype=torch.float64) 0.24826624971909866
tensor(0.3899, dtype=torch.float64) 0.26318158035067024
tensor(0.4034, dtype=torch.float64) 0.26984793559438935

[Epoch 90] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4034, dtype=torch.float64) 0.26984793559438935
 30%|███       | 91/300 [00:55<01:57,  1.78it/s]tensor(0.4059, dtype=torch.float64) 0.268535195099681
tensor(0.3961, dtype=torch.float64) 0.26223648195200233
tensor(0.4071, dtype=torch.float64) 0.2800950118874
tensor(0.4391, dtype=torch.float64) 0.31291836200296796
tensor(0.4194, dtype=torch.float64) 0.2915620340113831
tensor(0.4034, dtype=torch.float64) 0.2727809262092183
tensor(0.4379, dtype=torch.float64) 0.30928772211409156
tensor(0.4293, dtype=torch.float64) 0.2997905071579053
tensor(0.4145, dtype=torch.float64) 0.2870281119628616

[Epoch 100] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4145, dtype=torch.float64) 0.2870281119628616
 34%|███▎      | 101/300 [01:01<01:51,  1.79it/s]tensor(0.4502, dtype=torch.float64) 0.327001400720335
tensor(0.4502, dtype=torch.float64) 0.3280864498327213
tensor(0.4047, dtype=torch.float64) 0.2749938618588591
tensor(0.4416, dtype=torch.float64) 0.31950995617979944
tensor(0.4711, dtype=torch.float64) 0.3606790142604312
tensor(0.4194, dtype=torch.float64) 0.2929114458297113
tensor(0.4539, dtype=torch.float64) 0.3461283087747773
tensor(0.5141, dtype=torch.float64) 0.42289199599783023
tensor(0.4588, dtype=torch.float64) 0.3460620660035781

[Epoch 110] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4588, dtype=torch.float64) 0.3458840668140669
 37%|███▋      | 111/300 [01:06<01:45,  1.80it/s]tensor(0.4526, dtype=torch.float64) 0.33603830257637857
tensor(0.4797, dtype=torch.float64) 0.37610234706041606
tensor(0.4797, dtype=torch.float64) 0.38506152631891544
tensor(0.4588, dtype=torch.float64) 0.35882781977576717
tensor(0.5277, dtype=torch.float64) 0.4531958731152743
tensor(0.5092, dtype=torch.float64) 0.42776747116297087
tensor(0.4736, dtype=torch.float64) 0.3815709519184346
tensor(0.5449, dtype=torch.float64) 0.47196060681818386
tensor(0.5301, dtype=torch.float64) 0.45157468312876364

[Epoch 120] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5314, dtype=torch.float64) 0.4531548230852477
 40%|████      | 121/300 [01:12<01:39,  1.79it/s]tensor(0.5068, dtype=torch.float64) 0.42347777994098856
tensor(0.5351, dtype=torch.float64) 0.4601624096250962
tensor(0.5412, dtype=torch.float64) 0.47202763080252674
tensor(0.5387, dtype=torch.float64) 0.4736774253330441
tensor(0.5621, dtype=torch.float64) 0.5002645396943174
tensor(0.5584, dtype=torch.float64) 0.49015562952716324
tensor(0.5400, dtype=torch.float64) 0.466777258228865
tensor(0.5412, dtype=torch.float64) 0.469718168825525
tensor(0.5769, dtype=torch.float64) 0.5169857255382401

[Epoch 130] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5744, dtype=torch.float64) 0.5143892544054532
 44%|████▎     | 131/300 [01:17<01:33,  1.80it/s]tensor(0.5830, dtype=torch.float64) 0.5238394007214976
tensor(0.5560, dtype=torch.float64) 0.4961943002691547
tensor(0.5781, dtype=torch.float64) 0.5278310516701573
tensor(0.5338, dtype=torch.float64) 0.4602006890446673
tensor(0.5584, dtype=torch.float64) 0.49064499632991965
tensor(0.6125, dtype=torch.float64) 0.5604615330711072
tensor(0.5646, dtype=torch.float64) 0.507146865298589
tensor(0.5818, dtype=torch.float64) 0.5208518124659814
tensor(0.5953, dtype=torch.float64) 0.5377513672826618

[Epoch 140] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5941, dtype=torch.float64) 0.5357818600761344
 47%|████▋     | 141/300 [01:23<01:28,  1.80it/s]tensor(0.5744, dtype=torch.float64) 0.5187596603076644
tensor(0.6076, dtype=torch.float64) 0.5580180692138104
tensor(0.6396, dtype=torch.float64) 0.5961156500544192
tensor(0.5953, dtype=torch.float64) 0.5494416275221609
tensor(0.6027, dtype=torch.float64) 0.5520987619073503
tensor(0.6175, dtype=torch.float64) 0.5654602452528091
tensor(0.5941, dtype=torch.float64) 0.5430012308834115
tensor(0.6322, dtype=torch.float64) 0.5853275284656295
tensor(0.6347, dtype=torch.float64) 0.5891192925612913

[Epoch 150] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6347, dtype=torch.float64) 0.5891192925612913
 50%|█████     | 151/300 [01:28<01:22,  1.80it/s]tensor(0.5966, dtype=torch.float64) 0.5505816317512257
tensor(0.6187, dtype=torch.float64) 0.5647378802885672
tensor(0.6482, dtype=torch.float64) 0.6045430905593016
tensor(0.6187, dtype=torch.float64) 0.5720072121244582
tensor(0.6322, dtype=torch.float64) 0.5807674080667283
tensor(0.6224, dtype=torch.float64) 0.5691311538220567
tensor(0.6261, dtype=torch.float64) 0.5918447391193529
tensor(0.6740, dtype=torch.float64) 0.6465082717999003
tensor(0.6310, dtype=torch.float64) 0.5898075815879532

[Epoch 160] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6310, dtype=torch.float64) 0.5897591028908539
 54%|█████▎    | 161/300 [01:34<01:17,  1.80it/s]tensor(0.6212, dtype=torch.float64) 0.5794592811454341
tensor(0.6544, dtype=torch.float64) 0.6189208635509138
tensor(0.6667, dtype=torch.float64) 0.6303273033671297
tensor(0.6445, dtype=torch.float64) 0.607349913919398
tensor(0.6691, dtype=torch.float64) 0.6385138789391571
tensor(0.6716, dtype=torch.float64) 0.6413537199220118
tensor(0.6494, dtype=torch.float64) 0.6136559502579917
tensor(0.6814, dtype=torch.float64) 0.6523361743248629
tensor(0.6605, dtype=torch.float64) 0.6327158630044106

[Epoch 170] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6593, dtype=torch.float64) 0.631654473414632
 57%|█████▋    | 171/300 [01:39<01:11,  1.80it/s]tensor(0.6654, dtype=torch.float64) 0.633254883134148
tensor(0.6704, dtype=torch.float64) 0.638822142789427
tensor(0.6630, dtype=torch.float64) 0.632190785200935
tensor(0.6667, dtype=torch.float64) 0.6361904635953058
tensor(0.6851, dtype=torch.float64) 0.6569314223648908
tensor(0.6691, dtype=torch.float64) 0.6404064693645257
tensor(0.6900, dtype=torch.float64) 0.6644632873458529
tensor(0.6974, dtype=torch.float64) 0.6704410503582032
tensor(0.6740, dtype=torch.float64) 0.6447067660140745

[Epoch 180] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6740, dtype=torch.float64) 0.644600577111993
 60%|██████    | 181/300 [01:45<01:05,  1.81it/s]tensor(0.6925, dtype=torch.float64) 0.6636095065841452
tensor(0.6974, dtype=torch.float64) 0.6675656649544537
tensor(0.6728, dtype=torch.float64) 0.6415809257488164
tensor(0.7023, dtype=torch.float64) 0.676162121987361
tensor(0.7023, dtype=torch.float64) 0.676982468758172
tensor(0.6827, dtype=torch.float64) 0.6531624290246958
tensor(0.7011, dtype=torch.float64) 0.673611763996869
tensor(0.6950, dtype=torch.float64) 0.6689078335722245
tensor(0.6913, dtype=torch.float64) 0.6620326386667068

[Epoch 190] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6913, dtype=torch.float64) 0.6620326386667068
 64%|██████▎   | 191/300 [01:51<01:00,  1.80it/s]tensor(0.7171, dtype=torch.float64) 0.6927147395547464
tensor(0.7109, dtype=torch.float64) 0.6864551486075255
tensor(0.7060, dtype=torch.float64) 0.6785448193433984
tensor(0.7036, dtype=torch.float64) 0.6780545150919192
tensor(0.6863, dtype=torch.float64) 0.6595921119598789
tensor(0.7122, dtype=torch.float64) 0.6902750931376943
tensor(0.7245, dtype=torch.float64) 0.7054174563788038
tensor(0.7097, dtype=torch.float64) 0.688113785295978
tensor(0.7220, dtype=torch.float64) 0.7046225565794881

[Epoch 200] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7208, dtype=torch.float64) 0.7020831817392009
 67%|██████▋   | 201/300 [01:56<00:54,  1.81it/s]tensor(0.6950, dtype=torch.float64) 0.6746441981005559
tensor(0.7257, dtype=torch.float64) 0.7077174724370284
tensor(0.7171, dtype=torch.float64) 0.695279976639805
tensor(0.7060, dtype=torch.float64) 0.6828739136258716
tensor(0.7220, dtype=torch.float64) 0.7056741807850732
tensor(0.7146, dtype=torch.float64) 0.6926394497777064
tensor(0.7245, dtype=torch.float64) 0.7061652741000555
tensor(0.7319, dtype=torch.float64) 0.7199273619201169
tensor(0.7183, dtype=torch.float64) 0.6996825290659354

[Epoch 210] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7183, dtype=torch.float64) 0.6996825290659354
 70%|███████   | 211/300 [02:02<00:49,  1.81it/s]tensor(0.7048, dtype=torch.float64) 0.6926541281062927
tensor(0.7171, dtype=torch.float64) 0.7064619861225352
tensor(0.6950, dtype=torch.float64) 0.676356114478033
tensor(0.7294, dtype=torch.float64) 0.7242397310276065
tensor(0.7036, dtype=torch.float64) 0.6878040916060274
tensor(0.7392, dtype=torch.float64) 0.7329032095231623
tensor(0.7269, dtype=torch.float64) 0.7201375692679212
tensor(0.6863, dtype=torch.float64) 0.6622361847993352
tensor(0.7232, dtype=torch.float64) 0.7100655264609048

[Epoch 220] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7245, dtype=torch.float64) 0.7113884703450337
 74%|███████▎  | 221/300 [02:07<00:43,  1.80it/s]tensor(0.7085, dtype=torch.float64) 0.6962516144101059
tensor(0.7048, dtype=torch.float64) 0.6902378444434819
tensor(0.7282, dtype=torch.float64) 0.7255788459957345
tensor(0.7196, dtype=torch.float64) 0.7097844487590345
tensor(0.7208, dtype=torch.float64) 0.7061210334833615
tensor(0.7245, dtype=torch.float64) 0.7119737471543794
tensor(0.7060, dtype=torch.float64) 0.6947281941142558
tensor(0.7429, dtype=torch.float64) 0.7358331186589293
tensor(0.6913, dtype=torch.float64) 0.6757861418065104

[Epoch 230] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6913, dtype=torch.float64) 0.675674495543452
 77%|███████▋  | 231/300 [02:13<00:38,  1.81it/s]tensor(0.7085, dtype=torch.float64) 0.6967912688194712
tensor(0.7232, dtype=torch.float64) 0.7225546469899554
tensor(0.6790, dtype=torch.float64) 0.659834745627672
tensor(0.7060, dtype=torch.float64) 0.6927083819803264
tensor(0.6986, dtype=torch.float64) 0.700488014419641
tensor(0.7220, dtype=torch.float64) 0.7096969695605876
tensor(0.6839, dtype=torch.float64) 0.6631335595542385
tensor(0.7392, dtype=torch.float64) 0.7370335937431697
tensor(0.7343, dtype=torch.float64) 0.7310858388279506

[Epoch 240] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7343, dtype=torch.float64) 0.7310899271700414
 80%|████████  | 241/300 [02:18<00:32,  1.81it/s]tensor(0.6925, dtype=torch.float64) 0.674683337772284
tensor(0.7282, dtype=torch.float64) 0.7169042395210391
tensor(0.7183, dtype=torch.float64) 0.7180270050511066
tensor(0.7269, dtype=torch.float64) 0.7153146559075156
tensor(0.7196, dtype=torch.float64) 0.7075753368603859
tensor(0.7380, dtype=torch.float64) 0.7312563332624478
tensor(0.7368, dtype=torch.float64) 0.7296765637070135
tensor(0.7405, dtype=torch.float64) 0.7322626736626505
tensor(0.7269, dtype=torch.float64) 0.7177528973483119

[Epoch 250] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7282, dtype=torch.float64) 0.7189896442992615
 84%|████████▎ | 251/300 [02:24<00:27,  1.80it/s]tensor(0.7429, dtype=torch.float64) 0.7372818472109365
tensor(0.7306, dtype=torch.float64) 0.7229197930734078
tensor(0.7392, dtype=torch.float64) 0.7301374635544617
tensor(0.7343, dtype=torch.float64) 0.725360240288083
tensor(0.7343, dtype=torch.float64) 0.7269009616892905
tensor(0.7392, dtype=torch.float64) 0.7323222656989893
tensor(0.7282, dtype=torch.float64) 0.7176159904819526
tensor(0.7380, dtype=torch.float64) 0.7317405803294518
tensor(0.7257, dtype=torch.float64) 0.717734136621642

[Epoch 260] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7282, dtype=torch.float64) 0.7208336447869256
 87%|████████▋ | 261/300 [02:29<00:21,  1.81it/s]tensor(0.7343, dtype=torch.float64) 0.7306691755598211
tensor(0.7491, dtype=torch.float64) 0.7427963211481404
tensor(0.7319, dtype=torch.float64) 0.7217091411627299
tensor(0.7355, dtype=torch.float64) 0.7289811115603286
tensor(0.7146, dtype=torch.float64) 0.7059888840341576
tensor(0.7343, dtype=torch.float64) 0.7259744790135544
tensor(0.7355, dtype=torch.float64) 0.7329576206743212
tensor(0.7109, dtype=torch.float64) 0.7021639266818221
tensor(0.7355, dtype=torch.float64) 0.7319501041674805

[Epoch 270] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7355, dtype=torch.float64) 0.7319501041674805
 90%|█████████ | 271/300 [02:35<00:16,  1.81it/s]tensor(0.7109, dtype=torch.float64) 0.701244255784287
tensor(0.7331, dtype=torch.float64) 0.7263290682298738
tensor(0.7331, dtype=torch.float64) 0.7347119871980289
tensor(0.7011, dtype=torch.float64) 0.6916088233242456
tensor(0.7159, dtype=torch.float64) 0.7170948399766779
tensor(0.7146, dtype=torch.float64) 0.7109568743049067
tensor(0.6986, dtype=torch.float64) 0.6890273193150699
tensor(0.7196, dtype=torch.float64) 0.7175321333720923
tensor(0.7282, dtype=torch.float64) 0.7226137829958117

[Epoch 280] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7282, dtype=torch.float64) 0.7226137829958117
 94%|█████████▎| 281/300 [02:40<00:10,  1.81it/s]tensor(0.7232, dtype=torch.float64) 0.7148635563659327
tensor(0.7282, dtype=torch.float64) 0.7233970028616089
tensor(0.7282, dtype=torch.float64) 0.7220986184402334
tensor(0.7171, dtype=torch.float64) 0.7155213983858613
tensor(0.7245, dtype=torch.float64) 0.7164231619923364
tensor(0.7208, dtype=torch.float64) 0.7112287554432717
tensor(0.7257, dtype=torch.float64) 0.7252049371006555
tensor(0.7319, dtype=torch.float64) 0.7222361445457256
tensor(0.7355, dtype=torch.float64) 0.7280698779967004

[Epoch 290] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7355, dtype=torch.float64) 0.7280698779967004
 97%|█████████▋| 291/300 [02:46<00:04,  1.80it/s]tensor(0.7515, dtype=torch.float64) 0.7504371360554101
tensor(0.7220, dtype=torch.float64) 0.7131808976209234
tensor(0.7368, dtype=torch.float64) 0.7286037485428271
tensor(0.7368, dtype=torch.float64) 0.7354125242207259
tensor(0.7245, dtype=torch.float64) 0.7194282920099596
tensor(0.7417, dtype=torch.float64) 0.73568921978634
tensor(0.7392, dtype=torch.float64) 0.7343427838896285
tensor(0.7319, dtype=torch.float64) 0.7271066619700715
tensor(0.7478, dtype=torch.float64) 0.7423458347271177
100%|██████████| 300/300 [02:46<00:00,  1.80it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 153.50s
  Phase 2 Time: 166.49s
  Total Time: 319.99s
  Best Accuracy: 0.7515
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4241, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0225, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241445.3125, Plain output norm: 25.6916
  Round 0/5, Loss: 0.4465
  [Round 1] Using MPC for secure forward pass...
tensor(0.1937, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0188, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2147, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0130, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2255, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1704, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.84s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4268, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0204, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241679.5156, Plain output norm: 25.9612
  Round 0/5, Loss: 0.4471
  [Round 1] Using MPC for secure forward pass...
tensor(0.1940, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0172, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2141, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0120, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2269, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1736, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.86s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 156.71s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.0566, dtype=torch.float64) 0.012645550223151152
  0%|          | 1/300 [00:05<28:27,  5.71s/it]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.1648, dtype=torch.float64) 0.04848995221978363
tensor(0.1255, dtype=torch.float64) 0.027971689552961105
tensor(0.1255, dtype=torch.float64) 0.027971689552961105
tensor(0.1119, dtype=torch.float64) 0.022534804994067643
tensor(0.1119, dtype=torch.float64) 0.022534804994067643
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 10] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
  4%|▎         | 11/300 [00:11<04:20,  1.11it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.1710, dtype=torch.float64) 0.060720164232517394
tensor(0.1661, dtype=torch.float64) 0.05097928728672719
tensor(0.1255, dtype=torch.float64) 0.027971689552961105
tensor(0.1255, dtype=torch.float64) 0.027971689552961105
tensor(0.0529, dtype=torch.float64) 0.005313768090951938
tensor(0.0529, dtype=torch.float64) 0.005313768090951938
tensor(0.1402, dtype=torch.float64) 0.13866050941211167
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 20] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
  7%|▋         | 21/300 [00:16<03:16,  1.42it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.4059, dtype=torch.float64) 0.26935266556612936
tensor(0.4293, dtype=torch.float64) 0.28455864104095585
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 30] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
 10%|█         | 31/300 [00:22<02:52,  1.56it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3210, dtype=torch.float64) 0.1575700831635182
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 40] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
 14%|█▎        | 41/300 [00:28<02:38,  1.64it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 50] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
 17%|█▋        | 51/300 [00:33<02:27,  1.69it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 60] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
 20%|██        | 61/300 [00:39<02:18,  1.72it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 70] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
 24%|██▎       | 71/300 [00:44<02:11,  1.74it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898

[Epoch 80] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3198, dtype=torch.float64) 0.1549838424758898
 27%|██▋       | 81/300 [00:50<02:04,  1.76it/s]tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3198, dtype=torch.float64) 0.1549838424758898
tensor(0.3210, dtype=torch.float64) 0.1575703531398791
tensor(0.3210, dtype=torch.float64) 0.1575703531398791
tensor(0.3210, dtype=torch.float64) 0.1575703531398791
tensor(0.3210, dtype=torch.float64) 0.1575703531398791
tensor(0.3223, dtype=torch.float64) 0.16012148508080593
tensor(0.3235, dtype=torch.float64) 0.16263801402743813

[Epoch 90] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3247, dtype=torch.float64) 0.1651206934100285
 30%|███       | 91/300 [00:56<01:58,  1.77it/s]tensor(0.3260, dtype=torch.float64) 0.1675702551568052
tensor(0.3260, dtype=torch.float64) 0.1675702551568052
tensor(0.3260, dtype=torch.float64) 0.1675702551568052
tensor(0.3260, dtype=torch.float64) 0.1675702551568052
tensor(0.3272, dtype=torch.float64) 0.16998741045656882
tensor(0.3272, dtype=torch.float64) 0.16998741045656882
tensor(0.3272, dtype=torch.float64) 0.16998741045656882
tensor(0.3284, dtype=torch.float64) 0.17237285048906828
tensor(0.3284, dtype=torch.float64) 0.17237285048906828

[Epoch 100] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3284, dtype=torch.float64) 0.17237285048906828
 34%|███▎      | 101/300 [01:01<01:51,  1.78it/s]tensor(0.3296, dtype=torch.float64) 0.17472724712473164
tensor(0.3284, dtype=torch.float64) 0.17237285048906828
tensor(0.3284, dtype=torch.float64) 0.17237285048906828
tensor(0.3309, dtype=torch.float64) 0.1770512535952427
tensor(0.3383, dtype=torch.float64) 0.1918314039599726
tensor(0.3407, dtype=torch.float64) 0.19598810295996205
tensor(0.3407, dtype=torch.float64) 0.19598810295996205
tensor(0.3383, dtype=torch.float64) 0.19394581859308832
tensor(0.3419, dtype=torch.float64) 0.20063968455486597

[Epoch 110] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3419, dtype=torch.float64) 0.20063968455486597
 37%|███▋      | 111/300 [01:07<01:45,  1.79it/s]tensor(0.3567, dtype=torch.float64) 0.22365449357054706
tensor(0.3665, dtype=torch.float64) 0.23824916781273117
tensor(0.3629, dtype=torch.float64) 0.23317757299048658
tensor(0.3518, dtype=torch.float64) 0.21694863258848374
tensor(0.3690, dtype=torch.float64) 0.24154397888810883
tensor(0.3924, dtype=torch.float64) 0.2698632035926247
tensor(0.4047, dtype=torch.float64) 0.28223454624344674
tensor(0.3985, dtype=torch.float64) 0.28268056666580654
tensor(0.3899, dtype=torch.float64) 0.27860056844618014

[Epoch 120] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3899, dtype=torch.float64) 0.27860056844618014
 40%|████      | 121/300 [01:12<01:40,  1.79it/s]tensor(0.3924, dtype=torch.float64) 0.27946484620301176
tensor(0.4145, dtype=torch.float64) 0.2973626816562751
tensor(0.4354, dtype=torch.float64) 0.313164112935588
tensor(0.4157, dtype=torch.float64) 0.3030003092526209
tensor(0.4108, dtype=torch.float64) 0.30129095848393056
tensor(0.4465, dtype=torch.float64) 0.3328728840647144
tensor(0.4526, dtype=torch.float64) 0.34440095342070004
tensor(0.4526, dtype=torch.float64) 0.35855347264509874
tensor(0.4723, dtype=torch.float64) 0.37492806057834044

[Epoch 130] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4723, dtype=torch.float64) 0.37492806057834044
 44%|████▎     | 131/300 [01:18<01:34,  1.80it/s]tensor(0.4723, dtype=torch.float64) 0.3654416746918646
tensor(0.4748, dtype=torch.float64) 0.3782312544651303
tensor(0.4859, dtype=torch.float64) 0.3911043417958716
tensor(0.4982, dtype=torch.float64) 0.39770524251533257
tensor(0.4994, dtype=torch.float64) 0.40838140309266757
tensor(0.4969, dtype=torch.float64) 0.40510876690267406
tensor(0.4785, dtype=torch.float64) 0.3647994529155967
tensor(0.4785, dtype=torch.float64) 0.3758438238262069
tensor(0.4994, dtype=torch.float64) 0.40569770415035294

[Epoch 140] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5006, dtype=torch.float64) 0.40670810428282134
 47%|████▋     | 141/300 [01:23<01:28,  1.80it/s]tensor(0.5141, dtype=torch.float64) 0.41039493458456017
tensor(0.5375, dtype=torch.float64) 0.4527523649437378
tensor(0.5154, dtype=torch.float64) 0.4356636094712542
tensor(0.5129, dtype=torch.float64) 0.42640725923767425
tensor(0.4994, dtype=torch.float64) 0.38724568533943243
tensor(0.5252, dtype=torch.float64) 0.4415538791313006
tensor(0.5474, dtype=torch.float64) 0.46535875575782515
tensor(0.5560, dtype=torch.float64) 0.4726109000751573
tensor(0.5621, dtype=torch.float64) 0.48482469134062106

[Epoch 150] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5597, dtype=torch.float64) 0.4827013262386596
 50%|█████     | 151/300 [01:29<01:22,  1.80it/s]tensor(0.5449, dtype=torch.float64) 0.47028243730370467
tensor(0.5437, dtype=torch.float64) 0.4676054243646094
tensor(0.5621, dtype=torch.float64) 0.4842138374451369
tensor(0.5879, dtype=torch.float64) 0.5212725133515155
tensor(0.5781, dtype=torch.float64) 0.5103906429873658
tensor(0.5633, dtype=torch.float64) 0.48632989496713563
tensor(0.5621, dtype=torch.float64) 0.492522605753258
tensor(0.5744, dtype=torch.float64) 0.5081874351285096
tensor(0.6039, dtype=torch.float64) 0.5363873483808886

[Epoch 160] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6027, dtype=torch.float64) 0.5339085132722718
 54%|█████▎    | 161/300 [01:34<01:17,  1.80it/s]tensor(0.6224, dtype=torch.float64) 0.5631374477696919
tensor(0.5879, dtype=torch.float64) 0.5231388710225632
tensor(0.6002, dtype=torch.float64) 0.5385450271791251
tensor(0.6027, dtype=torch.float64) 0.5436172276643283
tensor(0.6076, dtype=torch.float64) 0.5495761717929428
tensor(0.6445, dtype=torch.float64) 0.5943842013602034
tensor(0.6556, dtype=torch.float64) 0.6096851830414478
tensor(0.6408, dtype=torch.float64) 0.5839491334345477
tensor(0.6224, dtype=torch.float64) 0.5619037779353921

[Epoch 170] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6224, dtype=torch.float64) 0.5619037779353921
 57%|█████▋    | 171/300 [01:40<01:11,  1.81it/s]tensor(0.6384, dtype=torch.float64) 0.5751239468847634
tensor(0.6581, dtype=torch.float64) 0.600159254468042
tensor(0.6630, dtype=torch.float64) 0.6161629464995858
tensor(0.6617, dtype=torch.float64) 0.6212900859429861
tensor(0.6544, dtype=torch.float64) 0.6131798846961016
tensor(0.6605, dtype=torch.float64) 0.6147636159440962
tensor(0.6777, dtype=torch.float64) 0.6292946180670322
tensor(0.6753, dtype=torch.float64) 0.6268030543785332
tensor(0.6630, dtype=torch.float64) 0.6133833967925859

[Epoch 180] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6630, dtype=torch.float64) 0.6132783443301973
 60%|██████    | 181/300 [01:45<01:05,  1.80it/s]tensor(0.6790, dtype=torch.float64) 0.6337434223461345
tensor(0.6716, dtype=torch.float64) 0.6229182426848432
tensor(0.6777, dtype=torch.float64) 0.6301801276231813
tensor(0.6556, dtype=torch.float64) 0.6149582344231314
tensor(0.6470, dtype=torch.float64) 0.6099867072738986
tensor(0.6802, dtype=torch.float64) 0.642182122127566
tensor(0.6777, dtype=torch.float64) 0.637193931056466
tensor(0.6777, dtype=torch.float64) 0.6351122656987132
tensor(0.6876, dtype=torch.float64) 0.648918606725566

[Epoch 190] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6876, dtype=torch.float64) 0.6490967533513764
 64%|██████▎   | 191/300 [01:51<01:00,  1.80it/s]tensor(0.6962, dtype=torch.float64) 0.6617877829641895
tensor(0.6802, dtype=torch.float64) 0.6459273815164359
tensor(0.6814, dtype=torch.float64) 0.6438176592837187
tensor(0.6728, dtype=torch.float64) 0.6341566492923357
tensor(0.6851, dtype=torch.float64) 0.6485563518251352
tensor(0.7159, dtype=torch.float64) 0.683814848996456
tensor(0.7011, dtype=torch.float64) 0.6720415579848852
tensor(0.7122, dtype=torch.float64) 0.6853815456976942
tensor(0.7343, dtype=torch.float64) 0.7100523281398463

[Epoch 200] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7343, dtype=torch.float64) 0.7100523281398463
 67%|██████▋   | 201/300 [01:57<00:54,  1.81it/s]tensor(0.7269, dtype=torch.float64) 0.7008078664392862
tensor(0.7232, dtype=torch.float64) 0.6935216802578734
tensor(0.7146, dtype=torch.float64) 0.6864713898989497
tensor(0.7282, dtype=torch.float64) 0.7010168714369891
tensor(0.7060, dtype=torch.float64) 0.6790382836125917
tensor(0.7245, dtype=torch.float64) 0.7014125376304512
tensor(0.7331, dtype=torch.float64) 0.7079669385388324
tensor(0.7306, dtype=torch.float64) 0.7073274225417007
tensor(0.7257, dtype=torch.float64) 0.6989902299989474

[Epoch 210] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7257, dtype=torch.float64) 0.6989902299989474
 70%|███████   | 211/300 [02:02<00:49,  1.80it/s]tensor(0.7331, dtype=torch.float64) 0.7134751049880887
tensor(0.7355, dtype=torch.float64) 0.7130031388073597
tensor(0.7368, dtype=torch.float64) 0.7125650481866387
tensor(0.7343, dtype=torch.float64) 0.7111817288407419
tensor(0.7429, dtype=torch.float64) 0.7210093771695452
tensor(0.7454, dtype=torch.float64) 0.7225807370252436
tensor(0.7454, dtype=torch.float64) 0.7252849318513598
tensor(0.7528, dtype=torch.float64) 0.7363555659391702
tensor(0.7392, dtype=torch.float64) 0.7156563720151744

[Epoch 220] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7405, dtype=torch.float64) 0.7169449061259381
 74%|███████▎  | 221/300 [02:08<00:43,  1.80it/s]tensor(0.7331, dtype=torch.float64) 0.7099477083513439
tensor(0.7540, dtype=torch.float64) 0.7337835304931435
tensor(0.7540, dtype=torch.float64) 0.7346588892600882
tensor(0.7368, dtype=torch.float64) 0.7150212162200992
tensor(0.7515, dtype=torch.float64) 0.7322516205620704
tensor(0.7565, dtype=torch.float64) 0.7374162547047608
tensor(0.7528, dtype=torch.float64) 0.7311861038295343
tensor(0.7454, dtype=torch.float64) 0.7251117128841943
tensor(0.7466, dtype=torch.float64) 0.7293791678660992

[Epoch 230] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7466, dtype=torch.float64) 0.7292440114209797
 77%|███████▋  | 231/300 [02:13<00:38,  1.81it/s]tensor(0.7614, dtype=torch.float64) 0.7444626331414831
tensor(0.7491, dtype=torch.float64) 0.727218819090238
tensor(0.7577, dtype=torch.float64) 0.7402758052237167
tensor(0.7478, dtype=torch.float64) 0.7263866650922887
tensor(0.7540, dtype=torch.float64) 0.7321810511398247
tensor(0.7688, dtype=torch.float64) 0.7554995075440007
tensor(0.7540, dtype=torch.float64) 0.7379125267475589
tensor(0.7528, dtype=torch.float64) 0.7343326836314006
tensor(0.7577, dtype=torch.float64) 0.7446396083970624

[Epoch 240] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7577, dtype=torch.float64) 0.7446396083970624
 80%|████████  | 241/300 [02:19<00:32,  1.81it/s]tensor(0.7491, dtype=torch.float64) 0.7336514817869275
tensor(0.7368, dtype=torch.float64) 0.7252949510632709
tensor(0.7269, dtype=torch.float64) 0.7184865831393057
tensor(0.7405, dtype=torch.float64) 0.7278846046897118
tensor(0.7343, dtype=torch.float64) 0.71236388262951
tensor(0.7429, dtype=torch.float64) 0.7307932117413752
tensor(0.7429, dtype=torch.float64) 0.7329274141391374
tensor(0.7442, dtype=torch.float64) 0.7305374533140332
tensor(0.7626, dtype=torch.float64) 0.7491049115206604

[Epoch 250] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7614, dtype=torch.float64) 0.7477154098618111
 84%|████████▎ | 251/300 [02:24<00:27,  1.81it/s]tensor(0.7589, dtype=torch.float64) 0.7436452713431697
tensor(0.7552, dtype=torch.float64) 0.7413431538327361
tensor(0.7601, dtype=torch.float64) 0.7496281797271372
tensor(0.7577, dtype=torch.float64) 0.7414417180929628
tensor(0.7577, dtype=torch.float64) 0.7437430820444402
tensor(0.7565, dtype=torch.float64) 0.7453031398750656
tensor(0.7269, dtype=torch.float64) 0.709699133307625
tensor(0.7724, dtype=torch.float64) 0.7635625884504322
tensor(0.7638, dtype=torch.float64) 0.7543228993678516

[Epoch 260] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7638, dtype=torch.float64) 0.7542037263707412
 87%|████████▋ | 261/300 [02:30<00:21,  1.80it/s]tensor(0.7159, dtype=torch.float64) 0.7007050427316517
tensor(0.7663, dtype=torch.float64) 0.7609280559793994
tensor(0.7688, dtype=torch.float64) 0.7615410692712918
tensor(0.7478, dtype=torch.float64) 0.7366732734261217
tensor(0.7577, dtype=torch.float64) 0.7455702104719892
tensor(0.7491, dtype=torch.float64) 0.7398625773567521
tensor(0.7159, dtype=torch.float64) 0.7033631271412237
tensor(0.7319, dtype=torch.float64) 0.72187803598096
tensor(0.7355, dtype=torch.float64) 0.7311746663487558

[Epoch 270] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7355, dtype=torch.float64) 0.7311746663487558
 90%|█████████ | 271/300 [02:35<00:16,  1.81it/s]tensor(0.7208, dtype=torch.float64) 0.7094798760480934
tensor(0.7048, dtype=torch.float64) 0.6874802584012801
tensor(0.7454, dtype=torch.float64) 0.743859367388592
tensor(0.6839, dtype=torch.float64) 0.6789236394262524
tensor(0.6568, dtype=torch.float64) 0.6306037485408346
tensor(0.6384, dtype=torch.float64) 0.6497895769254236
tensor(0.6704, dtype=torch.float64) 0.6643146126673973
tensor(0.6544, dtype=torch.float64) 0.629085013154724
tensor(0.7196, dtype=torch.float64) 0.7244287763285638

[Epoch 280] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7196, dtype=torch.float64) 0.7244648320819905
 94%|█████████▎| 281/300 [02:41<00:10,  1.80it/s]tensor(0.6531, dtype=torch.float64) 0.6556557147706148
tensor(0.6691, dtype=torch.float64) 0.6488907982498222
tensor(0.7171, dtype=torch.float64) 0.700714538106858
tensor(0.7368, dtype=torch.float64) 0.7413753702824682
tensor(0.7060, dtype=torch.float64) 0.6963584152838489
tensor(0.7073, dtype=torch.float64) 0.6850285434742858
tensor(0.7466, dtype=torch.float64) 0.7398579193600991
tensor(0.7036, dtype=torch.float64) 0.7204789671028874
tensor(0.7380, dtype=torch.float64) 0.7260960610072301

[Epoch 290] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7392, dtype=torch.float64) 0.7272612671139543
 97%|█████████▋| 291/300 [02:47<00:05,  1.80it/s]tensor(0.7294, dtype=torch.float64) 0.7019182906230733
tensor(0.7712, dtype=torch.float64) 0.7673838227941884
tensor(0.7294, dtype=torch.float64) 0.7387573943228717
tensor(0.7528, dtype=torch.float64) 0.7430092790884495
tensor(0.7540, dtype=torch.float64) 0.7368939634630289
tensor(0.7491, dtype=torch.float64) 0.7397334847123416
tensor(0.7552, dtype=torch.float64) 0.75549019499832
tensor(0.7626, dtype=torch.float64) 0.7582983498252056
tensor(0.7614, dtype=torch.float64) 0.7586801337192267
100%|██████████| 300/300 [02:47<00:00,  1.80it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 156.71s
  Phase 2 Time: 167.07s
  Total Time: 323.78s
  Best Accuracy: 0.7724
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4282, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0228, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241782.8438, Plain output norm: 25.8533
  Round 0/5, Loss: 0.4510
  [Round 1] Using MPC for secure forward pass...
tensor(0.1930, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0193, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2157, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0133, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2272, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0091, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1729, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.82s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4324, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0203, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241531.7188, Plain output norm: 26.1249
  Round 0/5, Loss: 0.4526
  [Round 1] Using MPC for secure forward pass...
tensor(0.1914, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0172, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2168, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0120, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2300, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0083, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1736, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0066, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.81s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 152.80s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2485, dtype=torch.float64) 0.15416621959557728
  0%|          | 1/300 [00:05<28:16,  5.67s/it]tensor(0.0787, dtype=torch.float64) 0.01148946495166206
tensor(0.1402, dtype=torch.float64) 0.07017939667932835
tensor(0.1513, dtype=torch.float64) 0.0698735559825601
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.2854, dtype=torch.float64) 0.15111058596777938
tensor(0.2854, dtype=torch.float64) 0.16380174477901363
tensor(0.1488, dtype=torch.float64) 0.07575285570157043
tensor(0.1230, dtype=torch.float64) 0.030872856757564023

[Epoch 10] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.1230, dtype=torch.float64) 0.030872856757564023
  4%|▎         | 11/300 [00:11<04:15,  1.13it/s]tensor(0.1267, dtype=torch.float64) 0.03813352354735369
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.1931, dtype=torch.float64) 0.13730458099657578
tensor(0.1378, dtype=torch.float64) 0.05010107367218629
tensor(0.3542, dtype=torch.float64) 0.21006739596497165
tensor(0.3629, dtype=torch.float64) 0.34209223512277115

[Epoch 20] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3616, dtype=torch.float64) 0.3401499954884838
  7%|▋         | 21/300 [00:16<03:13,  1.44it/s]tensor(0.1390, dtype=torch.float64) 0.10417051843381572
tensor(0.1907, dtype=torch.float64) 0.1461926247175462
tensor(0.5018, dtype=torch.float64) 0.4180063172472547
tensor(0.2891, dtype=torch.float64) 0.13878434836691295
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.2817, dtype=torch.float64) 0.12380628604750538
tensor(0.2817, dtype=torch.float64) 0.12380628604750538

[Epoch 30] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2817, dtype=torch.float64) 0.12380628604750538
 10%|█         | 31/300 [00:22<02:49,  1.59it/s]tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2841, dtype=torch.float64) 0.12888570347241934
tensor(0.2940, dtype=torch.float64) 0.1480780082642264
tensor(0.4157, dtype=torch.float64) 0.31778410205050667
tensor(0.4465, dtype=torch.float64) 0.36356708290191064
tensor(0.3296, dtype=torch.float64) 0.21211371462805526
tensor(0.2866, dtype=torch.float64) 0.13392912737024676
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645

[Epoch 40] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2829, dtype=torch.float64) 0.12636540188958645
 14%|█▎        | 41/300 [00:27<02:35,  1.66it/s]tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2841, dtype=torch.float64) 0.12888570347241934
tensor(0.2878, dtype=torch.float64) 0.1362228799783176
tensor(0.2891, dtype=torch.float64) 0.13878434836691295
tensor(0.2927, dtype=torch.float64) 0.145804687589257
tensor(0.2891, dtype=torch.float64) 0.13878434836691295

[Epoch 50] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2891, dtype=torch.float64) 0.13878434836691295
 17%|█▋        | 51/300 [00:33<02:25,  1.72it/s]tensor(0.2891, dtype=torch.float64) 0.13878434836691295
tensor(0.2854, dtype=torch.float64) 0.13136812105093415
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2829, dtype=torch.float64) 0.12636540188958645
tensor(0.2854, dtype=torch.float64) 0.13136812105093415
tensor(0.2878, dtype=torch.float64) 0.1362228799783176

[Epoch 60] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2878, dtype=torch.float64) 0.1362228799783176
 20%|██        | 61/300 [00:38<02:17,  1.74it/s]tensor(0.2891, dtype=torch.float64) 0.13878434836691295
tensor(0.2940, dtype=torch.float64) 0.1480780082642264
tensor(0.2940, dtype=torch.float64) 0.1480780082642264
tensor(0.2891, dtype=torch.float64) 0.13878434836691295
tensor(0.2891, dtype=torch.float64) 0.13878434836691295
tensor(0.2878, dtype=torch.float64) 0.1362228799783176
tensor(0.2866, dtype=torch.float64) 0.1338135556040372
tensor(0.2866, dtype=torch.float64) 0.1338135556040372
tensor(0.2866, dtype=torch.float64) 0.1338135556040372

[Epoch 70] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2866, dtype=torch.float64) 0.1338135556040372
 24%|██▎       | 71/300 [00:44<02:09,  1.77it/s]tensor(0.2878, dtype=torch.float64) 0.1362228799783176
tensor(0.2878, dtype=torch.float64) 0.1362228799783176
tensor(0.2891, dtype=torch.float64) 0.13878434836691295
tensor(0.2940, dtype=torch.float64) 0.1480780082642264
tensor(0.2952, dtype=torch.float64) 0.15031919815131795
tensor(0.2952, dtype=torch.float64) 0.15031919815131795
tensor(0.2952, dtype=torch.float64) 0.15031919815131795
tensor(0.2952, dtype=torch.float64) 0.15031919815131795
tensor(0.2940, dtype=torch.float64) 0.1480780082642264

[Epoch 80] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2940, dtype=torch.float64) 0.1480780082642264
 27%|██▋       | 81/300 [00:49<02:03,  1.77it/s]tensor(0.2940, dtype=torch.float64) 0.1480780082642264
tensor(0.2940, dtype=torch.float64) 0.1480780082642264
tensor(0.2952, dtype=torch.float64) 0.15031919815131795
tensor(0.2952, dtype=torch.float64) 0.15031919815131795
tensor(0.2964, dtype=torch.float64) 0.1525289825358108
tensor(0.2964, dtype=torch.float64) 0.1525289825358108
tensor(0.2977, dtype=torch.float64) 0.15641243105659058
tensor(0.3001, dtype=torch.float64) 0.16062254417902141
tensor(0.3038, dtype=torch.float64) 0.16672854289765981

[Epoch 90] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3038, dtype=torch.float64) 0.16672854289765981
 30%|███       | 91/300 [00:55<01:56,  1.79it/s]tensor(0.3038, dtype=torch.float64) 0.16672854289765981
tensor(0.3038, dtype=torch.float64) 0.16672854289765981
tensor(0.3050, dtype=torch.float64) 0.16871047672065212
tensor(0.3063, dtype=torch.float64) 0.1706666541277488
tensor(0.3087, dtype=torch.float64) 0.1743135105035808
tensor(0.3149, dtype=torch.float64) 0.18344704862227015
tensor(0.3235, dtype=torch.float64) 0.19785683046000788
tensor(0.3272, dtype=torch.float64) 0.20494425623576917
tensor(0.3321, dtype=torch.float64) 0.2154049484585931

[Epoch 100] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3321, dtype=torch.float64) 0.2154049484585931
 34%|███▎      | 101/300 [01:00<01:51,  1.79it/s]tensor(0.3370, dtype=torch.float64) 0.22279702307036622
tensor(0.3383, dtype=torch.float64) 0.22162896626663608
tensor(0.3407, dtype=torch.float64) 0.22144586318797127
tensor(0.3432, dtype=torch.float64) 0.22436956803444602
tensor(0.3456, dtype=torch.float64) 0.23125656473837783
tensor(0.3567, dtype=torch.float64) 0.25087138749116283
tensor(0.3592, dtype=torch.float64) 0.25416762746244087
tensor(0.3727, dtype=torch.float64) 0.27175010055874227
tensor(0.3899, dtype=torch.float64) 0.2918643501909403

[Epoch 110] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3899, dtype=torch.float64) 0.2918643501909403
 37%|███▋      | 111/300 [01:06<01:45,  1.79it/s]tensor(0.3924, dtype=torch.float64) 0.29473537291037866
tensor(0.3936, dtype=torch.float64) 0.2965408012278868
tensor(0.3911, dtype=torch.float64) 0.2953361580610217
tensor(0.3911, dtype=torch.float64) 0.2961226485148104
tensor(0.4022, dtype=torch.float64) 0.311349684543678
tensor(0.4157, dtype=torch.float64) 0.32626681203324437
tensor(0.4293, dtype=torch.float64) 0.33873151708997234
tensor(0.4330, dtype=torch.float64) 0.34117662824306255
tensor(0.4280, dtype=torch.float64) 0.33972182676531043

[Epoch 120] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4293, dtype=torch.float64) 0.34076323263402786
 40%|████      | 121/300 [01:12<01:39,  1.80it/s]tensor(0.4268, dtype=torch.float64) 0.3399498142790347
tensor(0.4342, dtype=torch.float64) 0.34755113258424325
tensor(0.4526, dtype=torch.float64) 0.3725361944189757
tensor(0.4674, dtype=torch.float64) 0.3934724781394707
tensor(0.4736, dtype=torch.float64) 0.40178934697716767
tensor(0.4809, dtype=torch.float64) 0.4081272214193513
tensor(0.4859, dtype=torch.float64) 0.4150927291924963
tensor(0.5018, dtype=torch.float64) 0.4387732127429622
tensor(0.5314, dtype=torch.float64) 0.4718911455610068

[Epoch 130] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5314, dtype=torch.float64) 0.4718911455610068
 44%|████▎     | 131/300 [01:17<01:33,  1.80it/s]tensor(0.5117, dtype=torch.float64) 0.44740930141519913
tensor(0.4957, dtype=torch.float64) 0.4308363072314142
tensor(0.5461, dtype=torch.float64) 0.4861550103237742
tensor(0.5474, dtype=torch.float64) 0.4873186738142034
tensor(0.5351, dtype=torch.float64) 0.47778258820020786
tensor(0.5289, dtype=torch.float64) 0.4668157588076305
tensor(0.5781, dtype=torch.float64) 0.5272601456472932
tensor(0.5756, dtype=torch.float64) 0.5259962067215491
tensor(0.5670, dtype=torch.float64) 0.5115867942021658

[Epoch 140] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5670, dtype=torch.float64) 0.5115867942021658
 47%|████▋     | 141/300 [01:23<01:28,  1.81it/s]tensor(0.5978, dtype=torch.float64) 0.5459472884554205
tensor(0.5843, dtype=torch.float64) 0.5286941235160829
tensor(0.5830, dtype=torch.float64) 0.529466100404573
tensor(0.6089, dtype=torch.float64) 0.5556471440434939
tensor(0.5744, dtype=torch.float64) 0.520337664925907
tensor(0.6199, dtype=torch.float64) 0.5691506523609461
tensor(0.6039, dtype=torch.float64) 0.550821209231711
tensor(0.6076, dtype=torch.float64) 0.5604891849813839
tensor(0.6704, dtype=torch.float64) 0.6314863013866744

[Epoch 150] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6704, dtype=torch.float64) 0.6314863013866744
 50%|█████     | 151/300 [01:28<01:22,  1.80it/s]tensor(0.6285, dtype=torch.float64) 0.5842168296312279
tensor(0.6322, dtype=torch.float64) 0.589694793599552
tensor(0.6630, dtype=torch.float64) 0.6259986365654151
tensor(0.6187, dtype=torch.float64) 0.5763022190579669
tensor(0.6408, dtype=torch.float64) 0.6026596689723123
tensor(0.5277, dtype=torch.float64) 0.48434978735032735
tensor(0.5658, dtype=torch.float64) 0.4929631115460515
tensor(0.6371, dtype=torch.float64) 0.6091470390653947
tensor(0.5178, dtype=torch.float64) 0.49006638725115664

[Epoch 160] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5178, dtype=torch.float64) 0.49006638725115664
 54%|█████▎    | 161/300 [01:34<01:16,  1.81it/s]tensor(0.6162, dtype=torch.float64) 0.5921659741814199
tensor(0.6273, dtype=torch.float64) 0.6092022697056471
tensor(0.6408, dtype=torch.float64) 0.614866597225467
tensor(0.5781, dtype=torch.float64) 0.5384448129032704
tensor(0.6421, dtype=torch.float64) 0.6237949173835908
tensor(0.6765, dtype=torch.float64) 0.6640205689041769
tensor(0.5879, dtype=torch.float64) 0.5581563107344832
tensor(0.6900, dtype=torch.float64) 0.677270823015192
tensor(0.6740, dtype=torch.float64) 0.6601595936038283

[Epoch 170] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6740, dtype=torch.float64) 0.6601595936038283
 57%|█████▋    | 171/300 [01:39<01:11,  1.81it/s]tensor(0.6777, dtype=torch.float64) 0.6610134193643508
tensor(0.5990, dtype=torch.float64) 0.5805308257685327
tensor(0.6999, dtype=torch.float64) 0.6954636272855148
tensor(0.7245, dtype=torch.float64) 0.718315483321473
tensor(0.6261, dtype=torch.float64) 0.6015385761793083
tensor(0.7085, dtype=torch.float64) 0.7002210261800726
tensor(0.7011, dtype=torch.float64) 0.6961692832202924
tensor(0.6839, dtype=torch.float64) 0.6697021888255447
tensor(0.6839, dtype=torch.float64) 0.6712668255069634

[Epoch 180] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6827, dtype=torch.float64) 0.6697257947669474
 60%|██████    | 181/300 [01:45<01:06,  1.80it/s]tensor(0.7368, dtype=torch.float64) 0.7341087765048789
tensor(0.7183, dtype=torch.float64) 0.7135436918555973
tensor(0.6790, dtype=torch.float64) 0.6664532171169776
tensor(0.7269, dtype=torch.float64) 0.7191879247590452
tensor(0.7294, dtype=torch.float64) 0.724948921272234
tensor(0.6974, dtype=torch.float64) 0.6943262446876527
tensor(0.7171, dtype=torch.float64) 0.7138082782518421
tensor(0.6962, dtype=torch.float64) 0.6870549372413952
tensor(0.6605, dtype=torch.float64) 0.6466817901100912

[Epoch 190] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6593, dtype=torch.float64) 0.6455870617330159
 64%|██████▎   | 191/300 [01:50<01:00,  1.81it/s]tensor(0.6667, dtype=torch.float64) 0.6625050874199184
tensor(0.6802, dtype=torch.float64) 0.6837629412973802
tensor(0.5769, dtype=torch.float64) 0.5736280119944053
tensor(0.5129, dtype=torch.float64) 0.4596998024259643
tensor(0.5080, dtype=torch.float64) 0.4898642871465794
tensor(0.5892, dtype=torch.float64) 0.5695825480844251
tensor(0.5166, dtype=torch.float64) 0.45770888327494946
tensor(0.6359, dtype=torch.float64) 0.6155699462265771
tensor(0.6827, dtype=torch.float64) 0.6914845096027482

[Epoch 200] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6802, dtype=torch.float64) 0.6888014163258079
 67%|██████▋   | 201/300 [01:56<00:54,  1.81it/s]tensor(0.6396, dtype=torch.float64) 0.6377709923193801
tensor(0.5793, dtype=torch.float64) 0.5459286658461739
tensor(0.6125, dtype=torch.float64) 0.5705512586581113
tensor(0.6593, dtype=torch.float64) 0.6399128441570452
tensor(0.7097, dtype=torch.float64) 0.7081477337769267
tensor(0.6986, dtype=torch.float64) 0.6876004139431229
tensor(0.6359, dtype=torch.float64) 0.6223424295680233
tensor(0.6384, dtype=torch.float64) 0.6320450431527187
tensor(0.6790, dtype=torch.float64) 0.6691469719835578

[Epoch 210] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6790, dtype=torch.float64) 0.6693092741669104
 70%|███████   | 211/300 [02:01<00:49,  1.81it/s]tensor(0.7085, dtype=torch.float64) 0.6998663459893638
tensor(0.7196, dtype=torch.float64) 0.709177323046281
tensor(0.6913, dtype=torch.float64) 0.6867712984471303
tensor(0.6876, dtype=torch.float64) 0.6864120869170927
tensor(0.7146, dtype=torch.float64) 0.7127652858973788
tensor(0.7220, dtype=torch.float64) 0.7172431253598215
tensor(0.7294, dtype=torch.float64) 0.7235386717540362
tensor(0.7048, dtype=torch.float64) 0.7022641531213348
tensor(0.7073, dtype=torch.float64) 0.7032959613276607

[Epoch 220] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7073, dtype=torch.float64) 0.7032959613276607
 74%|███████▎  | 221/300 [02:07<00:43,  1.81it/s]tensor(0.7331, dtype=torch.float64) 0.7290805575532034
tensor(0.7282, dtype=torch.float64) 0.7238358484677619
tensor(0.7331, dtype=torch.float64) 0.7317295909637004
tensor(0.7109, dtype=torch.float64) 0.7082726878627229
tensor(0.7134, dtype=torch.float64) 0.7104303367332334
tensor(0.7429, dtype=torch.float64) 0.7401909078312525
tensor(0.7454, dtype=torch.float64) 0.7411322110274164
tensor(0.7171, dtype=torch.float64) 0.7126527213321003
tensor(0.7109, dtype=torch.float64) 0.7087187737587398

[Epoch 230] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7109, dtype=torch.float64) 0.7087187737587398
 77%|███████▋  | 231/300 [02:12<00:38,  1.82it/s]tensor(0.7405, dtype=torch.float64) 0.7390408370798222
tensor(0.7515, dtype=torch.float64) 0.7488495237108299
tensor(0.7097, dtype=torch.float64) 0.7053334495855812
tensor(0.7282, dtype=torch.float64) 0.7246941684670404
tensor(0.7478, dtype=torch.float64) 0.7472402227560643
tensor(0.7355, dtype=torch.float64) 0.7328886587106092
tensor(0.7122, dtype=torch.float64) 0.7084815853884256
tensor(0.7405, dtype=torch.float64) 0.7383442262778317
tensor(0.7232, dtype=torch.float64) 0.7194748851426962

[Epoch 240] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7257, dtype=torch.float64) 0.7219776950995439
 80%|████████  | 241/300 [02:18<00:32,  1.81it/s]tensor(0.7343, dtype=torch.float64) 0.7327333136000553
tensor(0.7171, dtype=torch.float64) 0.7157933886829962
tensor(0.7122, dtype=torch.float64) 0.7056973106391707
tensor(0.7196, dtype=torch.float64) 0.7198794767632266
tensor(0.6937, dtype=torch.float64) 0.6891100120340798
tensor(0.7109, dtype=torch.float64) 0.7120441425540467
tensor(0.7073, dtype=torch.float64) 0.703927705031434
tensor(0.7146, dtype=torch.float64) 0.713437367706452
tensor(0.7282, dtype=torch.float64) 0.7279780325985847

[Epoch 250] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7269, dtype=torch.float64) 0.7266423124453878
 84%|████████▎ | 251/300 [02:23<00:27,  1.81it/s]tensor(0.7220, dtype=torch.float64) 0.7182796691795024
tensor(0.7208, dtype=torch.float64) 0.7165651856214478
tensor(0.7220, dtype=torch.float64) 0.7282136727409598
tensor(0.6667, dtype=torch.float64) 0.6295026073411636
tensor(0.6654, dtype=torch.float64) 0.6711984848233927
tensor(0.6593, dtype=torch.float64) 0.6406128866753222
tensor(0.6814, dtype=torch.float64) 0.6707275078290615
tensor(0.6224, dtype=torch.float64) 0.608893950916438
tensor(0.5855, dtype=torch.float64) 0.5649088517927741

[Epoch 260] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5855, dtype=torch.float64) 0.5649088517927741
 87%|████████▋ | 261/300 [02:29<00:21,  1.81it/s]tensor(0.5892, dtype=torch.float64) 0.5934034423285018
tensor(0.5793, dtype=torch.float64) 0.576732408975435
tensor(0.5769, dtype=torch.float64) 0.5435247995513323
tensor(0.5966, dtype=torch.float64) 0.5655632770250146
tensor(0.5855, dtype=torch.float64) 0.5738980425372852
tensor(0.6359, dtype=torch.float64) 0.6448445661559
tensor(0.6494, dtype=torch.float64) 0.636058760091104
tensor(0.6089, dtype=torch.float64) 0.5943639186078739
tensor(0.6150, dtype=torch.float64) 0.5933458218486489

[Epoch 270] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6138, dtype=torch.float64) 0.592042493909233
 90%|█████████ | 271/300 [02:34<00:16,  1.81it/s]tensor(0.6765, dtype=torch.float64) 0.6581397790798696
tensor(0.6962, dtype=torch.float64) 0.6836756372746942
tensor(0.6765, dtype=torch.float64) 0.6594067352260764
tensor(0.6654, dtype=torch.float64) 0.6541328341066728
tensor(0.7257, dtype=torch.float64) 0.7223096365201399
tensor(0.7183, dtype=torch.float64) 0.7184571634960867
tensor(0.6863, dtype=torch.float64) 0.6759013781402574
tensor(0.6937, dtype=torch.float64) 0.6796145853407262
tensor(0.7294, dtype=torch.float64) 0.7254136462676333

[Epoch 280] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7294, dtype=torch.float64) 0.7254136462676333
 94%|█████████▎| 281/300 [02:40<00:10,  1.81it/s]tensor(0.7048, dtype=torch.float64) 0.7031410603584223
tensor(0.6913, dtype=torch.float64) 0.6865156168033419
tensor(0.7183, dtype=torch.float64) 0.7154378945434
tensor(0.7355, dtype=torch.float64) 0.736868895008788
tensor(0.6913, dtype=torch.float64) 0.6807866977109266
tensor(0.6913, dtype=torch.float64) 0.6873289974149362
tensor(0.7171, dtype=torch.float64) 0.7181287823351782
tensor(0.7306, dtype=torch.float64) 0.7298439611308102
tensor(0.7109, dtype=torch.float64) 0.7027010719422594

[Epoch 290] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7109, dtype=torch.float64) 0.7026467784002225
 97%|█████████▋| 291/300 [02:45<00:04,  1.81it/s]tensor(0.7380, dtype=torch.float64) 0.7345895390069633
tensor(0.7109, dtype=torch.float64) 0.711951540402678
tensor(0.7183, dtype=torch.float64) 0.7152544893979625
tensor(0.7245, dtype=torch.float64) 0.7203735252421511
tensor(0.7319, dtype=torch.float64) 0.7305476565339329
tensor(0.7171, dtype=torch.float64) 0.7133505590375
tensor(0.7269, dtype=torch.float64) 0.7243057304272111
tensor(0.7417, dtype=torch.float64) 0.7402731231950092
tensor(0.7380, dtype=torch.float64) 0.735518882555509
100%|██████████| 300/300 [02:45<00:00,  1.81it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 152.80s
  Phase 2 Time: 165.97s
  Total Time: 318.77s
  Best Accuracy: 0.7515
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Processing client 0...
  Processing client 1...
[Algorithm 2] Global feature initialized. Shape: torch.Size([1895, 1433])

--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4207, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0220, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241661.1719, Plain output norm: 25.7957
  Round 0/5, Loss: 0.4426
  [Round 1] Using MPC for secure forward pass...
tensor(0.1921, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0185, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2097, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0129, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2241, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0090, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1716, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0072, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.86s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
tensor(0.4216, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0195, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 241570.4531, Plain output norm: 25.7653
  Round 0/5, Loss: 0.4412
  [Round 1] Using MPC for secure forward pass...
tensor(0.1952, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0164, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2091, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0115, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2252, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0080, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1748, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0064, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.88s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 158.82s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.1611, dtype=torch.float64) 0.10263932568109019
  0%|          | 1/300 [00:05<28:45,  5.77s/it]tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.1624, dtype=torch.float64) 0.04535816786739297
tensor(0.1341, dtype=torch.float64) 0.03170016515783379
tensor(0.1341, dtype=torch.float64) 0.03170016515783379
tensor(0.1169, dtype=torch.float64) 0.024451235701784327
tensor(0.0750, dtype=torch.float64) 0.010473399928507293
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.3370, dtype=torch.float64) 0.2034105208660812
tensor(0.1451, dtype=torch.float64) 0.036792032796804874

[Epoch 10] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.1451, dtype=torch.float64) 0.036792032796804874
  4%|▎         | 11/300 [00:11<04:18,  1.12it/s]tensor(0.1451, dtype=torch.float64) 0.036792032796804874
tensor(0.1501, dtype=torch.float64) 0.04869816275285408
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.1648, dtype=torch.float64) 0.05033358650382463
tensor(0.1624, dtype=torch.float64) 0.04535816786739297
tensor(0.2681, dtype=torch.float64) 0.1255717254094153
tensor(0.1353, dtype=torch.float64) 0.03417611262150191
tensor(0.1341, dtype=torch.float64) 0.03170016515783379

[Epoch 20] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.1341, dtype=torch.float64) 0.03170016515783379
  7%|▋         | 21/300 [00:16<03:16,  1.42it/s]tensor(0.2977, dtype=torch.float64) 0.14120190972226548
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.1451, dtype=torch.float64) 0.036792032796804874
tensor(0.1451, dtype=torch.float64) 0.036792032796804874
tensor(0.1464, dtype=torch.float64) 0.03927312229707308

[Epoch 30] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.1464, dtype=torch.float64) 0.03927312229707308
 10%|█         | 31/300 [00:22<02:52,  1.56it/s]tensor(0.1501, dtype=torch.float64) 0.04650147396200785
tensor(0.3493, dtype=torch.float64) 0.22481165541491274
tensor(0.2964, dtype=torch.float64) 0.13867429676428958
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501

[Epoch 40] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2940, dtype=torch.float64) 0.1335732558846501
 14%|█▎        | 41/300 [00:28<02:38,  1.64it/s]tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3075, dtype=torch.float64) 0.15996340411198393
tensor(0.3555, dtype=torch.float64) 0.2359059222905355
tensor(0.2694, dtype=torch.float64) 0.19786453033590756
tensor(0.3456, dtype=torch.float64) 0.21274923232827683
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2940, dtype=torch.float64) 0.1335732558846501

[Epoch 50] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2940, dtype=torch.float64) 0.1335732558846501
 17%|█▋        | 51/300 [00:33<02:26,  1.70it/s]tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2940, dtype=torch.float64) 0.1335732558846501
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2964, dtype=torch.float64) 0.13867429676428958
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.2989, dtype=torch.float64) 0.14363376121412763
tensor(0.2964, dtype=torch.float64) 0.13867429676428958

[Epoch 60] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2964, dtype=torch.float64) 0.13867429676428958
 20%|██        | 61/300 [00:39<02:18,  1.73it/s]tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2964, dtype=torch.float64) 0.13867429676428958
tensor(0.2977, dtype=torch.float64) 0.1411713297304565

[Epoch 70] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2977, dtype=torch.float64) 0.1411713297304565
 24%|██▎       | 71/300 [00:44<02:11,  1.74it/s]tensor(0.2989, dtype=torch.float64) 0.14363376121412763
tensor(0.2989, dtype=torch.float64) 0.14363376121412763
tensor(0.2964, dtype=torch.float64) 0.13867429676428958
tensor(0.2964, dtype=torch.float64) 0.13867429676428958
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2952, dtype=torch.float64) 0.1361418756443776
tensor(0.2964, dtype=torch.float64) 0.13867429676428958

[Epoch 80] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.2964, dtype=torch.float64) 0.13867429676428958
 27%|██▋       | 81/300 [00:50<02:03,  1.77it/s]tensor(0.2977, dtype=torch.float64) 0.1411713297304565
tensor(0.2989, dtype=torch.float64) 0.14363376121412763
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3001, dtype=torch.float64) 0.14606235494099445

[Epoch 90] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3001, dtype=torch.float64) 0.14606235494099445
 30%|███       | 91/300 [00:55<01:57,  1.78it/s]tensor(0.3001, dtype=torch.float64) 0.14606235494099445
tensor(0.3014, dtype=torch.float64) 0.14845785252266022
tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3038, dtype=torch.float64) 0.15315241986574216

[Epoch 100] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3038, dtype=torch.float64) 0.15315241986574216
 34%|███▎      | 101/300 [01:01<01:51,  1.78it/s]tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3038, dtype=torch.float64) 0.15315241986574216
tensor(0.3075, dtype=torch.float64) 0.15996340411198393
tensor(0.3075, dtype=torch.float64) 0.15996340411198393
tensor(0.3087, dtype=torch.float64) 0.16217475636294823
tensor(0.3087, dtype=torch.float64) 0.16217475636294823
tensor(0.3075, dtype=torch.float64) 0.15996340411198393
tensor(0.3075, dtype=torch.float64) 0.15996340411198393
tensor(0.3075, dtype=torch.float64) 0.15996340411198393

[Epoch 110] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3075, dtype=torch.float64) 0.15996340411198393
 37%|███▋      | 111/300 [01:07<01:45,  1.79it/s]tensor(0.3075, dtype=torch.float64) 0.15996340411198393
tensor(0.3087, dtype=torch.float64) 0.16217475636294823
tensor(0.3124, dtype=torch.float64) 0.1685473032336501
tensor(0.3161, dtype=torch.float64) 0.17473880424680274
tensor(0.3210, dtype=torch.float64) 0.1826486095200461
tensor(0.3198, dtype=torch.float64) 0.1807067196885561
tensor(0.3161, dtype=torch.float64) 0.17473880424680274
tensor(0.3161, dtype=torch.float64) 0.17473880424680274
tensor(0.3161, dtype=torch.float64) 0.17473880424680274

[Epoch 120] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3161, dtype=torch.float64) 0.17473880424680274
 40%|████      | 121/300 [01:12<01:39,  1.79it/s]tensor(0.3260, dtype=torch.float64) 0.1901911698362267
tensor(0.3296, dtype=torch.float64) 0.19562366312943405
tensor(0.3333, dtype=torch.float64) 0.20087561425172643
tensor(0.3395, dtype=torch.float64) 0.2089775155557967
tensor(0.3419, dtype=torch.float64) 0.21219367988606214
tensor(0.3419, dtype=torch.float64) 0.21219367988606214
tensor(0.3419, dtype=torch.float64) 0.21416951607000262
tensor(0.3444, dtype=torch.float64) 0.21731891957936478
tensor(0.3579, dtype=torch.float64) 0.23301318912248545

[Epoch 130] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.3579, dtype=torch.float64) 0.23301318912248545
 44%|████▎     | 131/300 [01:18<01:34,  1.80it/s]tensor(0.3665, dtype=torch.float64) 0.24459365763592364
tensor(0.3776, dtype=torch.float64) 0.2567719524004594
tensor(0.3776, dtype=torch.float64) 0.2567719524004594
tensor(0.3715, dtype=torch.float64) 0.25131670158230074
tensor(0.3788, dtype=torch.float64) 0.25923202888911306
tensor(0.3801, dtype=torch.float64) 0.26055682679293374
tensor(0.3838, dtype=torch.float64) 0.26618012122322293
tensor(0.3813, dtype=torch.float64) 0.2613939628833891
tensor(0.4010, dtype=torch.float64) 0.28900907045770746

[Epoch 140] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4010, dtype=torch.float64) 0.28873302398851586
 47%|████▋     | 141/300 [01:23<01:28,  1.79it/s]tensor(0.4207, dtype=torch.float64) 0.3081251051757201
tensor(0.4367, dtype=torch.float64) 0.32799635163764107
tensor(0.4379, dtype=torch.float64) 0.3291064046102898
tensor(0.4231, dtype=torch.float64) 0.31336385262696603
tensor(0.4182, dtype=torch.float64) 0.3075224006801219
tensor(0.4465, dtype=torch.float64) 0.3466407807270294
tensor(0.4649, dtype=torch.float64) 0.37043381391523317
tensor(0.4760, dtype=torch.float64) 0.38394835664399135
tensor(0.4736, dtype=torch.float64) 0.38478438854884056

[Epoch 150] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.4736, dtype=torch.float64) 0.38478438854884056
 50%|█████     | 151/300 [01:29<01:22,  1.80it/s]tensor(0.4674, dtype=torch.float64) 0.38202852164298157
tensor(0.4760, dtype=torch.float64) 0.3846499315474843
tensor(0.4797, dtype=torch.float64) 0.3897711221055591
tensor(0.4834, dtype=torch.float64) 0.398504060013032
tensor(0.4945, dtype=torch.float64) 0.41013105155122753
tensor(0.5141, dtype=torch.float64) 0.43138927485151146
tensor(0.5166, dtype=torch.float64) 0.44820527781376857
tensor(0.5166, dtype=torch.float64) 0.4540038886034449
tensor(0.5437, dtype=torch.float64) 0.47227652628671923

[Epoch 160] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.5437, dtype=torch.float64) 0.47227652628671923
 54%|█████▎    | 161/300 [01:34<01:17,  1.80it/s]tensor(0.5363, dtype=torch.float64) 0.4689088879987803
tensor(0.5338, dtype=torch.float64) 0.4664168868968247
tensor(0.5560, dtype=torch.float64) 0.49364893396362797
tensor(0.5793, dtype=torch.float64) 0.5179596160816946
tensor(0.5683, dtype=torch.float64) 0.5200494042217557
tensor(0.5756, dtype=torch.float64) 0.5263222942348653
tensor(0.5904, dtype=torch.float64) 0.5362977044299545
tensor(0.5830, dtype=torch.float64) 0.5449314572930797
tensor(0.6150, dtype=torch.float64) 0.5719849830847558

[Epoch 170] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6150, dtype=torch.float64) 0.5723702402905321
 57%|█████▋    | 171/300 [01:40<01:11,  1.79it/s]tensor(0.6052, dtype=torch.float64) 0.558102631577245
tensor(0.5597, dtype=torch.float64) 0.5183235974766153
tensor(0.6052, dtype=torch.float64) 0.5640337867537469
tensor(0.6371, dtype=torch.float64) 0.597382953954715
tensor(0.6359, dtype=torch.float64) 0.6066138696061183
tensor(0.6212, dtype=torch.float64) 0.5894206370448196
tensor(0.6384, dtype=torch.float64) 0.6049599811218931
tensor(0.6556, dtype=torch.float64) 0.6326254495719437
tensor(0.6494, dtype=torch.float64) 0.6259559403450738

[Epoch 180] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6494, dtype=torch.float64) 0.6259559403450738
 60%|██████    | 181/300 [01:45<01:06,  1.80it/s]tensor(0.6507, dtype=torch.float64) 0.6189037175467175
tensor(0.6544, dtype=torch.float64) 0.6263996668522823
tensor(0.6630, dtype=torch.float64) 0.6437923520706424
tensor(0.6667, dtype=torch.float64) 0.6437173491972153
tensor(0.6494, dtype=torch.float64) 0.6214116313192615
tensor(0.6814, dtype=torch.float64) 0.6681866217764313
tensor(0.6962, dtype=torch.float64) 0.6821684187012272
tensor(0.6642, dtype=torch.float64) 0.6399196539080894
tensor(0.6777, dtype=torch.float64) 0.6598273310784729

[Epoch 190] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6765, dtype=torch.float64) 0.65885294485126
 64%|██████▎   | 191/300 [01:51<01:00,  1.80it/s]tensor(0.6728, dtype=torch.float64) 0.6624670068929003
tensor(0.6494, dtype=torch.float64) 0.6224114953489125
tensor(0.6814, dtype=torch.float64) 0.6640508131287794
tensor(0.6851, dtype=torch.float64) 0.6798604067144169
tensor(0.6974, dtype=torch.float64) 0.6866794233398751
tensor(0.6777, dtype=torch.float64) 0.6564052677977582
tensor(0.6494, dtype=torch.float64) 0.6377717702947858
tensor(0.7196, dtype=torch.float64) 0.7227880303494706
tensor(0.7122, dtype=torch.float64) 0.6953096811722376

[Epoch 200] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7122, dtype=torch.float64) 0.6953684490002001
 67%|██████▋   | 201/300 [01:57<00:54,  1.80it/s]tensor(0.6679, dtype=torch.float64) 0.6435809759306321
tensor(0.7319, dtype=torch.float64) 0.7257100044662507
tensor(0.7355, dtype=torch.float64) 0.7355469994240992
tensor(0.6765, dtype=torch.float64) 0.6608234638697387
tensor(0.7036, dtype=torch.float64) 0.6880267562707647
tensor(0.7232, dtype=torch.float64) 0.7202821041450234
tensor(0.7257, dtype=torch.float64) 0.7240233377463314
tensor(0.7208, dtype=torch.float64) 0.7105501605995198
tensor(0.6900, dtype=torch.float64) 0.6790790464901779

[Epoch 210] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6900, dtype=torch.float64) 0.6790790464901779
 70%|███████   | 211/300 [02:02<00:49,  1.80it/s]tensor(0.7466, dtype=torch.float64) 0.748240218477475
tensor(0.7294, dtype=torch.float64) 0.7236219725018423
tensor(0.7183, dtype=torch.float64) 0.7055106641549569
tensor(0.7454, dtype=torch.float64) 0.740752896274337
tensor(0.7048, dtype=torch.float64) 0.7020118828011536
tensor(0.7589, dtype=torch.float64) 0.7561689179733231
tensor(0.7146, dtype=torch.float64) 0.7032300318791249
tensor(0.7528, dtype=torch.float64) 0.7481259415645438
tensor(0.7429, dtype=torch.float64) 0.7422729613811868

[Epoch 220] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7429, dtype=torch.float64) 0.7423033593268764
 74%|███████▎  | 221/300 [02:08<00:43,  1.81it/s]tensor(0.7380, dtype=torch.float64) 0.733883570281856
tensor(0.7478, dtype=torch.float64) 0.7410358333656526
tensor(0.7282, dtype=torch.float64) 0.7202411632041148
tensor(0.7220, dtype=torch.float64) 0.7256620196480702
tensor(0.6839, dtype=torch.float64) 0.6610647051726001
tensor(0.7282, dtype=torch.float64) 0.72467321072301
tensor(0.7023, dtype=torch.float64) 0.6994130220158918
tensor(0.7454, dtype=torch.float64) 0.7443045527324375
tensor(0.6716, dtype=torch.float64) 0.6568134891726015

[Epoch 230] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6704, dtype=torch.float64) 0.6562154808766439
 77%|███████▋  | 231/300 [02:13<00:38,  1.80it/s]tensor(0.6937, dtype=torch.float64) 0.6773223193312202
tensor(0.7343, dtype=torch.float64) 0.7410223472401339
tensor(0.7060, dtype=torch.float64) 0.697865466733464
tensor(0.7331, dtype=torch.float64) 0.7290657004242437
tensor(0.7183, dtype=torch.float64) 0.71014783755893
tensor(0.7405, dtype=torch.float64) 0.737123044082495
tensor(0.7294, dtype=torch.float64) 0.7281004124115262
tensor(0.6470, dtype=torch.float64) 0.6344042019396656
tensor(0.6765, dtype=torch.float64) 0.6883522066333104

[Epoch 240] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6765, dtype=torch.float64) 0.6883522066333104
 80%|████████  | 241/300 [02:19<00:32,  1.80it/s]tensor(0.7097, dtype=torch.float64) 0.6988819344477902
tensor(0.7011, dtype=torch.float64) 0.6876328423478851
tensor(0.7073, dtype=torch.float64) 0.7162011137251202
tensor(0.7245, dtype=torch.float64) 0.7211188441020925
tensor(0.6900, dtype=torch.float64) 0.6799989607645407
tensor(0.6814, dtype=torch.float64) 0.6796824818695747
tensor(0.6913, dtype=torch.float64) 0.6813913364782724
tensor(0.6962, dtype=torch.float64) 0.6894160953536094
tensor(0.7589, dtype=torch.float64) 0.7562283170490425

[Epoch 250] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7589, dtype=torch.float64) 0.7562283170490425
 84%|████████▎ | 251/300 [02:24<00:27,  1.80it/s]tensor(0.7060, dtype=torch.float64) 0.6872859713445133
tensor(0.7392, dtype=torch.float64) 0.7354404204471826
tensor(0.7417, dtype=torch.float64) 0.744768431537255
tensor(0.7245, dtype=torch.float64) 0.7117208710162217
tensor(0.7183, dtype=torch.float64) 0.7135688986948876
tensor(0.7331, dtype=torch.float64) 0.7285071433932904
tensor(0.7466, dtype=torch.float64) 0.7449748290863626
tensor(0.7331, dtype=torch.float64) 0.7319847031506542
tensor(0.7405, dtype=torch.float64) 0.7344979248305584

[Epoch 260] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7392, dtype=torch.float64) 0.7331066486849458
 87%|████████▋ | 261/300 [02:30<00:21,  1.80it/s]tensor(0.7528, dtype=torch.float64) 0.753479887435518
tensor(0.7159, dtype=torch.float64) 0.7056335469511983
tensor(0.7282, dtype=torch.float64) 0.7302195010756413
tensor(0.7368, dtype=torch.float64) 0.7346839135840649
tensor(0.7331, dtype=torch.float64) 0.7266626808574373
tensor(0.7319, dtype=torch.float64) 0.7192002324424605
tensor(0.7663, dtype=torch.float64) 0.766004171156959
tensor(0.7528, dtype=torch.float64) 0.750463382699385
tensor(0.7380, dtype=torch.float64) 0.7301438544208673

[Epoch 270] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7368, dtype=torch.float64) 0.7288205046917455
 90%|█████████ | 271/300 [02:35<00:16,  1.79it/s]tensor(0.7491, dtype=torch.float64) 0.7480725364368339
tensor(0.7011, dtype=torch.float64) 0.6924634401181163
tensor(0.7134, dtype=torch.float64) 0.716413444038092
tensor(0.6986, dtype=torch.float64) 0.6779285395711723
tensor(0.7220, dtype=torch.float64) 0.719413983899695
tensor(0.7122, dtype=torch.float64) 0.6999955090927632
tensor(0.7282, dtype=torch.float64) 0.7301504234443499
tensor(0.6925, dtype=torch.float64) 0.6807689362646342
tensor(0.7552, dtype=torch.float64) 0.7566868400983547

[Epoch 280] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.7565, dtype=torch.float64) 0.7579357728635252
 94%|█████████▎| 281/300 [02:41<00:10,  1.80it/s]tensor(0.7442, dtype=torch.float64) 0.7402497759966541
tensor(0.7036, dtype=torch.float64) 0.6940478393811029
tensor(0.7245, dtype=torch.float64) 0.7292444263310346
tensor(0.7405, dtype=torch.float64) 0.7364938960571692
tensor(0.6827, dtype=torch.float64) 0.6721587382529821
tensor(0.6691, dtype=torch.float64) 0.6745329004437383
tensor(0.6937, dtype=torch.float64) 0.6811112047563834
tensor(0.5695, dtype=torch.float64) 0.5792840411451436
tensor(0.6593, dtype=torch.float64) 0.6176613388932005

[Epoch 290] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Client 1: Encrypted gradient shape torch.Size([1433, 1433])
  [Server] Aggregating encrypted gradients...
  [Client 0] Decrypting aggregated gradient...
[Algorithm 3] Gradient update completed.

tensor(0.6593, dtype=torch.float64) 0.6176613388932005
 97%|█████████▋| 291/300 [02:47<00:04,  1.80it/s]tensor(0.6704, dtype=torch.float64) 0.6389656367986514
tensor(0.6765, dtype=torch.float64) 0.6798380203842871
tensor(0.6150, dtype=torch.float64) 0.6269167675265979
tensor(0.6950, dtype=torch.float64) 0.6658841943810102
tensor(0.6913, dtype=torch.float64) 0.6526942473945032
tensor(0.7577, dtype=torch.float64) 0.7571506274452936
tensor(0.5461, dtype=torch.float64) 0.5680259328912433
tensor(0.7171, dtype=torch.float64) 0.7042727677921854
tensor(0.7294, dtype=torch.float64) 0.7212044616578043
100%|██████████| 300/300 [02:47<00:00,  1.80it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 158.82s
  Phase 2 Time: 167.10s
  Total Time: 325.92s
  Best Accuracy: 0.7663
============================================================

using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Computing Z = Σ(X_k * W_k) using MPC...
  Processing Client 0...
    X_k shape: torch.Size([1895, 1433]), W_k shape: torch.Size([1433, 1433])
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 337, in <module>
    global_features = algorithm_2_global_feature_init(user_features, local_model, mpc_beaver, client_num)
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 191, in algorithm_2_global_feature_init
    z_share = mpc_beaver.secure_matmul(
TypeError: secure_matmul() got an unexpected keyword argument 'client_id'
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Computing Z = Σ(X_k * W_k) using MPC...
  Processing Client 0...
    X_k shape: torch.Size([1895, 1433]), W_k shape: torch.Size([1433, 1433])
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 337, in <module>
    global_features = algorithm_2_global_feature_init(user_features, local_model, mpc_beaver, client_num)
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 191, in algorithm_2_global_feature_init
    z_share = mpc_beaver.secure_matmul(
  File "/home/lxt/project/MVFIGN/crypto_utils.py", line 92, in secure_matmul
    device = x_share.device  # 获取输入张量的设备
AttributeError: 'list' object has no attribute 'device'
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Computing Z = Σ(X_k * W_k) using MPC...
  Processing Client 0...
    X_k shape: torch.Size([1895, 1433]), W_k shape: torch.Size([1433, 1433])
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 337, in <module>
    global_features = algorithm_2_global_feature_init(user_features, local_model, mpc_beaver, client_num)
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 191, in algorithm_2_global_feature_init
    z_share = mpc_beaver.secure_matmul(
  File "/home/lxt/project/MVFIGN/crypto_utils.py", line 105, in secure_matmul
    alpha = self.reveal([x_shares[i] - triplet_shares[i][0].to(device) 
AttributeError: 'MPCBeaver' object has no attribute 'reveal'
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Computing Z = Σ(X_k * W_k) using MPC...
  Processing Client 0...
    X_k shape: torch.Size([1895, 1433]), W_k shape: torch.Size([1433, 1433])
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 337, in <module>
    global_features = algorithm_2_global_feature_init(user_features, local_model, mpc_beaver, client_num)
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 191, in algorithm_2_global_feature_init
    z_share = mpc_beaver.secure_matmul(
  File "/home/lxt/project/MVFIGN/crypto_utils.py", line 105, in secure_matmul
    alpha = self.reveal([x_shares[i] - triplet_shares[i][0].to(device) 
AttributeError: 'MPCBeaver' object has no attribute 'reveal'
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Computing Z = Σ(X_k * W_k) using MPC...
  Processing Client 0...
    X_k shape: torch.Size([1895, 1433]), W_k shape: torch.Size([1433, 1433])
Traceback (most recent call last):
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 337, in <module>
    global_features = algorithm_2_global_feature_init(user_features, local_model, mpc_beaver, client_num)
  File "/home/lxt/project/MVFIGN/v_main_mpche_2.py", line 191, in algorithm_2_global_feature_init
    z_share = mpc_beaver.secure_matmul(
AttributeError: 'MPCBeaver' object has no attribute 'secure_matmul'
using device 0 NVIDIA GeForce RTX 3090
DEVICE: cuda
client_num: 2
Initializing BFV encryption scheme...
Encryption initialization completed.

============================================================
Phase 1: Local Training with Encrypted Parameter Transmission
============================================================

[Algorithm 2] Initializing global features with MPC...
  Computing Z = Σ(X_k * W_k) using MPC...
  Processing Client 0...
    X_k shape: torch.Size([1895, 1433]), W_k shape: torch.Size([1433, 1433])
    Z_0 computed, shape: torch.Size([1895, 1433])
  Processing Client 1...
    X_k shape: torch.Size([1895, 1433]), W_k shape: torch.Size([1433, 1433])
    Z_1 computed, shape: torch.Size([1895, 1433])
[Algorithm 2] Global feature initialized successfully!
  Final shape: torch.Size([1895, 1433])
  Value range: [-2648.3618, 2787.8291]

Global features initialized with shape: torch.Size([1895, 1433])
Storing global features for unsupervised training...


--- Training Client 0 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
  Using global features (shape: torch.Size([1895, 1433])) in loss computation
tensor(0.4448, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0221, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 360652.2500, Plain output norm: 26.6517
  Round 0/5, Loss: 0.4669
  [Round 1] Using MPC for secure forward pass...
tensor(0.1833, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0189, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2180, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0132, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2349, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0092, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1736, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0073, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 0] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 0] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 0...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.82s
[Client 0] Parameters distributed securely to all clients.


--- Training Client 1 ---
[MPC] Generating Beaver triplets for shape x(1895, 1433), w(1433, 1433)...
[MPC] Beaver triplets generated successfully.
  [Round 0] Using MPC for secure forward pass...
  Using global features (shape: torch.Size([1895, 1433])) in loss computation
tensor(0.4272, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0204, device='cuda:0', grad_fn=<MeanBackward0>)
  MPC output norm: 361970.1875, Plain output norm: 26.0208
  Round 0/5, Loss: 0.4476
  [Round 1] Using MPC for secure forward pass...
tensor(0.1918, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0173, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 2] Using MPC for secure forward pass...
tensor(0.2128, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0121, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 3] Using MPC for secure forward pass...
tensor(0.2261, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0084, device='cuda:0', grad_fn=<MeanBackward0>)
  [Round 4] Using MPC for secure forward pass...
tensor(0.1733, device='cuda:0', dtype=torch.float16, grad_fn=<DivBackward0>) tensor(0.0067, device='cuda:0', grad_fn=<MeanBackward0>)

[Client 1] Encrypting model parameters with BFV...
  Encrypted parameter 'fc1.weight' with shape torch.Size([1433, 1433])
  Encrypted parameter 'fc1.bias' with shape torch.Size([1433])
[Client 1] Encryption completed. Total: 2 parameters.

[Server] Aggregating encrypted parameters from client 1...
[Clients] Receiving and decrypting aggregated parameters...
[Clients] Decryption time: 1.85s
[Client 1] Parameters distributed securely to all clients.

============================================================
Phase 1 completed in 153.58s (with HE encryption)
Phase 1 Completed: All clients trained with encrypted parameter sharing
============================================================


============================================================
Phase 2: Global Model Training
============================================================
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
tran.0.fc1.weight
tran.0.fc1.bias
tran.1.fc1.weight
tran.1.fc1.bias
classifier.fc1.weight
classifier.fc1.bias
classifier.fc2.weight
classifier.fc2.bias
classifier.layernorm.weight
classifier.layernorm.bias
  0%|          | 0/300 [00:00<?, ?it/s]
[Epoch 0] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 6.8939
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 6.3605
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 12.7863
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.1648, dtype=torch.float64) 0.059344695814036744
  0%|          | 1/300 [00:05<28:14,  5.67s/it]tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.1464, dtype=torch.float64) 0.0373781205623215
tensor(0.1402, dtype=torch.float64) 0.034488111871409974
tensor(0.1402, dtype=torch.float64) 0.034675140677654065
tensor(0.0652, dtype=torch.float64) 0.007979456237980393
tensor(0.2349, dtype=torch.float64) 0.16919401938081935
tensor(0.1230, dtype=torch.float64) 0.03473350156519604
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893

[Epoch 10] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 6.6289
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 6.1145
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 12.2670
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3014, dtype=torch.float64) 0.13956803084098893
  4%|▎         | 11/300 [00:11<04:17,  1.12it/s]tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.1611, dtype=torch.float64) 0.04472084975087039
tensor(0.1611, dtype=torch.float64) 0.04472084975087039
tensor(0.1611, dtype=torch.float64) 0.04472084975087039
tensor(0.2017, dtype=torch.float64) 0.11111129252885449
tensor(0.1648, dtype=torch.float64) 0.07685031640489204
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893

[Epoch 20] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 6.3815
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.8850
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 11.7830
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3014, dtype=torch.float64) 0.13956803084098893
  7%|▋         | 21/300 [00:16<03:14,  1.43it/s]tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.14177909982460446
tensor(0.3678, dtype=torch.float64) 0.23980759942395263
tensor(0.3173, dtype=torch.float64) 0.23461767892167112
tensor(0.3690, dtype=torch.float64) 0.25205357423672037
tensor(0.3223, dtype=torch.float64) 0.1819233980035657
tensor(0.1710, dtype=torch.float64) 0.06413418481736294

[Epoch 30] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 6.1502
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.6706
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 11.3292
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.1710, dtype=torch.float64) 0.06413418481736294
 10%|█         | 31/300 [00:22<02:49,  1.58it/s]tensor(0.1611, dtype=torch.float64) 0.04472084975087039
tensor(0.2854, dtype=torch.float64) 0.21730428372494792
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3026, dtype=torch.float64) 0.14213959689265768

[Epoch 40] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.9339
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.4702
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 10.9069
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3026, dtype=torch.float64) 0.14213959689265768
 14%|█▎        | 41/300 [00:27<02:35,  1.67it/s]tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893

[Epoch 50] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.7313
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.2828
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 10.5102
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3014, dtype=torch.float64) 0.13956803084098893
 17%|█▋        | 51/300 [00:33<02:25,  1.72it/s]tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893

[Epoch 60] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.5416
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.1073
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 10.1378
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3014, dtype=torch.float64) 0.13956803084098893
 20%|██        | 61/300 [00:38<02:15,  1.76it/s]tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893

[Epoch 70] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.3638
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.9430
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 9.7885
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3014, dtype=torch.float64) 0.13956803084098893
 24%|██▎       | 71/300 [00:44<02:08,  1.79it/s]tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3014, dtype=torch.float64) 0.13956803084098893
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3026, dtype=torch.float64) 0.14213959689265768

[Epoch 80] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.1969
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.7889
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 9.4598
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3026, dtype=torch.float64) 0.14213959689265768
 27%|██▋       | 81/300 [00:49<02:02,  1.79it/s]tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3026, dtype=torch.float64) 0.14213959689265768
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438

[Epoch 90] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 5.0403
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.6443
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 9.1519
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3038, dtype=torch.float64) 0.14467109030594438
 30%|███       | 91/300 [00:55<01:56,  1.80it/s]tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438
tensor(0.3038, dtype=torch.float64) 0.14467109030594438

[Epoch 100] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.8930
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.5085
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 8.8626
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3038, dtype=torch.float64) 0.14467109030594438
 34%|███▎      | 101/300 [01:00<01:50,  1.81it/s]tensor(0.3050, dtype=torch.float64) 0.147163503334202
tensor(0.3063, dtype=torch.float64) 0.14961779598820657
tensor(0.3087, dtype=torch.float64) 0.15441570674261873
tensor(0.3075, dtype=torch.float64) 0.1520348973363826
tensor(0.3063, dtype=torch.float64) 0.14961779598820657
tensor(0.3050, dtype=torch.float64) 0.147163503334202
tensor(0.3075, dtype=torch.float64) 0.1520348973363826
tensor(0.3124, dtype=torch.float64) 0.1613489557500437
tensor(0.3137, dtype=torch.float64) 0.16359303704877987

[Epoch 110] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.7545
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.3809
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 8.5892
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3137, dtype=torch.float64) 0.16359303704877987
 37%|███▋      | 111/300 [01:06<01:44,  1.81it/s]tensor(0.3137, dtype=torch.float64) 0.16359303704877987
tensor(0.3137, dtype=torch.float64) 0.16359303704877987
tensor(0.3137, dtype=torch.float64) 0.16359303704877987
tensor(0.3137, dtype=torch.float64) 0.16359303704877987
tensor(0.3137, dtype=torch.float64) 0.16359303704877987
tensor(0.3186, dtype=torch.float64) 0.17225467777968767
tensor(0.3260, dtype=torch.float64) 0.1842148026108998
tensor(0.3296, dtype=torch.float64) 0.1898920477078599
tensor(0.3260, dtype=torch.float64) 0.1842148026108998

[Epoch 120] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.6241
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.2608
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 8.3326
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3260, dtype=torch.float64) 0.1842148026108998
 40%|████      | 121/300 [01:11<01:38,  1.81it/s]tensor(0.3260, dtype=torch.float64) 0.1842148026108998
tensor(0.3296, dtype=torch.float64) 0.1898920477078599
tensor(0.3383, dtype=torch.float64) 0.20232947801727286
tensor(0.3530, dtype=torch.float64) 0.2204284137703037
tensor(0.3592, dtype=torch.float64) 0.22692204186880466
tensor(0.3579, dtype=torch.float64) 0.22553184235759208
tensor(0.3469, dtype=torch.float64) 0.21346341598470206
tensor(0.3456, dtype=torch.float64) 0.21189339094589896
tensor(0.3579, dtype=torch.float64) 0.2261725551180561

[Epoch 130] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.5013
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.1477
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 8.0906
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3579, dtype=torch.float64) 0.2261725551180561
 44%|████▎     | 131/300 [01:17<01:32,  1.83it/s]tensor(0.3702, dtype=torch.float64) 0.23775022072729127
tensor(0.3715, dtype=torch.float64) 0.23829495612562068
tensor(0.3715, dtype=torch.float64) 0.23829495612562068
tensor(0.3653, dtype=torch.float64) 0.2347120984049181
tensor(0.3715, dtype=torch.float64) 0.24030726649240905
tensor(0.3985, dtype=torch.float64) 0.25673079343971383
tensor(0.3924, dtype=torch.float64) 0.2510721657381485
tensor(0.3702, dtype=torch.float64) 0.2377178434996785
tensor(0.3715, dtype=torch.float64) 0.2406225774214264

[Epoch 140] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.3854
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.0410
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 7.8612
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.3702, dtype=torch.float64) 0.2380334606011035
 47%|████▋     | 141/300 [01:22<01:26,  1.83it/s]tensor(0.3973, dtype=torch.float64) 0.2564051690395869
tensor(0.3973, dtype=torch.float64) 0.2593399063101658
tensor(0.3862, dtype=torch.float64) 0.2544598192396122
tensor(0.3961, dtype=torch.float64) 0.2565466612637899
tensor(0.4071, dtype=torch.float64) 0.26185145646482666
tensor(0.4059, dtype=torch.float64) 0.2635417403973748
tensor(0.3985, dtype=torch.float64) 0.2598298643861443
tensor(0.4059, dtype=torch.float64) 0.2640572468146137
tensor(0.4145, dtype=torch.float64) 0.26591556093179913

[Epoch 150] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.2759
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.9404
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 7.6450
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.4145, dtype=torch.float64) 0.2660526361777
 50%|█████     | 151/300 [01:27<01:20,  1.84it/s]tensor(0.3961, dtype=torch.float64) 0.25883302076090514
tensor(0.3973, dtype=torch.float64) 0.2595660753197745
tensor(0.4170, dtype=torch.float64) 0.26956457004204565
tensor(0.4022, dtype=torch.float64) 0.26313940896115673
tensor(0.4096, dtype=torch.float64) 0.26871415549831373
tensor(0.4244, dtype=torch.float64) 0.28276497269192297
tensor(0.4207, dtype=torch.float64) 0.29312947645874793
tensor(0.4231, dtype=torch.float64) 0.28642493483758363
tensor(0.4231, dtype=torch.float64) 0.2837511698266225

[Epoch 160] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.1725
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.8453
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 7.4413
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.4207, dtype=torch.float64) 0.28065966779223184
 54%|█████▎    | 161/300 [01:33<01:15,  1.84it/s]tensor(0.4244, dtype=torch.float64) 0.29572138998733183
tensor(0.4268, dtype=torch.float64) 0.2995520819906903
tensor(0.4330, dtype=torch.float64) 0.3044077255680336
tensor(0.4268, dtype=torch.float64) 0.3002031946158782
tensor(0.4367, dtype=torch.float64) 0.31155776893088977
tensor(0.4526, dtype=torch.float64) 0.3355905757172416
tensor(0.4477, dtype=torch.float64) 0.33713483837671426
tensor(0.4662, dtype=torch.float64) 0.3589921218535829
tensor(0.4613, dtype=torch.float64) 0.3598895725592256

[Epoch 170] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 4.0746
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.7554
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 7.2490
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.4613, dtype=torch.float64) 0.3598895725592256
 57%|█████▋    | 171/300 [01:38<01:09,  1.85it/s]tensor(0.5018, dtype=torch.float64) 0.4196548079091774
tensor(0.5055, dtype=torch.float64) 0.42881499944858936
tensor(0.4674, dtype=torch.float64) 0.36557575441922957
tensor(0.5289, dtype=torch.float64) 0.4575108605080586
tensor(0.5572, dtype=torch.float64) 0.49953879199183465
tensor(0.4699, dtype=torch.float64) 0.3650086714285579
tensor(0.4502, dtype=torch.float64) 0.3457112478087738
tensor(0.5781, dtype=torch.float64) 0.5214583065138311
tensor(0.5597, dtype=torch.float64) 0.5037559364654266

[Epoch 180] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.9819
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.6703
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 7.0650
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.5597, dtype=torch.float64) 0.5038706023681975
 60%|██████    | 181/300 [01:44<01:04,  1.85it/s]tensor(0.4846, dtype=torch.float64) 0.38422365380114754
tensor(0.5289, dtype=torch.float64) 0.46190819574871717
tensor(0.6298, dtype=torch.float64) 0.5803562710313142
tensor(0.5449, dtype=torch.float64) 0.4772623913150431
tensor(0.5018, dtype=torch.float64) 0.4241299228021909
tensor(0.6015, dtype=torch.float64) 0.545670741428933
tensor(0.5597, dtype=torch.float64) 0.5039732311282752
tensor(0.5228, dtype=torch.float64) 0.4475896645332752
tensor(0.5978, dtype=torch.float64) 0.5431837780208488

[Epoch 190] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.8940
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.5896
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 6.8915
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.5978, dtype=torch.float64) 0.5432915685155953
 64%|██████▎   | 191/300 [01:49<00:58,  1.85it/s]tensor(0.6261, dtype=torch.float64) 0.5841815613813812
tensor(0.5535, dtype=torch.float64) 0.49245734017802906
tensor(0.5695, dtype=torch.float64) 0.5210317502742572
tensor(0.6458, dtype=torch.float64) 0.5991938857265517
tensor(0.6150, dtype=torch.float64) 0.5632866927389087
tensor(0.5966, dtype=torch.float64) 0.542107834267542
tensor(0.6347, dtype=torch.float64) 0.5866528854353293
tensor(0.6285, dtype=torch.float64) 0.5887669745732474
tensor(0.5855, dtype=torch.float64) 0.529609350966313

[Epoch 200] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.8106
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.5131
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 6.7266
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.5855, dtype=torch.float64) 0.5298075437908589
 67%|██████▋   | 201/300 [01:54<00:53,  1.85it/s]tensor(0.6556, dtype=torch.float64) 0.618775831649864
tensor(0.6224, dtype=torch.float64) 0.5770291883141893
tensor(0.5781, dtype=torch.float64) 0.5276834065162059
tensor(0.6888, dtype=torch.float64) 0.6586132844550959
tensor(0.6617, dtype=torch.float64) 0.6304979588659422
tensor(0.5720, dtype=torch.float64) 0.5181353901968957
tensor(0.6740, dtype=torch.float64) 0.637117287898236
tensor(0.6888, dtype=torch.float64) 0.6586083794015449
tensor(0.5744, dtype=torch.float64) 0.5314060766053004

[Epoch 210] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.7314
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.4404
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 6.5701
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.5744, dtype=torch.float64) 0.5314060766053004
 70%|███████   | 211/300 [02:00<00:47,  1.86it/s]tensor(0.6802, dtype=torch.float64) 0.6497758879103503
tensor(0.7011, dtype=torch.float64) 0.6722666636878477
tensor(0.6175, dtype=torch.float64) 0.5816186737229827
tensor(0.6654, dtype=torch.float64) 0.6313700873746807
tensor(0.6900, dtype=torch.float64) 0.6590419345493158
tensor(0.6359, dtype=torch.float64) 0.6025787442605913
tensor(0.6642, dtype=torch.float64) 0.6338361347736816
tensor(0.6962, dtype=torch.float64) 0.668847539473043
tensor(0.6445, dtype=torch.float64) 0.611240439462818

[Epoch 220] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.6560
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.3713
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 6.4205
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.6445, dtype=torch.float64) 0.611240439462818
 74%|███████▎  | 221/300 [02:05<00:42,  1.86it/s]tensor(0.6581, dtype=torch.float64) 0.6255716982806112
tensor(0.7060, dtype=torch.float64) 0.6815728616268322
tensor(0.6396, dtype=torch.float64) 0.6056880734981318
tensor(0.6716, dtype=torch.float64) 0.6397744984524343
tensor(0.7146, dtype=torch.float64) 0.6868333935495331
tensor(0.6568, dtype=torch.float64) 0.6247766965459803
tensor(0.6617, dtype=torch.float64) 0.6331291857294045
tensor(0.7196, dtype=torch.float64) 0.6968992584012546
tensor(0.6851, dtype=torch.float64) 0.6553568422540436

[Epoch 230] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.5843
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.3055
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 6.2787
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.6851, dtype=torch.float64) 0.6553568422540436
 77%|███████▋  | 231/300 [02:10<00:37,  1.86it/s]tensor(0.6630, dtype=torch.float64) 0.6305727426106308
tensor(0.7122, dtype=torch.float64) 0.6874925629338821
tensor(0.6519, dtype=torch.float64) 0.6212898630353726
tensor(0.6716, dtype=torch.float64) 0.6390143474130077
tensor(0.7134, dtype=torch.float64) 0.6877204300525895
tensor(0.6556, dtype=torch.float64) 0.6260377495706743
tensor(0.6986, dtype=torch.float64) 0.6736583421987195
tensor(0.7245, dtype=torch.float64) 0.7003437108865458
tensor(0.6950, dtype=torch.float64) 0.6747957223124444

[Epoch 240] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.5160
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.2428
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 6.1434
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.6950, dtype=torch.float64) 0.6747957223124444
 80%|████████  | 241/300 [02:16<00:31,  1.86it/s]tensor(0.6950, dtype=torch.float64) 0.6751395114603546
tensor(0.7171, dtype=torch.float64) 0.694570559442466
tensor(0.7048, dtype=torch.float64) 0.6779928235135303
tensor(0.6716, dtype=torch.float64) 0.6405855943889424
tensor(0.7060, dtype=torch.float64) 0.6813701905533828
tensor(0.6900, dtype=torch.float64) 0.6650327677553942
tensor(0.7036, dtype=torch.float64) 0.6799866148334776
tensor(0.7048, dtype=torch.float64) 0.6821322072960665
tensor(0.7073, dtype=torch.float64) 0.6861175502272747

[Epoch 250] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.4508
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.1831
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 6.0140
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.7073, dtype=torch.float64) 0.6859751690734339
 84%|████████▎ | 251/300 [02:21<00:26,  1.87it/s]tensor(0.6900, dtype=torch.float64) 0.6616080563198424
tensor(0.6937, dtype=torch.float64) 0.6695749757728684
tensor(0.7257, dtype=torch.float64) 0.7107043315803692
tensor(0.6777, dtype=torch.float64) 0.6514969383323167
tensor(0.7232, dtype=torch.float64) 0.7036693604320068
tensor(0.6937, dtype=torch.float64) 0.670805293818194
tensor(0.6999, dtype=torch.float64) 0.6802135650192506
tensor(0.7183, dtype=torch.float64) 0.6973457818408327
tensor(0.7073, dtype=torch.float64) 0.6868637670103227

[Epoch 260] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.3886
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.1260
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 5.8908
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.7060, dtype=torch.float64) 0.6853410770933464
 87%|████████▋ | 261/300 [02:26<00:20,  1.87it/s]tensor(0.7220, dtype=torch.float64) 0.7055861325733752
tensor(0.7171, dtype=torch.float64) 0.6961148194562815
tensor(0.7146, dtype=torch.float64) 0.6921865851268854
tensor(0.7171, dtype=torch.float64) 0.6954222569449411
tensor(0.7097, dtype=torch.float64) 0.6882376109200296
tensor(0.7183, dtype=torch.float64) 0.700262349781915
tensor(0.7220, dtype=torch.float64) 0.7122009856879903
tensor(0.6999, dtype=torch.float64) 0.685676819282222
tensor(0.7355, dtype=torch.float64) 0.7215410559286466

[Epoch 270] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.3292
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.0715
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 5.7729
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.7355, dtype=torch.float64) 0.7215410559286466
 90%|█████████ | 271/300 [02:32<00:15,  1.86it/s]tensor(0.7146, dtype=torch.float64) 0.6973792851298709
tensor(0.7134, dtype=torch.float64) 0.6999396947540453
tensor(0.7036, dtype=torch.float64) 0.6853024668093419
tensor(0.7060, dtype=torch.float64) 0.6854817602341124
tensor(0.7232, dtype=torch.float64) 0.7063298932763628
tensor(0.7122, dtype=torch.float64) 0.7012199722633272
tensor(0.7306, dtype=torch.float64) 0.7232311161642769
tensor(0.7183, dtype=torch.float64) 0.7064866622246616
tensor(0.6777, dtype=torch.float64) 0.6599986565610495

[Epoch 280] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.2723
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.0193
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 5.6603
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.6777, dtype=torch.float64) 0.6600636881861466
 94%|█████████▎| 281/300 [02:37<00:10,  1.87it/s]tensor(0.7085, dtype=torch.float64) 0.700433652768799
tensor(0.6999, dtype=torch.float64) 0.679308324952187
tensor(0.7282, dtype=torch.float64) 0.7218840627250137
tensor(0.6863, dtype=torch.float64) 0.671969035007218
tensor(0.7294, dtype=torch.float64) 0.7172719159640255
tensor(0.7134, dtype=torch.float64) 0.7008709893386794
tensor(0.6814, dtype=torch.float64) 0.6660851603805875
tensor(0.7048, dtype=torch.float64) 0.6879183307308286
tensor(0.6790, dtype=torch.float64) 0.6580884515212779

[Epoch 290] Using encrypted gradient aggregation...

[Algorithm 3] Secure gradient aggregation with HE...
  Processing Client 0...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 3.2178
    Client 0: Encrypted gradient shape torch.Size([1433, 1433])
  Processing Client 1...
    X shape: torch.Size([1895, 1433]), A shape: torch.Size([1895, 1895]), W shape: torch.Size([1433, 1433])
    Laplacian matrix computed, shape: torch.Size([1895, 1895])
    Computing X^T L X using MPC...
    X^T L X shape: torch.Size([1433, 1433])
    Gradient computed, shape: torch.Size([1433, 1433]), norm: 2.9694
    Client 1: Encrypted gradient shape torch.Size([1433, 1433])

  [Server] Aggregating encrypted gradients...
  Aggregated 502 encrypted batches
  [Client 0] Decrypting aggregated gradient...
  Decrypted gradient - shape: torch.Size([1433, 1433]), norm: 5.5517
  Updating model parameters...
    Client 0 parameter updated
    Client 1 parameter updated
[Algorithm 3] Gradient update completed.

tensor(0.6790, dtype=torch.float64) 0.6581695751037824
 97%|█████████▋| 291/300 [02:42<00:04,  1.87it/s]tensor(0.7109, dtype=torch.float64) 0.7103984327632741
tensor(0.6974, dtype=torch.float64) 0.6855343326320683
tensor(0.7146, dtype=torch.float64) 0.6986726107616464
tensor(0.7196, dtype=torch.float64) 0.712504890628342
tensor(0.7196, dtype=torch.float64) 0.7121019639804202
tensor(0.6876, dtype=torch.float64) 0.6718290487021508
tensor(0.7183, dtype=torch.float64) 0.7023076278633348
tensor(0.7196, dtype=torch.float64) 0.7081623555885201
tensor(0.7220, dtype=torch.float64) 0.7150653044876583
100%|██████████| 300/300 [02:42<00:00,  1.84it/s]

============================================================
ABLATION RESULTS:
  Phase 1 Time: 153.58s
  Phase 2 Time: 162.98s
  Total Time: 316.56s
  Best Accuracy: 0.7355
============================================================

